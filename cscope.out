cscope 15 $HOME/test/uip/uip -q 0000001129 0000138914
	@apps/dhcpc/dhcpc.c

34 
	~<¡dio.h
>

35 
	~<¡ršg.h
>

37 
	~"u.h
"

38 
	~"dhıc.h
"

39 
	~"tim”.h
"

40 
	~"±.h
"

42 
	#STATE_INITIAL
 0

	)

43 
	#STATE_SENDING
 1

	)

44 
	#STATE_OFFER_RECEIVED
 2

	)

45 
	#STATE_CONFIG_RECEIVED
 3

	)

47 
dhıc_¡©e
 
	gs
;

49 
	sdhı_msg
 {

50 
u8_t
 
	mİ
, 
	mhty³
, 
	mhËn
, 
	mhİs
;

51 
u8_t
 
	mxid
[4];

52 
u16_t
 
	m£cs
, 
	mæags
;

53 
u8_t
 
	mcŸddr
[4];

54 
u8_t
 
	myŸddr
[4];

55 
u8_t
 
	msŸddr
[4];

56 
u8_t
 
	mgŸddr
[4];

57 
u8_t
 
	mchaddr
[16];

58 #iâdeà
UIP_CONF_DHCP_LIGHT


59 
u8_t
 
	m¢ame
[64];

60 
u8_t
 
	mfe
[128];

62 
u8_t
 
	mİtiÚs
[312];

65 
	#BOOTP_BROADCAST
 0x8000

	)

67 
	#DHCP_REQUEST
 1

	)

68 
	#DHCP_REPLY
 2

	)

69 
	#DHCP_HTYPE_ETHERNET
 1

	)

70 
	#DHCP_HLEN_ETHERNET
 6

	)

71 
	#DHCP_MSG_LEN
 236

	)

73 
	#DHCPC_SERVER_PORT
 67

	)

74 
	#DHCPC_CLIENT_PORT
 68

	)

76 
	#DHCPDISCOVER
 1

	)

77 
	#DHCPOFFER
 2

	)

78 
	#DHCPREQUEST
 3

	)

79 
	#DHCPDECLINE
 4

	)

80 
	#DHCPACK
 5

	)

81 
	#DHCPNAK
 6

	)

82 
	#DHCPRELEASE
 7

	)

84 
	#DHCP_OPTION_SUBNET_MASK
 1

	)

85 
	#DHCP_OPTION_ROUTER
 3

	)

86 
	#DHCP_OPTION_DNS_SERVER
 6

	)

87 
	#DHCP_OPTION_REQ_IPADDR
 50

	)

88 
	#DHCP_OPTION_LEASE_TIME
 51

	)

89 
	#DHCP_OPTION_MSG_TYPE
 53

	)

90 
	#DHCP_OPTION_SERVER_ID
 54

	)

91 
	#DHCP_OPTION_REQ_LIST
 55

	)

92 
	#DHCP_OPTION_END
 255

	)

94 cÚ¡ 
u8_t
 
	gxid
[4] = {0xad, 0xde, 0x12, 0x23};

95 cÚ¡ 
u8_t
 
	gmagic_cook›
[4] = {99, 130, 83, 99};

97 
u8_t
 *

98 
	$add_msg_ty³
(
u8_t
 *
İŒ
, u8_ˆ
ty³
)

100 *
İŒ
++ = 
DHCP_OPTION_MSG_TYPE
;

101 *
İŒ
++ = 1;

102 *
İŒ
++ = 
ty³
;

103  
İŒ
;

104 
	}
}

106 
u8_t
 *

107 
	$add_£rv”_id
(
u8_t
 *
İŒ
)

109 *
İŒ
++ = 
DHCP_OPTION_SERVER_ID
;

110 *
İŒ
++ = 4;

111 
	`memıy
(
İŒ
, 
s
.
£rv”id
, 4);

112  
İŒ
 + 4;

113 
	}
}

115 
u8_t
 *

116 
	$add_»q_addr
(
u8_t
 *
İŒ
)

118 *
İŒ
++ = 
DHCP_OPTION_REQ_IPADDR
;

119 *
İŒ
++ = 4;

120 
	`memıy
(
İŒ
, 
s
.
addr
, 4);

121  
İŒ
 + 4;

122 
	}
}

124 
u8_t
 *

125 
	$add_»q_İtiÚs
(
u8_t
 *
İŒ
)

127 *
İŒ
++ = 
DHCP_OPTION_REQ_LIST
;

128 *
İŒ
++ = 3;

129 *
İŒ
++ = 
DHCP_OPTION_SUBNET_MASK
;

130 *
İŒ
++ = 
DHCP_OPTION_ROUTER
;

131 *
İŒ
++ = 
DHCP_OPTION_DNS_SERVER
;

132  
İŒ
;

133 
	}
}

135 
u8_t
 *

136 
	$add_’d
(
u8_t
 *
İŒ
)

138 *
İŒ
++ = 
DHCP_OPTION_END
;

139  
İŒ
;

140 
	}
}

143 
	$ü—‹_msg
(
dhı_msg
 *
m
)

145 
m
->
İ
 = 
DHCP_REQUEST
;

146 
m
->
hty³
 = 
DHCP_HTYPE_ETHERNET
;

147 
m
->
hËn
 = 
s
.
mac_Ën
;

148 
m
->
hİs
 = 0;

149 
	`memıy
(
m
->
xid
, xid, (m->xid));

150 
m
->
£cs
 = 0;

151 
m
->
æags
 = 
	`HTONS
(
BOOTP_BROADCAST
);

153 
	`memıy
(
m
->
cŸddr
, 
u_ho¡addr
, (m->ciaddr));

154 
	`mem£t
(
m
->
yŸddr
, 0, (m->yiaddr));

155 
	`mem£t
(
m
->
sŸddr
, 0, (m->siaddr));

156 
	`mem£t
(
m
->
gŸddr
, 0, (m->giaddr));

157 
	`memıy
(
m
->
chaddr
, 
s
.
mac_addr
, s.
mac_Ën
);

158 
	`mem£t
(&
m
->
chaddr
[
s
.
mac_Ën
], 0, (m->chaddr) - s.mac_len);

159 #iâdeà
UIP_CONF_DHCP_LIGHT


160 
	`mem£t
(
m
->
¢ame
, 0, (m->sname));

161 
	`mem£t
(
m
->
fe
, 0, (m->file));

164 
	`memıy
(
m
->
İtiÚs
, 
magic_cook›
, (magic_cookie));

165 
	}
}

168 
	$£nd_discov”
()

170 
u8_t
 *
’d
;

171 
dhı_msg
 *
m
 = (dhı_msg *)
u_­pd©a
;

173 
	`ü—‹_msg
(
m
);

175 
’d
 = 
	`add_msg_ty³
(&
m
->
İtiÚs
[4], 
DHCPDISCOVER
);

176 
’d
 = 
	`add_»q_İtiÚs
(end);

177 
’d
 = 
	`add_’d
(end);

179 
	`u_£nd
(
u_­pd©a
, 
’d
 - (
u8_t
 *)uip_appdata);

180 
	}
}

183 
	$£nd_»que¡
()

185 
u8_t
 *
’d
;

186 
dhı_msg
 *
m
 = (dhı_msg *)
u_­pd©a
;

188 
	`ü—‹_msg
(
m
);

190 
’d
 = 
	`add_msg_ty³
(&
m
->
İtiÚs
[4], 
DHCPREQUEST
);

191 
’d
 = 
	`add_£rv”_id
(end);

192 
’d
 = 
	`add_»q_addr
(end);

193 
’d
 = 
	`add_’d
(end);

195 
	`u_£nd
(
u_­pd©a
, 
’d
 - (
u8_t
 *)uip_appdata);

196 
	}
}

198 
u8_t


199 
	$·r£_İtiÚs
(
u8_t
 *
İŒ
, 
Ën
)

201 
u8_t
 *
’d
 = 
İŒ
 + 
Ën
;

202 
u8_t
 
ty³
 = 0;

204 
İŒ
 < 
’d
) {

205 *
İŒ
) {

206 
DHCP_OPTION_SUBNET_MASK
:

207 
	`memıy
(
s
.
Ãtmask
, 
İŒ
 + 2, 4);

209 
DHCP_OPTION_ROUTER
:

210 
	`memıy
(
s
.
deçuÉ_rou‹r
, 
İŒ
 + 2, 4);

212 
DHCP_OPTION_DNS_SERVER
:

213 
	`memıy
(
s
.
dn§ddr
, 
İŒ
 + 2, 4);

215 
DHCP_OPTION_MSG_TYPE
:

216 
ty³
 = *(
İŒ
 + 2);

218 
DHCP_OPTION_SERVER_ID
:

219 
	`memıy
(
s
.
£rv”id
, 
İŒ
 + 2, 4);

221 
DHCP_OPTION_LEASE_TIME
:

222 
	`memıy
(
s
.
Ëa£_time
, 
İŒ
 + 2, 4);

224 
DHCP_OPTION_END
:

225  
ty³
;

228 
İŒ
 += optptr[1] + 2;

230  
ty³
;

231 
	}
}

233 
u8_t


234 
	$·r£_msg
()

236 
dhı_msg
 *
m
 = (dhı_msg *)
u_­pd©a
;

238 if(
m
->
İ
 =ğ
DHCP_REPLY
 &&

239 
	`memcmp
(
m
->
xid
, xid, (xid)) == 0 &&

240 
	`memcmp
(
m
->
chaddr
, 
s
.
mac_addr
, s.
mac_Ën
) == 0) {

241 
	`memıy
(
s
.
addr
, 
m
->
yŸddr
, 4);

242  
	`·r£_İtiÚs
(&
m
->
İtiÚs
[4], 
	`u_d©®’
());

245 
	}
}

248 
PT_THREAD
(
	$hªdË_dhı
())

250 
	`PT_BEGIN
(&
s
.
±
);

253 
s
.
¡©e
 = 
STATE_SENDING
;

254 
s
.
ticks
 = 
CLOCK_SECOND
;

257 
	`£nd_discov”
();

258 
	`tim”_£t
(&
s
.
tim”
, s.
ticks
);

259 
	`PT_WAIT_UNTIL
(&
s
.
±
, 
	`u_Ãwd©a
(è|| 
	`tim”_expœed
(&s.
tim”
));

261 if(
	`u_Ãwd©a
(è&& 
	`·r£_msg
(è=ğ
DHCPOFFER
) {

262 
s
.
¡©e
 = 
STATE_OFFER_RECEIVED
;

266 if(
s
.
ticks
 < 
CLOCK_SECOND
 * 60) {

267 
s
.
ticks
 *= 2;

269 } 
s
.
¡©e
 !ğ
STATE_OFFER_RECEIVED
);

271 
s
.
ticks
 = 
CLOCK_SECOND
;

274 
	`£nd_»que¡
();

275 
	`tim”_£t
(&
s
.
tim”
, s.
ticks
);

276 
	`PT_WAIT_UNTIL
(&
s
.
±
, 
	`u_Ãwd©a
(è|| 
	`tim”_expœed
(&s.
tim”
));

278 if(
	`u_Ãwd©a
(è&& 
	`·r£_msg
(è=ğ
DHCPACK
) {

279 
s
.
¡©e
 = 
STATE_CONFIG_RECEIVED
;

283 if(
s
.
ticks
 <ğ
CLOCK_SECOND
 * 10) {

284 
s
.
ticks
 +ğ
CLOCK_SECOND
;

286 
	`PT_RESTART
(&
s
.
±
);

288 } 
s
.
¡©e
 !ğ
STATE_CONFIG_RECEIVED
);

291 
	`´štf
("Got IP‡ddress %d.%d.%d.%d\n",

292 
	`u_addr1
(
s
.
addr
), 
	`u_addr2
(s.ipaddr),

293 
	`u_addr3
(
s
.
addr
), 
	`u_addr4
(s.ipaddr));

294 
	`´štf
("Got‚etmask %d.%d.%d.%d\n",

295 
	`u_addr1
(
s
.
Ãtmask
), 
	`u_addr2
(s.netmask),

296 
	`u_addr3
(
s
.
Ãtmask
), 
	`u_addr4
(s.netmask));

297 
	`´štf
("Got DNS server %d.%d.%d.%d\n",

298 
	`u_addr1
(
s
.
dn§ddr
), 
	`u_addr2
(s.dnsaddr),

299 
	`u_addr3
(
s
.
dn§ddr
), 
	`u_addr4
(s.dnsaddr));

300 
	`´štf
("Got default„outer %d.%d.%d.%d\n",

301 
	`u_addr1
(
s
.
deçuÉ_rou‹r
), 
	`u_addr2
(s.default_router),

302 
	`u_addr3
(
s
.
deçuÉ_rou‹r
), 
	`u_addr4
(s.default_router));

303 
	`´štf
("Leaseƒxpires in %ld seconds\n",

304 
	`Áohs
(
s
.
Ëa£_time
[0])*65536ul +‚tohs(s.lease_time[1]));

307 
	`dhıc_cÚfigu»d
(&
s
);

316 
	`PT_YIELD
(&
s
.
±
);

319 
	`PT_END
(&
s
.
±
);

320 
	}
}

323 
	$dhıc_š™
(cÚ¡ *
mac_addr
, 
mac_Ën
)

325 
u_addr_t
 
addr
;

327 
s
.
mac_addr
 = mac_addr;

328 
s
.
mac_Ën
 = mac_len;

330 
s
.
¡©e
 = 
STATE_INITIAL
;

331 
	`u_addr
(
addr
, 255,255,255,255);

332 
s
.
cÚn
 = 
	`u_udp_Ãw
(&
addr
, 
	`HTONS
(
DHCPC_SERVER_PORT
));

333 if(
s
.
cÚn
 !ğ
NULL
) {

334 
	`u_udp_bšd
(
s
.
cÚn
, 
	`HTONS
(
DHCPC_CLIENT_PORT
));

336 
	`PT_INIT
(&
s
.
±
);

337 
	}
}

340 
	$dhıc_­pÿÎ
()

342 
	`hªdË_dhı
();

343 
	}
}

346 
	$dhıc_»que¡
()

348 
u16_t
 
addr
[2];

350 if(
s
.
¡©e
 =ğ
STATE_INITIAL
) {

351 
	`u_addr
(
addr
, 0,0,0,0);

352 
	`u_£tho¡addr
(
addr
);

355 
	}
}

	@apps/dhcpc/dhcpc.h

33 #iâdeà
__DHCPC_H__


34 
	#__DHCPC_H__


	)

36 
	~"tim”.h
"

37 
	~"±.h
"

39 
	sdhıc_¡©e
 {

40 
±
 
	m±
;

41 
	m¡©e
;

42 
u_udp_cÚn
 *
	mcÚn
;

43 
tim”
 
	mtim”
;

44 
u16_t
 
	mticks
;

45 cÚ¡ *
	mmac_addr
;

46 
	mmac_Ën
;

48 
u8_t
 
	m£rv”id
[4];

50 
u16_t
 
	mËa£_time
[2];

51 
u16_t
 
	maddr
[2];

52 
u16_t
 
	mÃtmask
[2];

53 
u16_t
 
	mdn§ddr
[2];

54 
u16_t
 
	mdeçuÉ_rou‹r
[2];

57 
dhıc_š™
(cÚ¡ *
mac_addr
, 
mac_Ën
);

58 
dhıc_»que¡
();

60 
dhıc_­pÿÎ
();

62 
dhıc_cÚfigu»d
(cÚ¡ 
dhıc_¡©e
 *
s
);

64 
dhıc_¡©e
 
	tu_udp_­p¡©e_t
;

65 
	#UIP_UDP_APPCALL
 
dhıc_­pÿÎ


	)

	@apps/hello-world/hello-world.c

25 
	~"h–lo-wÜld.h
"

26 
	~"u.h
"

27 
	~<¡ršg.h
>

33 
hªdË_cÚÃùiÚ
(
h–lo_wÜld_¡©e
 *
s
);

41 
	$h–lo_wÜld_š™
()

44 
	`u_li¡’
(
	`HTONS
(1000));

45 
	}
}

55 
	$h–lo_wÜld_­pÿÎ
()

62 
h–lo_wÜld_¡©e
 *
s
 = &(
u_cÚn
->
­p¡©e
);

68 if(
	`u_cÚÃùed
()) {

69 
	`PSOCK_INIT
(&
s
->
p
, s->
šputbufãr
, (s->inputbuffer));

77 
	`hªdË_cÚÃùiÚ
(
s
);

78 
	}
}

87 
	$hªdË_cÚÃùiÚ
(
h–lo_wÜld_¡©e
 *
s
)

89 
	`PSOCK_BEGIN
(&
s
->
p
);

91 
	`PSOCK_SEND_STR
(&
s
->
p
, "Hello. What is your‚ame?\n");

92 
	`PSOCK_READTO
(&
s
->
p
, '\n');

93 
	`¡ºıy
(
s
->
Çme
, s->
šputbufãr
, (s->name));

94 
	`PSOCK_SEND_STR
(&
s
->
p
, "Hello ");

95 
	`PSOCK_SEND_STR
(&
s
->
p
, s->
Çme
);

96 
	`PSOCK_CLOSE
(&
s
->
p
);

98 
	`PSOCK_END
(&
s
->
p
);

99 
	}
}

	@apps/hello-world/hello-world.h

22 #iâdeà
__HELLO_WORLD_H__


23 
	#__HELLO_WORLD_H__


	)

28 
	~"uİt.h
"

30 
	~"psock.h
"

36 
	sh–lo_wÜld_¡©e
 {

37 
psock
 
	mp
;

38 
	mšputbufãr
[10];

39 
	mÇme
[40];

40 } 
	tu_tı_­p¡©e_t
;

43 
h–lo_wÜld_­pÿÎ
();

44 #iâdeà
UIP_APPCALL


45 
	#UIP_APPCALL
 
h–lo_wÜld_­pÿÎ


	)

48 
h–lo_wÜld_š™
();

	@apps/resolv/resolv.c

63 
	~"»sŞv.h
"

64 
	~"u.h
"

66 
	~<¡ršg.h
>

68 #iâdeà
NULL


69 
	#NULL
 (*)0

	)

73 
	#MAX_RETRIES
 8

	)

76 
	sdns_hdr
 {

77 
u16_t
 
	mid
;

78 
u8_t
 
	mæags1
, 
	mæags2
;

79 
	#DNS_FLAG1_RESPONSE
 0x80

	)

80 
	#DNS_FLAG1_OPCODE_STATUS
 0x10

	)

81 
	#DNS_FLAG1_OPCODE_INVERSE
 0x08

	)

82 
	#DNS_FLAG1_OPCODE_STANDARD
 0x00

	)

83 
	#DNS_FLAG1_AUTHORATIVE
 0x04

	)

84 
	#DNS_FLAG1_TRUNC
 0x02

	)

85 
	#DNS_FLAG1_RD
 0x01

	)

86 
	#DNS_FLAG2_RA
 0x80

	)

87 
	#DNS_FLAG2_ERR_MASK
 0x0f

	)

88 
	#DNS_FLAG2_ERR_NONE
 0x00

	)

89 
	#DNS_FLAG2_ERR_NAME
 0x03

	)

90 
u16_t
 
	mnumque¡iÚs
;

91 
u16_t
 
	mnumªsw”s
;

92 
u16_t
 
	mnumauth¼
;

93 
u16_t
 
	mnumexŒ¬r
;

97 
	sdns_ªsw”
 {

100 
u16_t
 
	mty³
;

101 
u16_t
 
	mşass
;

102 
u16_t
 
	m‰l
[2];

103 
u16_t
 
	mËn
;

104 
u_addr_t
 
	maddr
;

107 
	sÇmem­
 {

108 
	#STATE_UNUSED
 0

	)

109 
	#STATE_NEW
 1

	)

110 
	#STATE_ASKING
 2

	)

111 
	#STATE_DONE
 3

	)

112 
	#STATE_ERROR
 4

	)

113 
u8_t
 
	m¡©e
;

114 
u8_t
 
	mtmr
;

115 
u8_t
 
	m»Œ›s
;

116 
u8_t
 
	m£qno
;

117 
u8_t
 
	m”r
;

118 
	mÇme
[32];

119 
u_addr_t
 
	maddr
;

122 #iâdeà
UIP_CONF_RESOLV_ENTRIES


123 
	#RESOLV_ENTRIES
 4

	)

125 
	#RESOLV_ENTRIES
 
UIP_CONF_RESOLV_ENTRIES


	)

129 
Çmem­
 
	gÇmes
[
RESOLV_ENTRIES
];

131 
u8_t
 
	g£qno
;

133 
u_udp_cÚn
 *
	g»sŞv_cÚn
 = 
NULL
;

144 
	$·r£_Çme
(*
qu”y
)

146 
n
;

149 
n
 = *
qu”y
++;

151 
n
 > 0) {

153 ++
qu”y
;

154 --
n
;

157 } *
qu”y
 != 0);

159  
qu”y
 + 1;

160 
	}
}

168 
	$check_’Œ›s
()

170 
dns_hdr
 *
hdr
;

171 *
qu”y
, *
ÅŒ
, *
Çm•Œ
;

172 
u8_t
 
i
;

173 
u8_t
 
n
;

174 
Çmem­
 *
Çmem­±r
;

176 
i
 = 0; i < 
RESOLV_ENTRIES
; ++i) {

177 
Çmem­±r
 = &
Çmes
[
i
];

178 if(
Çmem­±r
->
¡©e
 =ğ
STATE_NEW
 ||

179 
Çmem­±r
->
¡©e
 =ğ
STATE_ASKING
) {

180 if(
Çmem­±r
->
¡©e
 =ğ
STATE_ASKING
) {

181 if(--
Çmem­±r
->
tmr
 == 0) {

182 if(++
Çmem­±r
->
»Œ›s
 =ğ
MAX_RETRIES
) {

183 
Çmem­±r
->
¡©e
 = 
STATE_ERROR
;

184 
	`»sŞv_found
(
Çmem­±r
->
Çme
, 
NULL
);

187 
Çmem­±r
->
tmr
 =‚amem­±r->
»Œ›s
;

195 
Çmem­±r
->
¡©e
 = 
STATE_ASKING
;

196 
Çmem­±r
->
tmr
 = 1;

197 
Çmem­±r
->
»Œ›s
 = 0;

199 
hdr
 = (
dns_hdr
 *)
u_­pd©a
;

200 
	`mem£t
(
hdr
, 0, (
dns_hdr
));

201 
hdr
->
id
 = 
	`htÚs
(
i
);

202 
hdr
->
æags1
 = 
DNS_FLAG1_RD
;

203 
hdr
->
numque¡iÚs
 = 
	`HTONS
(1);

204 
qu”y
 = (*)
u_­pd©a
 + 12;

205 
Çm•Œ
 = 
Çmem­±r
->
Çme
;

206 --
Çm•Œ
;

209 ++
Çm•Œ
;

210 
ÅŒ
 = 
qu”y
;

211 ++
qu”y
;

212 
n
 = 0; *
Çm•Œ
 != '.' && *nameptr != 0; ++nameptr) {

213 *
qu”y
 = *
Çm•Œ
;

214 ++
qu”y
;

215 ++
n
;

217 *
ÅŒ
 = 
n
;

218 } *
Çm•Œ
 != 0);

220 
’dqu”y
[] =

222 
	`memıy
(
qu”y
, 
’dqu”y
, 5);

224 
	`u_udp_£nd
(()(
qu”y
 + 5 - (*)
u_­pd©a
));

228 
	}
}

235 
	$Ãwd©a
()

237 *
Çm•Œ
;

238 
dns_ªsw”
 *
ªs
;

239 
dns_hdr
 *
hdr
;

240 
u8_t
 
nque¡iÚs
, 
Çnsw”s
;

241 
u8_t
 
i
;

242 
Çmem­
 *
Çmem­±r
;

244 
hdr
 = (
dns_hdr
 *)
u_­pd©a
;

257 
i
 = 
	`htÚs
(
hdr
->
id
);

258 
Çmem­±r
 = &
Çmes
[
i
];

259 if(
i
 < 
RESOLV_ENTRIES
 &&

260 
Çmem­±r
->
¡©e
 =ğ
STATE_ASKING
) {

263 
Çmem­±r
->
¡©e
 = 
STATE_DONE
;

264 
Çmem­±r
->
”r
 = 
hdr
->
æags2
 & 
DNS_FLAG2_ERR_MASK
;

267 if(
Çmem­±r
->
”r
 != 0) {

268 
Çmem­±r
->
¡©e
 = 
STATE_ERROR
;

269 
	`»sŞv_found
(
Çmem­±r
->
Çme
, 
NULL
);

275 
nque¡iÚs
 = 
	`htÚs
(
hdr
->
numque¡iÚs
);

276 
Çnsw”s
 = 
	`htÚs
(
hdr
->
numªsw”s
);

281 
Çm•Œ
 = 
	`·r£_Çme
((*)
u_­pd©a
 + 12) + 4;

283 
Çnsw”s
 > 0) {

286 if(*
Çm•Œ
 & 0xc0) {

288 
Çm•Œ
 +=2;

292 
Çm•Œ
 = 
	`·r£_Çme
((*)nameptr);

295 
ªs
 = (
dns_ªsw”
 *)
Çm•Œ
;

302 if(
ªs
->
ty³
 =ğ
	`HTONS
(1) &&

303 
ªs
->
şass
 =ğ
	`HTONS
(1) &&

304 
ªs
->
Ën
 =ğ
	`HTONS
(4)) {

312 
Çmem­±r
->
addr
[0] = 
ªs
->ipaddr[0];

313 
Çmem­±r
->
addr
[1] = 
ªs
->ipaddr[1];

315 
	`»sŞv_found
(
Çmem­±r
->
Çme
,‚amem­±r->
addr
);

318 
Çm•Œ
 =‚am•Œ + 10 + 
	`htÚs
(
ªs
->
Ën
);

320 --
Çnsw”s
;

324 
	}
}

331 
	$»sŞv_­pÿÎ
()

333 if(
u_udp_cÚn
->
½Üt
 =ğ
	`HTONS
(53)) {

334 if(
	`u_pŞl
()) {

335 
	`check_’Œ›s
();

337 if(
	`u_Ãwd©a
()) {

338 
	`Ãwd©a
();

341 
	}
}

350 
	$»sŞv_qu”y
(*
Çme
)

352 
u8_t
 
i
;

353 
u8_t
 
l£q
, 
l£qi
;

354 
Çmem­
 *
Çm•Œ
;

356 
l£q
 = 
l£qi
 = 0;

358 
i
 = 0; i < 
RESOLV_ENTRIES
; ++i) {

359 
Çm•Œ
 = &
Çmes
[
i
];

360 if(
Çm•Œ
->
¡©e
 =ğ
STATE_UNUSED
) {

363 if(
£qno
 - 
Çm•Œ
->£qnØ> 
l£q
) {

364 
l£q
 = 
£qno
 - 
Çm•Œ
->seqno;

365 
l£qi
 = 
i
;

369 if(
i
 =ğ
RESOLV_ENTRIES
) {

370 
i
 = 
l£qi
;

371 
Çm•Œ
 = &
Çmes
[
i
];

376 
	`¡rıy
(
Çm•Œ
->
Çme
,‚ame);

377 
Çm•Œ
->
¡©e
 = 
STATE_NEW
;

378 
Çm•Œ
->
£qno
 = seqno;

379 ++
£qno
;

380 
	}
}

395 
u16_t
 *

396 
	$»sŞv_lookup
(*
Çme
)

398 
u8_t
 
i
;

399 
Çmem­
 *
Çm•Œ
;

403 
i
 = 0; i < 
RESOLV_ENTRIES
; ++i) {

404 
Çm•Œ
 = &
Çmes
[
i
];

405 if(
Çm•Œ
->
¡©e
 =ğ
STATE_DONE
 &&

406 
	`¡rcmp
(
Çme
, 
Çm•Œ
->name) == 0) {

407  
Çm•Œ
->
addr
;

410  
NULL
;

411 
	}
}

421 
u16_t
 *

422 
	$»sŞv_g‘£rv”
()

424 if(
»sŞv_cÚn
 =ğ
NULL
) {

425  
NULL
;

427  
»sŞv_cÚn
->
raddr
;

428 
	}
}

438 
	$»sŞv_cÚf
(
u16_t
 *
dns£rv”
)

440 if(
»sŞv_cÚn
 !ğ
NULL
) {

441 
	`u_udp_»move
(
»sŞv_cÚn
);

444 
»sŞv_cÚn
 = 
	`u_udp_Ãw
(
dns£rv”
, 
	`HTONS
(53));

445 
	}
}

452 
	$»sŞv_š™
()

454 
u8_t
 
i
;

456 
i
 = 0; i < 
RESOLV_ENTRIES
; ++i) {

457 
Çmes
[
i
].
¡©e
 = 
STATE_DONE
;

460 
	}
}

	@apps/resolv/resolv.h

44 #iâdeà
__RESOLV_H__


45 
	#__RESOLV_H__


	)

47 
	tu_udp_­p¡©e_t
;

48 
»sŞv_­pÿÎ
();

49 
	#UIP_UDP_APPCALL
 
»sŞv_­pÿÎ


	)

51 
	~"uİt.h
"

64 
»sŞv_found
(*
Çme
, 
u16_t
 *
addr
);

67 
»sŞv_cÚf
(
u16_t
 *
dns£rv”
);

68 
u16_t
 *
»sŞv_g‘£rv”
();

69 
»sŞv_š™
();

70 
u16_t
 *
»sŞv_lookup
(*
Çme
);

71 
»sŞv_qu”y
(*
Çme
);

	@apps/smtp/smtp-strings.c

35 cÚ¡ 
	gsm_220
[4] =

38 cÚ¡ 
	gsm_h–o
[6] =

41 cÚ¡ 
	gsm_ma_äom
[12] =

44 cÚ¡ 
	gsm_rıt_to
[10] =

47 cÚ¡ 
	gsm_d©a
[7] =

50 cÚ¡ 
	gsm_to
[5] =

53 cÚ¡ 
	gsm_cc
[5] =

56 cÚ¡ 
	gsm_äom
[7] =

59 cÚ¡ 
	gsm_subjeù
[10] =

62 cÚ¡ 
	gsm_qu™
[7] =

65 cÚ¡ 
	gsm_üÆ
[3] =

68 cÚ¡ 
	gsm_üÆ³riodüÆ
[6] =

	@apps/smtp/smtp-strings.h

35 cÚ¡ 
sm_220
[4];

36 cÚ¡ 
sm_h–o
[6];

37 cÚ¡ 
sm_ma_äom
[12];

38 cÚ¡ 
sm_rıt_to
[10];

39 cÚ¡ 
sm_d©a
[7];

40 cÚ¡ 
sm_to
[5];

41 cÚ¡ 
sm_cc
[5];

42 cÚ¡ 
sm_äom
[7];

43 cÚ¡ 
sm_subjeù
[10];

44 cÚ¡ 
sm_qu™
[7];

45 cÚ¡ 
sm_üÆ
[3];

46 cÚ¡ 
sm_üÆ³riodüÆ
[6];

	@apps/smtp/smtp.c

57 
	~"sm.h
"

59 
	~"sm-¡ršgs.h
"

60 
	~"psock.h
"

61 
	~"u.h
"

63 
	~<¡ršg.h
>

65 
sm_¡©e
 
	gs
;

67 *
	gloÿlho¡Çme
;

68 
u_addr_t
 
	gsm£rv”
;

70 
	#ISO_Æ
 0x0a

	)

71 
	#ISO_ü
 0x0d

	)

73 
	#ISO_³riod
 0x2e

	)

75 
	#ISO_2
 0x32

	)

76 
	#ISO_3
 0x33

	)

77 
	#ISO_4
 0x34

	)

78 
	#ISO_5
 0x35

	)

83 
PT_THREAD
(
	$sm_th»ad
())

85 
	`PSOCK_BEGIN
(&
s
.
psock
);

87 
	`PSOCK_READTO
(&
s
.
psock
, 
ISO_Æ
);

89 if(
	`¡ºcmp
(
s
.
šputbufãr
, 
sm_220
, 3) != 0) {

90 
	`PSOCK_CLOSE
(&
s
.
psock
);

91 
	`sm_dÚe
(2);

92 
	`PSOCK_EXIT
(&
s
.
psock
);

95 
	`PSOCK_SEND_STR
(&
s
.
psock
, (*)
sm_h–o
);

96 
	`PSOCK_SEND_STR
(&
s
.
psock
, 
loÿlho¡Çme
);

97 
	`PSOCK_SEND_STR
(&
s
.
psock
, (*)
sm_üÆ
);

99 
	`PSOCK_READTO
(&
s
.
psock
, 
ISO_Æ
);

101 if(
s
.
šputbufãr
[0] !ğ
ISO_2
) {

102 
	`PSOCK_CLOSE
(&
s
.
psock
);

103 
	`sm_dÚe
(3);

104 
	`PSOCK_EXIT
(&
s
.
psock
);

107 
	`PSOCK_SEND_STR
(&
s
.
psock
, (*)
sm_ma_äom
);

108 
	`PSOCK_SEND_STR
(&
s
.
psock
, s.
äom
);

109 
	`PSOCK_SEND_STR
(&
s
.
psock
, (*)
sm_üÆ
);

111 
	`PSOCK_READTO
(&
s
.
psock
, 
ISO_Æ
);

113 if(
s
.
šputbufãr
[0] !ğ
ISO_2
) {

114 
	`PSOCK_CLOSE
(&
s
.
psock
);

115 
	`sm_dÚe
(4);

116 
	`PSOCK_EXIT
(&
s
.
psock
);

119 
	`PSOCK_SEND_STR
(&
s
.
psock
, (*)
sm_rıt_to
);

120 
	`PSOCK_SEND_STR
(&
s
.
psock
, s.
to
);

121 
	`PSOCK_SEND_STR
(&
s
.
psock
, (*)
sm_üÆ
);

123 
	`PSOCK_READTO
(&
s
.
psock
, 
ISO_Æ
);

125 if(
s
.
šputbufãr
[0] !ğ
ISO_2
) {

126 
	`PSOCK_CLOSE
(&
s
.
psock
);

127 
	`sm_dÚe
(5);

128 
	`PSOCK_EXIT
(&
s
.
psock
);

131 if(
s
.
cc
 != 0) {

132 
	`PSOCK_SEND_STR
(&
s
.
psock
, (*)
sm_rıt_to
);

133 
	`PSOCK_SEND_STR
(&
s
.
psock
, s.
cc
);

134 
	`PSOCK_SEND_STR
(&
s
.
psock
, (*)
sm_üÆ
);

136 
	`PSOCK_READTO
(&
s
.
psock
, 
ISO_Æ
);

138 if(
s
.
šputbufãr
[0] !ğ
ISO_2
) {

139 
	`PSOCK_CLOSE
(&
s
.
psock
);

140 
	`sm_dÚe
(6);

141 
	`PSOCK_EXIT
(&
s
.
psock
);

145 
	`PSOCK_SEND_STR
(&
s
.
psock
, (*)
sm_d©a
);

147 
	`PSOCK_READTO
(&
s
.
psock
, 
ISO_Æ
);

149 if(
s
.
šputbufãr
[0] !ğ
ISO_3
) {

150 
	`PSOCK_CLOSE
(&
s
.
psock
);

151 
	`sm_dÚe
(7);

152 
	`PSOCK_EXIT
(&
s
.
psock
);

155 
	`PSOCK_SEND_STR
(&
s
.
psock
, (*)
sm_to
);

156 
	`PSOCK_SEND_STR
(&
s
.
psock
, s.
to
);

157 
	`PSOCK_SEND_STR
(&
s
.
psock
, (*)
sm_üÆ
);

159 if(
s
.
cc
 != 0) {

160 
	`PSOCK_SEND_STR
(&
s
.
psock
, (*)
sm_cc
);

161 
	`PSOCK_SEND_STR
(&
s
.
psock
, s.
cc
);

162 
	`PSOCK_SEND_STR
(&
s
.
psock
, (*)
sm_üÆ
);

165 
	`PSOCK_SEND_STR
(&
s
.
psock
, (*)
sm_äom
);

166 
	`PSOCK_SEND_STR
(&
s
.
psock
, s.
äom
);

167 
	`PSOCK_SEND_STR
(&
s
.
psock
, (*)
sm_üÆ
);

169 
	`PSOCK_SEND_STR
(&
s
.
psock
, (*)
sm_subjeù
);

170 
	`PSOCK_SEND_STR
(&
s
.
psock
, s.
subjeù
);

171 
	`PSOCK_SEND_STR
(&
s
.
psock
, (*)
sm_üÆ
);

173 
	`PSOCK_SEND
(&
s
.
psock
, s.
msg
, s.
msgËn
);

175 
	`PSOCK_SEND_STR
(&
s
.
psock
, (*)
sm_üÆ³riodüÆ
);

177 
	`PSOCK_READTO
(&
s
.
psock
, 
ISO_Æ
);

178 if(
s
.
šputbufãr
[0] !ğ
ISO_2
) {

179 
	`PSOCK_CLOSE
(&
s
.
psock
);

180 
	`sm_dÚe
(8);

181 
	`PSOCK_EXIT
(&
s
.
psock
);

184 
	`PSOCK_SEND_STR
(&
s
.
psock
, (*)
sm_qu™
);

185 
	`sm_dÚe
(
SMTP_ERR_OK
);

186 
	`PSOCK_END
(&
s
.
psock
);

187 
	}
}

190 
	$sm_­pÿÎ
()

192 if(
	`u_şo£d
()) {

193 
s
.
cÚÃùed
 = 0;

196 if(
	`u_abÜ‹d
(è|| 
	`u_timedout
()) {

197 
s
.
cÚÃùed
 = 0;

198 
	`sm_dÚe
(1);

201 
	`sm_th»ad
();

202 
	}
}

216 
	$sm_cÚfigu»
(*
lho¡Çme
, *
£rv”
)

218 
loÿlho¡Çme
 = 
lho¡Çme
;

219 
	`u_addr_cİy
(
sm£rv”
, 
£rv”
);

220 
	}
}

233 
	$sm_£nd
(*
to
, *
cc
, *
äom
,

234 *
subjeù
, *
msg
, 
u16_t
 
msgËn
)

236 
u_cÚn
 *
cÚn
;

238 
cÚn
 = 
	`u_cÚÃù
(
sm£rv”
, 
	`HTONS
(25));

239 if(
cÚn
 =ğ
NULL
) {

242 
s
.
cÚÃùed
 = 1;

243 
s
.
to
 =o;

244 
s
.
cc
 = cc;

245 
s
.
äom
 = from;

246 
s
.
subjeù
 = subject;

247 
s
.
msg
 = msg;

248 
s
.
msgËn
 = msglen;

250 
	`PSOCK_INIT
(&
s
.
psock
, s.
šputbufãr
, (s.inputbuffer));

253 
	}
}

256 
	$sm_š™
()

258 
s
.
cÚÃùed
 = 0;

259 
	}
}

	@apps/smtp/smtp.h

47 #iâdeà
__SMTP_H__


48 
	#__SMTP_H__


	)

50 
	~"uİt.h
"

55 
	#SMTP_ERR_OK
 0

	)

67 
sm_dÚe
(
”rÜ
);

69 
sm_š™
();

72 
sm_cÚfigu»
(*
loÿlho¡Çme
, 
u16_t
 *
sm£rv”
);

73 
sm_£nd
(*
to
, *
äom
,

74 *
subjeù
, *
msg
,

75 
u16_t
 
msgËn
);

76 
	#SMTP_SEND
(
to
, 
cc
, 
äom
, 
subjeù
, 
msg
) \

77 
	`sm_£nd
(
to
, 
cc
, 
äom
, 
subjeù
, 
msg
, 
	`¡¾’
(msg))

	)

79 
sm_­pÿÎ
();

81 
	ssm_¡©e
 {

82 
u8_t
 
	m¡©e
;

83 *
	mto
;

84 *
	mäom
;

85 *
	msubjeù
;

86 *
	mmsg
;

87 
u16_t
 
	mmsgËn
;

89 
u16_t
 
	m£ÁËn
, 
	m‹x’
;

90 
u16_t
 
	m£nd±r
;

95 #iâdeà
UIP_APPCALL


96 
	#UIP_APPCALL
 
sm_­pÿÎ


	)

98 
sm_¡©e
 
	tu_tı_­p¡©e_t
;

	@apps/telnetd/shell.c

35 
	~"sh–l.h
"

37 
	~<¡ršg.h
>

39 
	s±’Œy
 {

40 *
	mcommªd¡r
;

41 (* 
	mpfunc
)(*
	m¡r
);

44 
	#SHELL_PROMPT
 "uIP 1.0> "

	)

48 
	$·r£
(*
¡r
, 
±’Œy
 *
t
)

50 
±’Œy
 *
p
;

51 
p
 = 
t
;…->
commªd¡r
 !ğ
NULL
; ++p) {

52 if(
	`¡ºcmp
(
p
->
commªd¡r
, 
¡r
, 
	`¡¾’
(p->commandstr)) == 0) {

57 
p
->
	`pfunc
(
¡r
);

58 
	}
}

61 
	$š‰o¡r
(*
¡r
, 
i
)

63 
¡r
[0] = '0' + 
i
 / 100;

64 if(
¡r
[0] == '0') {

65 
¡r
[0] = ' ';

67 
¡r
[1] = '0' + (
i
 / 10) % 10;

68 if(
¡r
[0] == ' ' && str[1] == '0') {

69 
¡r
[1] = ' ';

71 
¡r
[2] = '0' + 
i
 % 10;

72 
¡r
[3] = ' ';

73 
¡r
[4] = 0;

74 
	}
}

77 
	$h–p
(*
¡r
)

79 
	`sh–l_ouut
("Available commands:", "");

80 
	`sh–l_ouut
("stats - show‚etwork statistics", "");

81 
	`sh–l_ouut
("conn - show TCP connections", "");

82 
	`sh–l_ouut
("help, ? - show help", "");

83 
	`sh–l_ouut
("exit -ƒxit shell", "");

84 
	}
}

87 
	$unknown
(*
¡r
)

89 if(
	`¡¾’
(
¡r
) > 0) {

90 
	`sh–l_ouut
("UnknowÀcommªd: ", 
¡r
);

92 
	}
}

94 
±’Œy
 
	g·r£b
[] =

95 {{"¡©s", 
h–p
},

96 {"cÚn", 
h–p
},

97 {"h–p", 
h–p
},

98 {"ex™", 
sh–l_qu™
},

99 {"?", 
h–p
},

102 {
NULL
, 
unknown
}};

105 
	$sh–l_š™
()

107 
	}
}

110 
	$sh–l_¡¬t
()

112 
	`sh–l_ouut
("uIP command shell", "");

113 
	`sh–l_ouut
("Type '?'‡nd„eturn for help", "");

114 
	`sh–l_´om±
(
SHELL_PROMPT
);

115 
	}
}

118 
	$sh–l_šput
(*
cmd
)

120 
	`·r£
(
cmd
, 
·r£b
);

121 
	`sh–l_´om±
(
SHELL_PROMPT
);

122 
	}
}

	@apps/telnetd/shell.h

45 #iâdeà
__SHELL_H__


46 
	#__SHELL_H__


	)

54 
sh–l_š™
();

61 
sh–l_¡¬t
();

72 
sh–l_šput
(*
commªd
);

78 
sh–l_qu™
(*);

91 
sh–l_ouut
(*
¡r1
, *
¡r2
);

102 
sh–l_´om±
(*
´om±
);

	@apps/telnetd/telnetd.c

35 
	~"u.h
"

36 
	~"‹Ê‘d.h
"

37 
	~"memb.h
"

38 
	~"sh–l.h
"

40 
	~<¡ršg.h
>

42 
	#ISO_Æ
 0x0a

	)

43 
	#ISO_ü
 0x0d

	)

45 
	s‹Ê‘d_lše
 {

46 
	mlše
[
TELNETD_CONF_LINELEN
];

48 
MEMB
(
lšemem
, 
‹Ê‘d_lše
, 
TELNETD_CONF_NUMLINES
);

50 
	#STATE_NORMAL
 0

	)

51 
	#STATE_IAC
 1

	)

52 
	#STATE_WILL
 2

	)

53 
	#STATE_WONT
 3

	)

54 
	#STATE_DO
 4

	)

55 
	#STATE_DONT
 5

	)

56 
	#STATE_CLOSE
 6

	)

58 
‹Ê‘d_¡©e
 
	gs
;

60 
	#TELNET_IAC
 255

	)

61 
	#TELNET_WILL
 251

	)

62 
	#TELNET_WONT
 252

	)

63 
	#TELNET_DO
 253

	)

64 
	#TELNET_DONT
 254

	)

67 
	$®loc_lše
()

69  
	`memb_®loc
(&
lšemem
);

70 
	}
}

73 
	$d—Îoc_lše
(*
lše
)

75 
	`memb_ä“
(&
lšemem
, 
lše
);

76 
	}
}

79 
	$sh–l_qu™
(*
¡r
)

81 
s
.
¡©e
 = 
STATE_CLOSE
;

82 
	}
}

85 
	$£ndlše
(*
lše
)

87 
i
;

89 
i
 = 0; i < 
TELNETD_CONF_NUMLINES
; ++i) {

90 if(
s
.
lšes
[
i
] =ğ
NULL
) {

91 
s
.
lšes
[
i
] = 
lše
;

95 if(
i
 =ğ
TELNETD_CONF_NUMLINES
) {

96 
	`d—Îoc_lše
(
lše
);

98 
	}
}

101 
	$sh–l_´om±
(*
¡r
)

103 *
lše
;

104 
lše
 = 
	`®loc_lše
();

105 if(
lše
 !ğ
NULL
) {

106 
	`¡ºıy
(
lše
, 
¡r
, 
TELNETD_CONF_LINELEN
);

108 
	`£ndlše
(
lše
);

110 
	}
}

113 
	$sh–l_ouut
(*
¡r1
, *
¡r2
)

115 
Ën
;

116 *
lše
;

118 
lše
 = 
	`®loc_lše
();

119 if(
lše
 !ğ
NULL
) {

120 
Ën
 = 
	`¡¾’
(
¡r1
);

121 
	`¡ºıy
(
lše
, 
¡r1
, 
TELNETD_CONF_LINELEN
);

122 if(
Ën
 < 
TELNETD_CONF_LINELEN
) {

123 
	`¡ºıy
(
lše
 + 
Ën
, 
¡r2
, 
TELNETD_CONF_LINELEN
 -†en);

125 
Ën
 = 
	`¡¾’
(
lše
);

126 if(
Ën
 < 
TELNETD_CONF_LINELEN
 - 2) {

127 
lše
[
Ën
] = 
ISO_ü
;

128 
lše
[
Ën
+1] = 
ISO_Æ
;

129 
lše
[
Ën
+2] = 0;

132 
	`£ndlše
(
lše
);

134 
	}
}

137 
	$‹Ê‘d_š™
()

139 
	`u_li¡’
(
	`HTONS
(23));

140 
	`memb_š™
(&
lšemem
);

141 
	`sh–l_š™
();

142 
	}
}

145 
	$acked
()

147 
i
;

149 
s
.
num£Á
 > 0) {

150 
	`d—Îoc_lše
(
s
.
lšes
[0]);

151 
i
 = 1; i < 
TELNETD_CONF_NUMLINES
; ++i) {

152 
s
.
lšes
[
i
 - 1] = s.lines[i];

154 
s
.
lšes
[
TELNETD_CONF_NUMLINES
 - 1] = 
NULL
;

155 --
s
.
num£Á
;

157 
	}
}

160 
	$£ndd©a
()

162 *
buåŒ
, *
lš•Œ
;

163 
buæ’
, 
lš–’
;

165 
buåŒ
 = 
u_­pd©a
;

166 
buæ’
 = 0;

167 
s
.
num£Á
 = 0; s.num£Á < 
TELNETD_CONF_NUMLINES
 &&

168 
s
.
lšes
[s.
num£Á
] !ğ
NULL
 ; ++s.numsent) {

169 
lš•Œ
 = 
s
.
lšes
[s.
num£Á
];

170 
lš–’
 = 
	`¡¾’
(
lš•Œ
);

171 if(
lš–’
 > 
TELNETD_CONF_LINELEN
) {

172 
lš–’
 = 
TELNETD_CONF_LINELEN
;

174 if(
buæ’
 + 
lš–’
 < 
	`u_mss
()) {

175 
	`memıy
(
buåŒ
, 
lš•Œ
, 
lš–’
);

176 
buåŒ
 +ğ
lš–’
;

177 
buæ’
 +ğ
lš–’
;

182 
	`u_£nd
(
u_­pd©a
, 
buæ’
);

183 
	}
}

186 
	$şo£d
()

188 
i
;

190 
i
 = 0; i < 
TELNETD_CONF_NUMLINES
; ++i) {

191 if(
s
.
lšes
[
i
] !ğ
NULL
) {

192 
	`d—Îoc_lše
(
s
.
lšes
[
i
]);

195 
	}
}

198 
	$g‘_ch¬
(
u8_t
 
c
)

200 if(
c
 =ğ
ISO_ü
) {

204 
s
.
buf
[()s.
buåŒ
] = 
c
;

205 if(
s
.
buf
[()s.
buåŒ
] =ğ
ISO_Æ
 ||

206 
s
.
buåŒ
 =ğ(s.
buf
) - 1) {

207 if(
s
.
buåŒ
 > 0) {

208 
s
.
buf
[()s.
buåŒ
] = 0;

211 
	`sh–l_šput
(
s
.
buf
);

212 
s
.
buåŒ
 = 0;

214 ++
s
.
buåŒ
;

216 
	}
}

219 
	$£ndİt
(
u8_t
 
İtiÚ
, u8_ˆ
v®ue
)

221 *
lše
;

222 
lše
 = 
	`®loc_lše
();

223 if(
lše
 !ğ
NULL
) {

224 
lše
[0] = 
TELNET_IAC
;

225 
lše
[1] = 
İtiÚ
;

226 
lše
[2] = 
v®ue
;

227 
lše
[3] = 0;

228 
	`£ndlše
(
lše
);

230 
	}
}

233 
	$Ãwd©a
()

235 
u16_t
 
Ën
;

236 
u8_t
 
c
;

237 *
d©­Œ
;

240 
Ën
 = 
	`u_d©®’
();

241 
d©­Œ
 = (*)
u_­pd©a
;

243 
Ën
 > 0 && 
s
.
buåŒ
 < (s.
buf
)) {

244 
c
 = *
d©­Œ
;

245 ++
d©­Œ
;

246 --
Ën
;

247 
s
.
¡©e
) {

248 
STATE_IAC
:

249 if(
c
 =ğ
TELNET_IAC
) {

250 
	`g‘_ch¬
(
c
);

251 
s
.
¡©e
 = 
STATE_NORMAL
;

253 
c
) {

254 
TELNET_WILL
:

255 
s
.
¡©e
 = 
STATE_WILL
;

257 
TELNET_WONT
:

258 
s
.
¡©e
 = 
STATE_WONT
;

260 
TELNET_DO
:

261 
s
.
¡©e
 = 
STATE_DO
;

263 
TELNET_DONT
:

264 
s
.
¡©e
 = 
STATE_DONT
;

267 
s
.
¡©e
 = 
STATE_NORMAL
;

272 
STATE_WILL
:

274 
	`£ndİt
(
TELNET_DONT
, 
c
);

275 
s
.
¡©e
 = 
STATE_NORMAL
;

278 
STATE_WONT
:

280 
	`£ndİt
(
TELNET_DONT
, 
c
);

281 
s
.
¡©e
 = 
STATE_NORMAL
;

283 
STATE_DO
:

285 
	`£ndİt
(
TELNET_WONT
, 
c
);

286 
s
.
¡©e
 = 
STATE_NORMAL
;

288 
STATE_DONT
:

290 
	`£ndİt
(
TELNET_WONT
, 
c
);

291 
s
.
¡©e
 = 
STATE_NORMAL
;

293 
STATE_NORMAL
:

294 if(
c
 =ğ
TELNET_IAC
) {

295 
s
.
¡©e
 = 
STATE_IAC
;

297 
	`g‘_ch¬
(
c
);

305 
	}
}

308 
	$‹Ê‘d_­pÿÎ
()

310 
i
;

311 if(
	`u_cÚÃùed
()) {

313 
i
 = 0; i < 
TELNETD_CONF_NUMLINES
; ++i) {

314 
s
.
lšes
[
i
] = 
NULL
;

316 
s
.
buåŒ
 = 0;

317 
s
.
¡©e
 = 
STATE_NORMAL
;

319 
	`sh–l_¡¬t
();

322 if(
s
.
¡©e
 =ğ
STATE_CLOSE
) {

323 
s
.
¡©e
 = 
STATE_NORMAL
;

324 
	`u_şo£
();

328 if(
	`u_şo£d
() ||

329 
	`u_abÜ‹d
() ||

330 
	`u_timedout
()) {

331 
	`şo£d
();

334 if(
	`u_acked
()) {

335 
	`acked
();

338 if(
	`u_Ãwd©a
()) {

339 
	`Ãwd©a
();

342 if(
	`u_»xm™
() ||

343 
	`u_Ãwd©a
() ||

344 
	`u_acked
() ||

345 
	`u_cÚÃùed
() ||

346 
	`u_pŞl
()) {

347 
	`£ndd©a
();

349 
	}
}

	@apps/telnetd/telnetd.h

35 #iâdeà
__TELNETD_H__


36 
	#__TELNETD_H__


	)

38 
	~"uİt.h
"

40 
‹Ê‘d_­pÿÎ
();

42 #iâdeà
TELNETD_CONF_LINELEN


43 
	#TELNETD_CONF_LINELEN
 40

	)

45 #iâdeà
TELNETD_CONF_NUMLINES


46 
	#TELNETD_CONF_NUMLINES
 16

	)

49 
	s‹Ê‘d_¡©e
 {

50 *
	mlšes
[
TELNETD_CONF_NUMLINES
];

51 
	mbuf
[
TELNETD_CONF_LINELEN
];

52 
	mbuåŒ
;

53 
u8_t
 
	mnum£Á
;

54 
u8_t
 
	m¡©e
;

57 
‹Ê‘d_¡©e
 
	tu_tı_­p¡©e_t
;

59 #iâdeà
UIP_APPCALL


60 
	#UIP_APPCALL
 
‹Ê‘d_­pÿÎ


	)

	@apps/webclient/webclient-strings.c

1 cÚ¡ 
	gh‰p_h‰p
[8] =

4 cÚ¡ 
	gh‰p_200
[5] =

7 cÚ¡ 
	gh‰p_301
[5] =

10 cÚ¡ 
	gh‰p_302
[5] =

13 cÚ¡ 
	gh‰p_g‘
[5] =

16 cÚ¡ 
	gh‰p_10
[9] =

19 cÚ¡ 
	gh‰p_11
[9] =

22 cÚ¡ 
	gh‰p_cÚ‹Á_ty³
[15] =

25 cÚ¡ 
	gh‰p_‹xthtml
[10] =

28 cÚ¡ 
	gh‰p_loÿtiÚ
[11] =

31 cÚ¡ 
	gh‰p_ho¡
[7] =

34 cÚ¡ 
	gh‰p_üÆ
[3] =

37 cÚ¡ 
	gh‰p_šdex_html
[12] =

40 cÚ¡ 
	gh‰p_404_html
[10] =

43 cÚ¡ 
	gh‰p_cÚ‹Á_ty³_html
[28] =

46 cÚ¡ 
	gh‰p_cÚ‹Á_ty³_css
 [27] =

49 cÚ¡ 
	gh‰p_cÚ‹Á_ty³_‹xt
[28] =

52 cÚ¡ 
	gh‰p_cÚ‹Á_ty³_²g
 [28] =

55 cÚ¡ 
	gh‰p_cÚ‹Á_ty³_gif
 [28] =

58 cÚ¡ 
	gh‰p_cÚ‹Á_ty³_jpg
 [29] =

61 cÚ¡ 
	gh‰p_cÚ‹Á_ty³_bš¬y
[43] =

64 cÚ¡ 
	gh‰p_html
[6] =

67 cÚ¡ 
	gh‰p_shtml
[7] =

70 cÚ¡ 
	gh‰p_htm
[5] =

73 cÚ¡ 
	gh‰p_css
[5] =

76 cÚ¡ 
	gh‰p_²g
[5] =

79 cÚ¡ 
	gh‰p_gif
[5] =

82 cÚ¡ 
	gh‰p_jpg
[5] =

85 cÚ¡ 
	gh‰p_‹xt
[6] =

88 cÚ¡ 
	gh‰p_txt
[5] =

91 cÚ¡ 
	gh‰p_u£r_ag’t_f›lds
[77] =

	@apps/webclient/webclient-strings.h

1 cÚ¡ 
h‰p_h‰p
[8];

2 cÚ¡ 
h‰p_200
[5];

3 cÚ¡ 
h‰p_301
[5];

4 cÚ¡ 
h‰p_302
[5];

5 cÚ¡ 
h‰p_g‘
[5];

6 cÚ¡ 
h‰p_10
[9];

7 cÚ¡ 
h‰p_11
[9];

8 cÚ¡ 
h‰p_cÚ‹Á_ty³
[15];

9 cÚ¡ 
h‰p_‹xthtml
[10];

10 cÚ¡ 
h‰p_loÿtiÚ
[11];

11 cÚ¡ 
h‰p_ho¡
[7];

12 cÚ¡ 
h‰p_üÆ
[3];

13 cÚ¡ 
h‰p_šdex_html
[12];

14 cÚ¡ 
h‰p_404_html
[10];

15 cÚ¡ 
h‰p_cÚ‹Á_ty³_html
[28];

16 cÚ¡ 
h‰p_cÚ‹Á_ty³_css
 [27];

17 cÚ¡ 
h‰p_cÚ‹Á_ty³_‹xt
[28];

18 cÚ¡ 
h‰p_cÚ‹Á_ty³_²g
 [28];

19 cÚ¡ 
h‰p_cÚ‹Á_ty³_gif
 [28];

20 cÚ¡ 
h‰p_cÚ‹Á_ty³_jpg
 [29];

21 cÚ¡ 
h‰p_cÚ‹Á_ty³_bš¬y
[43];

22 cÚ¡ 
h‰p_html
[6];

23 cÚ¡ 
h‰p_shtml
[7];

24 cÚ¡ 
h‰p_htm
[5];

25 cÚ¡ 
h‰p_css
[5];

26 cÚ¡ 
h‰p_²g
[5];

27 cÚ¡ 
h‰p_gif
[5];

28 cÚ¡ 
h‰p_jpg
[5];

29 cÚ¡ 
h‰p_‹xt
[6];

30 cÚ¡ 
h‰p_txt
[5];

31 cÚ¡ 
h‰p_u£r_ag’t_f›lds
[77];

	@apps/webclient/webclient.c

58 
	~"u.h
"

59 
	~"ulib.h
"

60 
	~"webş›Á.h
"

61 
	~"»sŞv.h
"

63 
	~<¡ršg.h
>

65 
	#WEBCLIENT_TIMEOUT
 100

	)

67 
	#WEBCLIENT_STATE_STATUSLINE
 0

	)

68 
	#WEBCLIENT_STATE_HEADERS
 1

	)

69 
	#WEBCLIENT_STATE_DATA
 2

	)

70 
	#WEBCLIENT_STATE_CLOSE
 3

	)

72 
	#HTTPFLAG_NONE
 0

	)

73 
	#HTTPFLAG_OK
 1

	)

74 
	#HTTPFLAG_MOVED
 2

	)

75 
	#HTTPFLAG_ERROR
 3

	)

78 
	#ISO_Æ
 0x0a

	)

79 
	#ISO_ü
 0x0d

	)

80 
	#ISO_¥aû
 0x20

	)

83 
webş›Á_¡©e
 
	gs
;

87 
	$webş›Á_mim‘y³
()

89  
s
.
mim‘y³
;

90 
	}
}

93 
	$webş›Á_f’ame
()

95  
s
.
fe
;

96 
	}
}

99 
	$webş›Á_ho¡Çme
()

101  
s
.
ho¡
;

102 
	}
}

105 
	$webş›Á_pÜt
()

107  
s
.
pÜt
;

108 
	}
}

111 
	$webş›Á_š™
()

114 
	}
}

117 
	$š™_cÚÃùiÚ
()

119 
s
.
¡©e
 = 
WEBCLIENT_STATE_STATUSLINE
;

121 
s
.
g‘»que¡Ëá
 = (
h‰p_g‘
) - 1 + 1 +

122 (
h‰p_10
) - 1 +

123 (
h‰p_üÆ
) - 1 +

124 (
h‰p_ho¡
) - 1 +

125 (
h‰p_üÆ
) - 1 +

126 
	`¡¾’
(
h‰p_u£r_ag’t_f›lds
) +

127 
	`¡¾’
(
s
.
fe
è+ sŒËn(s.
ho¡
);

128 
s
.
g‘»que¡±r
 = 0;

130 
s
.
h‰ph—d”lš•Œ
 = 0;

131 
	}
}

134 
	$webş›Á_şo£
()

136 
s
.
¡©e
 = 
WEBCLIENT_STATE_CLOSE
;

137 
	}
}

140 
	$webş›Á_g‘
(*
ho¡
, 
u16_t
 
pÜt
, *
fe
)

142 
u_cÚn
 *
cÚn
;

143 
u_addr_t
 *
addr
;

144 
u_addr_t
 
addr
;

147 
addr
 = &
addr
;

148 if(
	`ulib_addrcÚv
(
ho¡
, (*)
addr
) == 0) {

149 
addr
 = (
u_addr_t
 *)
	`»sŞv_lookup
(
ho¡
);

151 if(
addr
 =ğ
NULL
) {

156 
cÚn
 = 
	`u_cÚÃù
(
addr
, 
	`htÚs
(
pÜt
));

158 if(
cÚn
 =ğ
NULL
) {

162 
s
.
pÜt
 =…ort;

163 
	`¡ºıy
(
s
.
fe
, file, (s.file));

164 
	`¡ºıy
(
s
.
ho¡
, host, (s.host));

166 
	`š™_cÚÃùiÚ
();

168 
	}
}

171 
	$cİy_¡ršg
(*
de¡
,

172 cÚ¡ *
¤c
, 
Ën
)

174 
	`¡ºıy
(
de¡
, 
¤c
, 
Ën
);

175  
de¡
 + 
Ën
;

176 
	}
}

179 
	$£ndd©a
()

181 
u16_t
 
Ën
;

182 *
g‘»que¡
;

183 *
ıŒ
;

185 if(
s
.
g‘»que¡Ëá
 > 0) {

186 
ıŒ
 = 
g‘»que¡
 = (*)
u_­pd©a
;

188 
ıŒ
 = 
	`cİy_¡ršg
(ıŒ, 
h‰p_g‘
, (http_get) - 1);

189 
ıŒ
 = 
	`cİy_¡ršg
(ıŒ, 
s
.
fe
, 
	`¡¾’
(s.file));

190 *
ıŒ
++ = 
ISO_¥aû
;

191 
ıŒ
 = 
	`cİy_¡ršg
(ıŒ, 
h‰p_10
, (http_10) - 1);

193 
ıŒ
 = 
	`cİy_¡ršg
(ıŒ, 
h‰p_üÆ
, (http_crnl) - 1);

195 
ıŒ
 = 
	`cİy_¡ršg
(ıŒ, 
h‰p_ho¡
, (http_host) - 1);

196 
ıŒ
 = 
	`cİy_¡ršg
(ıŒ, 
s
.
ho¡
, 
	`¡¾’
(s.host));

197 
ıŒ
 = 
	`cİy_¡ršg
(ıŒ, 
h‰p_üÆ
, (http_crnl) - 1);

199 
ıŒ
 = 
	`cİy_¡ršg
(ıŒ, 
h‰p_u£r_ag’t_f›lds
,

200 
	`¡¾’
(
h‰p_u£r_ag’t_f›lds
));

202 
Ën
 = 
s
.
g‘»que¡Ëá
 > 
	`u_mss
()?

203 
	`u_mss
():

204 
s
.
g‘»que¡Ëá
;

205 
	`u_£nd
(&(
g‘»que¡
[
s
.
g‘»que¡±r
]), 
Ën
);

207 
	}
}

210 
	$acked
()

212 
u16_t
 
Ën
;

214 if(
s
.
g‘»que¡Ëá
 > 0) {

215 
Ën
 = 
s
.
g‘»que¡Ëá
 > 
	`u_mss
()?

216 
	`u_mss
():

217 
s
.
g‘»que¡Ëá
;

218 
s
.
g‘»que¡Ëá
 -ğ
Ën
;

219 
s
.
g‘»que¡±r
 +ğ
Ën
;

221 
	}
}

223 
u16_t


224 
	$·r£_¡©u¦še
(
u16_t
 
Ën
)

226 *
ıŒ
;

228 
Ën
 > 0 && 
s
.
h‰ph—d”lš•Œ
 < (s.
h‰ph—d”lše
)) {

229 
s
.
h‰ph—d”lše
[s.
h‰ph—d”lš•Œ
] = *(*)
u_­pd©a
;

230 ++((*)
u_­pd©a
);

231 --
Ën
;

232 if(
s
.
h‰ph—d”lše
[s.
h‰ph—d”lš•Œ
] =ğ
ISO_Æ
) {

234 if((
	`¡ºcmp
(
s
.
h‰ph—d”lše
, 
h‰p_10
,

235 (
h‰p_10
) - 1) == 0) ||

236 (
	`¡ºcmp
(
s
.
h‰ph—d”lše
, 
h‰p_11
,

237 (
h‰p_11
) - 1) == 0)) {

238 
ıŒ
 = &(
s
.
h‰ph—d”lše
[9]);

239 
s
.
h‰pæag
 = 
HTTPFLAG_NONE
;

240 if(
	`¡ºcmp
(
ıŒ
, 
h‰p_200
, (http_200) - 1) == 0) {

242 
s
.
h‰pæag
 = 
HTTPFLAG_OK
;

243 } if(
	`¡ºcmp
(
ıŒ
, 
h‰p_301
, (http_301) - 1) == 0 ||

244 
	`¡ºcmp
(
ıŒ
, 
h‰p_302
, (http_302) - 1) == 0) {

247 
s
.
h‰pæag
 = 
HTTPFLAG_MOVED
;

249 
s
.
h‰ph—d”lše
[s.
h‰ph—d”lš•Œ
 - 1] = 0;

252 
	`u_abÜt
();

253 
	`webş›Á_abÜ‹d
();

259 
s
.
h‰ph—d”lš•Œ
 = 0;

260 
s
.
¡©e
 = 
WEBCLIENT_STATE_HEADERS
;

263 ++
s
.
h‰ph—d”lš•Œ
;

266  
Ën
;

267 
	}
}

270 
	$ÿ£cmp
(*
¡r1
, cÚ¡ *
¡r2
, 
Ën
)

272 
c
;

274 
Ën
 > 0) {

275 
c
 = *
¡r1
;

277 if(
c
 & 0x40) {

278 
c
 |= 0x20;

280 if(*
¡r2
 !ğ
c
) {

283 ++
¡r1
;

284 ++
¡r2
;

285 --
Ën
;

288 
	}
}

290 
u16_t


291 
	$·r£_h—d”s
(
u16_t
 
Ën
)

293 *
ıŒ
;

294 
i
;

296 
Ën
 > 0 && 
s
.
h‰ph—d”lš•Œ
 < (s.
h‰ph—d”lše
)) {

297 
s
.
h‰ph—d”lše
[s.
h‰ph—d”lš•Œ
] = *(*)
u_­pd©a
;

298 ++((*)
u_­pd©a
);

299 --
Ën
;

300 if(
s
.
h‰ph—d”lše
[s.
h‰ph—d”lš•Œ
] =ğ
ISO_Æ
) {

303 if(
s
.
h‰ph—d”lše
[0] =ğ
ISO_ü
) {

307 
s
.
¡©e
 = 
WEBCLIENT_STATE_DATA
;

308  
Ën
;

311 
s
.
h‰ph—d”lše
[s.
h‰ph—d”lš•Œ
 - 1] = 0;

313 if(
	`ÿ£cmp
(
s
.
h‰ph—d”lše
, 
h‰p_cÚ‹Á_ty³
,

314 (
h‰p_cÚ‹Á_ty³
) - 1) == 0) {

316 
ıŒ
 = 
	`¡rchr
(
s
.
h‰ph—d”lše
, ';');

317 if(
ıŒ
 !ğ
NULL
) {

318 *
ıŒ
 = 0;

320 
	`¡ºıy
(
s
.
mim‘y³
, s.
h‰ph—d”lše
 +

321 (
h‰p_cÚ‹Á_ty³
è- 1, (
s
.
mim‘y³
));

322 } if(
	`ÿ£cmp
(
s
.
h‰ph—d”lše
, 
h‰p_loÿtiÚ
,

323 (
h‰p_loÿtiÚ
) - 1) == 0) {

324 
ıŒ
 = 
s
.
h‰ph—d”lše
 +

325 (
h‰p_loÿtiÚ
) - 1;

327 if(
	`¡ºcmp
(
ıŒ
, 
h‰p_h‰p
, 7) == 0) {

328 
ıŒ
 += 7;

329 
i
 = 0; i < 
s
.
h‰ph—d”lš•Œ
 - 7; ++i) {

330 if(*
ıŒ
 == 0 ||

331 *
ıŒ
 == '/' ||

332 *
ıŒ
 == ' ' ||

333 *
ıŒ
 == ':') {

334 
s
.
ho¡
[
i
] = 0;

337 
s
.
ho¡
[
i
] = *
ıŒ
;

338 ++
ıŒ
;

341 
	`¡ºıy
(
s
.
fe
, 
ıŒ
, (s.file));

348 
s
.
h‰ph—d”lš•Œ
 = 0;

350 ++
s
.
h‰ph—d”lš•Œ
;

353  
Ën
;

354 
	}
}

357 
	$Ãwd©a
()

359 
u16_t
 
Ën
;

361 
Ën
 = 
	`u_d©®’
();

363 if(
s
.
¡©e
 =ğ
WEBCLIENT_STATE_STATUSLINE
) {

364 
Ën
 = 
	`·r£_¡©u¦še
(len);

367 if(
s
.
¡©e
 =ğ
WEBCLIENT_STATE_HEADERS
 && 
Ën
 > 0) {

368 
Ën
 = 
	`·r£_h—d”s
(len);

371 if(
Ën
 > 0 && 
s
.
¡©e
 =ğ
WEBCLIENT_STATE_DATA
 &&

372 
s
.
h‰pæag
 !ğ
HTTPFLAG_MOVED
) {

373 
	`webş›Á_d©ahªdËr
((*)
u_­pd©a
, 
Ën
);

375 
	}
}

378 
	$webş›Á_­pÿÎ
()

380 if(
	`u_cÚÃùed
()) {

381 
s
.
tim”
 = 0;

382 
s
.
¡©e
 = 
WEBCLIENT_STATE_STATUSLINE
;

383 
	`£ndd©a
();

384 
	`webş›Á_cÚÃùed
();

388 if(
s
.
¡©e
 =ğ
WEBCLIENT_STATE_CLOSE
) {

389 
	`webş›Á_şo£d
();

390 
	`u_abÜt
();

394 if(
	`u_abÜ‹d
()) {

395 
	`webş›Á_abÜ‹d
();

397 if(
	`u_timedout
()) {

398 
	`webş›Á_timedout
();

402 if(
	`u_acked
()) {

403 
s
.
tim”
 = 0;

404 
	`acked
();

406 if(
	`u_Ãwd©a
()) {

407 
s
.
tim”
 = 0;

408 
	`Ãwd©a
();

410 if(
	`u_»xm™
() ||

411 
	`u_Ãwd©a
() ||

412 
	`u_acked
()) {

413 
	`£ndd©a
();

414 } if(
	`u_pŞl
()) {

415 ++
s
.
tim”
;

416 if(
s
.
tim”
 =ğ
WEBCLIENT_TIMEOUT
) {

417 
	`webş›Á_timedout
();

418 
	`u_abÜt
();

424 if(
	`u_şo£d
()) {

425 if(
s
.
h‰pæag
 !ğ
HTTPFLAG_MOVED
) {

427 
	`webş›Á_d©ahªdËr
(
NULL
, 0);

429 if(
	`»sŞv_lookup
(
s
.
ho¡
è=ğ
NULL
) {

430 
	`»sŞv_qu”y
(
s
.
ho¡
);

432 
	`webş›Á_g‘
(
s
.
ho¡
, s.
pÜt
, s.
fe
);

435 
	}
}

	@apps/webclient/webclient.h

46 #iâdeà
__WEBCLIENT_H__


47 
	#__WEBCLIENT_H__


	)

50 
	~"webş›Á-¡ršgs.h
"

51 
	~"uİt.h
"

53 
	#WEBCLIENT_CONF_MAX_URLLEN
 100

	)

55 
	swebş›Á_¡©e
 {

56 
u8_t
 
	mtim”
;

57 
u8_t
 
	m¡©e
;

58 
u8_t
 
	mh‰pæag
;

60 
u16_t
 
	mpÜt
;

61 
	mho¡
[40];

62 
	mfe
[
WEBCLIENT_CONF_MAX_URLLEN
];

63 
u16_t
 
	mg‘»que¡±r
;

64 
u16_t
 
	mg‘»que¡Ëá
;

66 
	mh‰ph—d”lše
[200];

67 
u16_t
 
	mh‰ph—d”lš•Œ
;

69 
	mmim‘y³
[32];

72 
webş›Á_¡©e
 
	tu_tı_­p¡©e_t
;

73 
	#UIP_APPCALL
 
webş›Á_­pÿÎ


	)

90 
webş›Á_d©ahªdËr
(*
d©a
, 
u16_t
 
Ën
);

99 
webş›Á_cÚÃùed
();

108 
webş›Á_timedout
();

118 
webş›Á_abÜ‹d
();

127 
webş›Á_şo£d
();

134 
webş›Á_š™
();

172 
webş›Á_g‘
(*
ho¡
, 
u16_t
 
pÜt
, *
fe
);

177 
webş›Á_şo£
();

178 
webş›Á_­pÿÎ
();

186 *
webş›Á_mim‘y³
();

198 *
webş›Á_f’ame
();

210 *
webş›Á_ho¡Çme
();

222 
webş›Á_pÜt
();

	@apps/webserver/http-strings.c

1 cÚ¡ 
	gh‰p_h‰p
[8] =

4 cÚ¡ 
	gh‰p_200
[5] =

7 cÚ¡ 
	gh‰p_301
[5] =

10 cÚ¡ 
	gh‰p_302
[5] =

13 cÚ¡ 
	gh‰p_g‘
[5] =

16 cÚ¡ 
	gh‰p_10
[9] =

19 cÚ¡ 
	gh‰p_11
[9] =

22 cÚ¡ 
	gh‰p_cÚ‹Á_ty³
[15] =

25 cÚ¡ 
	gh‰p_‹xthtml
[10] =

28 cÚ¡ 
	gh‰p_loÿtiÚ
[11] =

31 cÚ¡ 
	gh‰p_ho¡
[7] =

34 cÚ¡ 
	gh‰p_üÆ
[3] =

37 cÚ¡ 
	gh‰p_šdex_html
[12] =

40 cÚ¡ 
	gh‰p_404_html
[10] =

43 cÚ¡ 
	gh‰p_»ã»r
[9] =

46 cÚ¡ 
	gh‰p_h—d”_200
[84] =

49 cÚ¡ 
	gh‰p_h—d”_404
[91] =

52 cÚ¡ 
	gh‰p_cÚ‹Á_ty³_¶aš
[29] =

55 cÚ¡ 
	gh‰p_cÚ‹Á_ty³_html
[28] =

58 cÚ¡ 
	gh‰p_cÚ‹Á_ty³_css
 [27] =

61 cÚ¡ 
	gh‰p_cÚ‹Á_ty³_‹xt
[28] =

64 cÚ¡ 
	gh‰p_cÚ‹Á_ty³_²g
 [28] =

67 cÚ¡ 
	gh‰p_cÚ‹Á_ty³_gif
 [28] =

70 cÚ¡ 
	gh‰p_cÚ‹Á_ty³_jpg
 [29] =

73 cÚ¡ 
	gh‰p_cÚ‹Á_ty³_bš¬y
[43] =

76 cÚ¡ 
	gh‰p_html
[6] =

79 cÚ¡ 
	gh‰p_shtml
[7] =

82 cÚ¡ 
	gh‰p_htm
[5] =

85 cÚ¡ 
	gh‰p_css
[5] =

88 cÚ¡ 
	gh‰p_²g
[5] =

91 cÚ¡ 
	gh‰p_gif
[5] =

94 cÚ¡ 
	gh‰p_jpg
[5] =

97 cÚ¡ 
	gh‰p_‹xt
[5] =

100 cÚ¡ 
	gh‰p_txt
[5] =

	@apps/webserver/http-strings.h

1 cÚ¡ 
h‰p_h‰p
[8];

2 cÚ¡ 
h‰p_200
[5];

3 cÚ¡ 
h‰p_301
[5];

4 cÚ¡ 
h‰p_302
[5];

5 cÚ¡ 
h‰p_g‘
[5];

6 cÚ¡ 
h‰p_10
[9];

7 cÚ¡ 
h‰p_11
[9];

8 cÚ¡ 
h‰p_cÚ‹Á_ty³
[15];

9 cÚ¡ 
h‰p_‹xthtml
[10];

10 cÚ¡ 
h‰p_loÿtiÚ
[11];

11 cÚ¡ 
h‰p_ho¡
[7];

12 cÚ¡ 
h‰p_üÆ
[3];

13 cÚ¡ 
h‰p_šdex_html
[12];

14 cÚ¡ 
h‰p_404_html
[10];

15 cÚ¡ 
h‰p_»ã»r
[9];

16 cÚ¡ 
h‰p_h—d”_200
[84];

17 cÚ¡ 
h‰p_h—d”_404
[91];

18 cÚ¡ 
h‰p_cÚ‹Á_ty³_¶aš
[29];

19 cÚ¡ 
h‰p_cÚ‹Á_ty³_html
[28];

20 cÚ¡ 
h‰p_cÚ‹Á_ty³_css
 [27];

21 cÚ¡ 
h‰p_cÚ‹Á_ty³_‹xt
[28];

22 cÚ¡ 
h‰p_cÚ‹Á_ty³_²g
 [28];

23 cÚ¡ 
h‰p_cÚ‹Á_ty³_gif
 [28];

24 cÚ¡ 
h‰p_cÚ‹Á_ty³_jpg
 [29];

25 cÚ¡ 
h‰p_cÚ‹Á_ty³_bš¬y
[43];

26 cÚ¡ 
h‰p_html
[6];

27 cÚ¡ 
h‰p_shtml
[7];

28 cÚ¡ 
h‰p_htm
[5];

29 cÚ¡ 
h‰p_css
[5];

30 cÚ¡ 
h‰p_²g
[5];

31 cÚ¡ 
h‰p_gif
[5];

32 cÚ¡ 
h‰p_jpg
[5];

33 cÚ¡ 
h‰p_‹xt
[5];

34 cÚ¡ 
h‰p_txt
[5];

	@apps/webserver/httpd-cgi.c

48 
	~"u.h
"

49 
	~"psock.h
"

50 
	~"h‰pd.h
"

51 
	~"h‰pd-cgi.h
"

52 
	~"h‰pd-fs.h
"

54 
	~<¡dio.h
>

55 
	~<¡ršg.h
>

57 
HTTPD_CGI_CALL
(
fe
, "fe-¡©s", 
fe_¡©s
);

58 
HTTPD_CGI_CALL
(
tı
, "tı-cÚÃùiÚs", 
tı_¡©s
);

59 
HTTPD_CGI_CALL
(
Ãt
, "Ãt-¡©s", 
Ãt_¡©s
);

61 cÚ¡ 
h‰pd_cgi_ÿÎ
 *
	gÿÎs
[] = { &
fe
, &
tı
, &
Ãt
, 
NULL
 };

65 
PT_THREAD
(
	$nuÎfunùiÚ
(
h‰pd_¡©e
 *
s
, *
±r
))

67 
	`PSOCK_BEGIN
(&
s
->
sout
);

68 
	`PSOCK_END
(&
s
->
sout
);

69 
	}
}

71 
h‰pd_cgifunùiÚ


72 
	$h‰pd_cgi
(*
Çme
)

74 cÚ¡ 
h‰pd_cgi_ÿÎ
 **
f
;

77 
f
 = 
ÿÎs
; *à!ğ
NULL
; ++f) {

78 if(
	`¡ºcmp
((*
f
)->
Çme
,‚ame, 
	`¡¾’
((*f)->name)) == 0) {

79  (*
f
)->
funùiÚ
;

82  
nuÎfunùiÚ
;

83 
	}
}

86 
	$g’”©e_fe_¡©s
(*
¬g
)

88 *
f
 = (*)
¬g
;

89  
	`¢´štf
((*)
u_­pd©a
, 
UIP_APPDATA_SIZE
, "%5u", 
	`h‰pd_fs_couÁ
(
f
));

90 
	}
}

93 
PT_THREAD
(
	$fe_¡©s
(
h‰pd_¡©e
 *
s
, *
±r
))

95 
	`PSOCK_BEGIN
(&
s
->
sout
);

97 
	`PSOCK_GENERATOR_SEND
(&
s
->
sout
, 
g’”©e_fe_¡©s
, 
	`¡rchr
(
±r
, ' ') + 1);

99 
	`PSOCK_END
(&
s
->
sout
);

100 
	}
}

102 cÚ¡ 
	gşo£d
[] =

104 cÚ¡ 
	gsyn_rcvd
[] =

107 cÚ¡ 
	gsyn_£Á
[] =

110 cÚ¡ 
	ge¡ablished
[] =

113 cÚ¡ 
	gfš_wa™_1
[] =

116 cÚ¡ 
	gfš_wa™_2
[] =

119 cÚ¡ 
	gşosšg
[] =

122 cÚ¡ 
	gtime_wa™
[] =

125 cÚ¡ 
	gÏ¡_ack
[] =

129 cÚ¡ *
	g¡©es
[] = {

130 
şo£d
,

131 
syn_rcvd
,

132 
syn_£Á
,

133 
e¡ablished
,

134 
fš_wa™_1
,

135 
fš_wa™_2
,

136 
şosšg
,

137 
time_wa™
,

138 
Ï¡_ack
};

142 
	$g’”©e_tı_¡©s
(*
¬g
)

144 
u_cÚn
 *
cÚn
;

145 
h‰pd_¡©e
 *
s
 = (h‰pd_¡©*)
¬g
;

147 
cÚn
 = &
u_cÚns
[
s
->
couÁ
];

148  
	`¢´štf
((*)
u_­pd©a
, 
UIP_APPDATA_SIZE
,

150 
	`htÚs
(
cÚn
->
ÍÜt
),

151 
	`htÚs
(
cÚn
->
raddr
[0]) >> 8,

152 
	`htÚs
(
cÚn
->
raddr
[0]) & 0xff,

153 
	`htÚs
(
cÚn
->
raddr
[1]) >> 8,

154 
	`htÚs
(
cÚn
->
raddr
[1]) & 0xff,

155 
	`htÚs
(
cÚn
->
½Üt
),

156 
¡©es
[
cÚn
->
tı¡©eæags
 & 
UIP_TS_MASK
],

157 
cÚn
->
Ätx
,

158 
cÚn
->
tim”
,

159 (
	`u_out¡ªdšg
(
cÚn
))? '*':' ',

160 (
	`u_¡İ³d
(
cÚn
))? '!':' ');

161 
	}
}

164 
PT_THREAD
(
	$tı_¡©s
(
h‰pd_¡©e
 *
s
, *
±r
))

167 
	`PSOCK_BEGIN
(&
s
->
sout
);

169 
s
->
couÁ
 = 0; s->couÁ < 
UIP_CONNS
; ++s->count) {

170 if((
u_cÚns
[
s
->
couÁ
].
tı¡©eæags
 & 
UIP_TS_MASK
è!ğ
UIP_CLOSED
) {

171 
	`PSOCK_GENERATOR_SEND
(&
s
->
sout
, 
g’”©e_tı_¡©s
, s);

175 
	`PSOCK_END
(&
s
->
sout
);

176 
	}
}

179 
	$g’”©e_Ãt_¡©s
(*
¬g
)

181 
h‰pd_¡©e
 *
s
 = (h‰pd_¡©*)
¬g
;

182  
	`¢´štf
((*)
u_­pd©a
, 
UIP_APPDATA_SIZE
,

183 "%5u\n", ((
u_¡©s_t
 *)&
u_¡©
)[
s
->
couÁ
]);

184 
	}
}

187 
PT_THREAD
(
	$Ãt_¡©s
(
h‰pd_¡©e
 *
s
, *
±r
))

189 
	`PSOCK_BEGIN
(&
s
->
sout
);

191 #ià
UIP_STATISTICS


193 
s
->
couÁ
 = 0; s->couÁ < (
u_¡©
è/ (
u_¡©s_t
);

194 ++
s
->
couÁ
) {

195 
	`PSOCK_GENERATOR_SEND
(&
s
->
sout
, 
g’”©e_Ãt_¡©s
, s);

200 
	`PSOCK_END
(&
s
->
sout
);

201 
	}
}

	@apps/webserver/httpd-cgi.h

50 #iâdeà
__HTTPD_CGI_H__


51 
	#__HTTPD_CGI_H__


	)

53 
	~"psock.h
"

54 
	~"h‰pd.h
"

56 
PT_THREAD
((* 
	th‰pd_cgifunùiÚ
)(
	th‰pd_¡©e
 *, *));

58 
h‰pd_cgifunùiÚ
 
h‰pd_cgi
(*
Çme
);

60 
	sh‰pd_cgi_ÿÎ
 {

61 cÚ¡ *
	mÇme
;

62 cÚ¡ 
h‰pd_cgifunùiÚ
 
	mfunùiÚ
;

77 
	#HTTPD_CGI_CALL
(
Çme
, 
¡r
, 
funùiÚ
) \

78 
	`PT_THREAD
(
	`funùiÚ
(
h‰pd_¡©e
 *, *)); \

79 cÚ¡ 
h‰pd_cgi_ÿÎ
 
Çme
 = {
¡r
, 
funùiÚ
}

	)

81 
h‰pd_cgi_š™
();

	@apps/webserver/httpd-fs.c

36 
	~"h‰pd.h
"

37 
	~"h‰pd-fs.h
"

38 
	~"h‰pd-fsd©a.h
"

40 #iâdeà
NULL


41 
	#NULL
 0

	)

44 
	~"h‰pd-fsd©a.c
"

46 #ià
HTTPD_FS_STATISTICS


47 
u16_t
 
	gcouÁ
[
HTTPD_FS_NUMFILES
];

51 
u8_t


52 
	$h‰pd_fs_¡rcmp
(cÚ¡ *
¡r1
, cÚ¡ *
¡r2
)

54 
u8_t
 
i
;

55 
i
 = 0;

56 
loİ
:

58 if(
¡r2
[
i
] == 0 ||

59 
¡r1
[
i
] == '\r' ||

60 
¡r1
[
i
] == '\n') {

64 if(
¡r1
[
i
] !ğ
¡r2
[i]) {

69 ++
i
;

70 
loİ
;

71 
	}
}

74 
	$h‰pd_fs_İ’
(cÚ¡ *
Çme
, 
h‰pd_fs_fe
 *
fe
)

76 #ià
HTTPD_FS_STATISTICS


77 
u16_t
 
i
 = 0;

79 
h‰pd_fsd©a_fe_nocÚ¡
 *
f
;

81 
f
 = (
h‰pd_fsd©a_fe_nocÚ¡
 *)
HTTPD_FS_ROOT
;

82 
f
 !ğ
NULL
;

83 
f
 = (
h‰pd_fsd©a_fe_nocÚ¡
 *)f->
Ãxt
) {

85 if(
	`h‰pd_fs_¡rcmp
(
Çme
, 
f
->name) == 0) {

86 
fe
->
d©a
 = 
f
->data;

87 
fe
->
Ën
 = 
f
->len;

88 #ià
HTTPD_FS_STATISTICS


89 ++
couÁ
[
i
];

93 #ià
HTTPD_FS_STATISTICS


94 ++
i
;

99 
	}
}

102 
	$h‰pd_fs_š™
()

104 #ià
HTTPD_FS_STATISTICS


105 
u16_t
 
i
;

106 
i
 = 0; i < 
HTTPD_FS_NUMFILES
; i++) {

107 
couÁ
[
i
] = 0;

110 
	}
}

112 #ià
HTTPD_FS_STATISTICS


113 
u16_t
 
	gh‰pd_fs_couÁ


114 (*
	gÇme
)

116 
h‰pd_fsd©a_fe_nocÚ¡
 *
	gf
;

117 
u16_t
 
	gi
;

119 
	gi
 = 0;

120 
	gf
 = (
h‰pd_fsd©a_fe_nocÚ¡
 *)
HTTPD_FS_ROOT
;

121 
	gf
 !ğ
NULL
;

122 
	gf
 = (
h‰pd_fsd©a_fe_nocÚ¡
 *)
f
->
Ãxt
) {

124 if(
h‰pd_fs_¡rcmp
(
Çme
, 
f
->name) == 0) {

125  
couÁ
[
i
];

127 ++
	gi
;

	@apps/webserver/httpd-fs.h

35 #iâdeà
__HTTPD_FS_H__


36 
	#__HTTPD_FS_H__


	)

38 
	#HTTPD_FS_STATISTICS
 1

	)

40 
	sh‰pd_fs_fe
 {

41 *
	md©a
;

42 
	mËn
;

47 
h‰pd_fs_İ’
(cÚ¡ *
Çme
, 
h‰pd_fs_fe
 *
fe
);

49 #ifdeà
HTTPD_FS_STATISTICS


50 #ià
HTTPD_FS_STATISTICS
 == 1

51 
u16_t
 
h‰pd_fs_couÁ
(*
Çme
);

55 
h‰pd_fs_š™
();

	@apps/webserver/httpd-fsdata.c

1 cÚ¡ 
	gd©a_´oûs£s_shtml
[] = {

26 cÚ¡ 
	gd©a_404_html
[] = {

47 cÚ¡ 
	gd©a_fes_shtml
[] = {

177 cÚ¡ 
	gd©a_foÙ”_html
[] = {

183 cÚ¡ 
	gd©a_h—d”_html
[] = {

250 cÚ¡ 
	gd©a_šdex_html
[] = {

342 cÚ¡ 
	gd©a_¡yË_css
[] = {

448 cÚ¡ 
	gd©a_tı_shtml
[] = {

474 cÚ¡ 
	gd©a_çde_²g
[] = {

498 cÚ¡ 
	gd©a_¡©s_shtml
[] = {

585 cÚ¡ 
h‰pd_fsd©a_fe
 
	gfe_´oûs£s_shtml
[] = {{
NULL
, 
d©a_´oûs£s_shtml
, data_processes_shtml + 17, (data_processes_shtml) - 17}};

587 cÚ¡ 
h‰pd_fsd©a_fe
 
	gfe_404_html
[] = {{
fe_´oûs£s_shtml
, 
d©a_404_html
, data_404_html + 10, (data_404_html) - 10}};

589 cÚ¡ 
h‰pd_fsd©a_fe
 
	gfe_fes_shtml
[] = {{
fe_404_html
, 
d©a_fes_shtml
, data_files_shtml + 13, (data_files_shtml) - 13}};

591 cÚ¡ 
h‰pd_fsd©a_fe
 
	gfe_foÙ”_html
[] = {{
fe_fes_shtml
, 
d©a_foÙ”_html
, data_footer_html + 13, (data_footer_html) - 13}};

593 cÚ¡ 
h‰pd_fsd©a_fe
 
	gfe_h—d”_html
[] = {{
fe_foÙ”_html
, 
d©a_h—d”_html
, data_header_html + 13, (data_header_html) - 13}};

595 cÚ¡ 
h‰pd_fsd©a_fe
 
	gfe_šdex_html
[] = {{
fe_h—d”_html
, 
d©a_šdex_html
, data_index_html + 12, (data_index_html) - 12}};

597 cÚ¡ 
h‰pd_fsd©a_fe
 
	gfe_¡yË_css
[] = {{
fe_šdex_html
, 
d©a_¡yË_css
, data_style_css + 11, (data_style_css) - 11}};

599 cÚ¡ 
h‰pd_fsd©a_fe
 
	gfe_tı_shtml
[] = {{
fe_¡yË_css
, 
d©a_tı_shtml
, data_tcp_shtml + 11, (data_tcp_shtml) - 11}};

601 cÚ¡ 
h‰pd_fsd©a_fe
 
	gfe_çde_²g
[] = {{
fe_tı_shtml
, 
d©a_çde_²g
, data_fade_png + 10, (data_fade_png) - 10}};

603 cÚ¡ 
h‰pd_fsd©a_fe
 
	gfe_¡©s_shtml
[] = {{
fe_çde_²g
, 
d©a_¡©s_shtml
, data_stats_shtml + 13, (data_stats_shtml) - 13}};

605 
	#HTTPD_FS_ROOT
 
fe_¡©s_shtml


	)

607 
	#HTTPD_FS_NUMFILES
 10

	)

	@apps/webserver/httpd-fsdata.h

35 #iâdeà
__HTTPD_FSDATA_H__


36 
	#__HTTPD_FSDATA_H__


	)

38 
	~"u.h
"

40 
	sh‰pd_fsd©a_fe
 {

41 cÚ¡ 
h‰pd_fsd©a_fe
 *
	mÃxt
;

42 cÚ¡ *
	mÇme
;

43 cÚ¡ *
	md©a
;

44 cÚ¡ 
	mËn
;

45 #ifdeà
HTTPD_FS_STATISTICS


46 #ià
HTTPD_FS_STATISTICS
 == 1

47 
u16_t
 
	mcouÁ
;

52 
	sh‰pd_fsd©a_fe_nocÚ¡
 {

53 
h‰pd_fsd©a_fe
 *
	mÃxt
;

54 *
	mÇme
;

55 *
	md©a
;

56 
	mËn
;

57 #ifdeà
HTTPD_FS_STATISTICS


58 #ià
HTTPD_FS_STATISTICS
 == 1

59 
u16_t
 
	mcouÁ
;

	@apps/webserver/httpd.c

58 
	~"u.h
"

59 
	~"h‰pd.h
"

60 
	~"h‰pd-fs.h
"

61 
	~"h‰pd-cgi.h
"

62 
	~"h‰p-¡ršgs.h
"

64 
	~<¡ršg.h
>

66 
	#STATE_WAITING
 0

	)

67 
	#STATE_OUTPUT
 1

	)

69 
	#ISO_Æ
 0x0a

	)

70 
	#ISO_¥aû
 0x20

	)

71 
	#ISO_bªg
 0x21

	)

72 
	#ISO_³rûÁ
 0x25

	)

73 
	#ISO_³riod
 0x2e

	)

74 
	#ISO_¦ash
 0x2f

	)

75 
	#ISO_cŞÚ
 0x3a

	)

80 
	$g’”©e_·¹_of_fe
(*
¡©e
)

82 
h‰pd_¡©e
 *
s
 = (h‰pd_¡©*)
¡©e
;

84 if(
s
->
fe
.
Ën
 > 
	`u_mss
()) {

85 
s
->
Ën
 = 
	`u_mss
();

87 
s
->
Ën
 = s->
fe
.len;

89 
	`memıy
(
u_­pd©a
, 
s
->
fe
.
d©a
, s->
Ën
);

91  
s
->
Ën
;

92 
	}
}

95 
PT_THREAD
(
	$£nd_fe
(
h‰pd_¡©e
 *
s
))

97 
	`PSOCK_BEGIN
(&
s
->
sout
);

100 
	`PSOCK_GENERATOR_SEND
(&
s
->
sout
, 
g’”©e_·¹_of_fe
, s);

101 
s
->
fe
.
Ën
 -= s->len;

102 
s
->
fe
.
d©a
 +ğs->
Ën
;

103 } 
s
->
fe
.
Ën
 > 0);

105 
	`PSOCK_END
(&
s
->
sout
);

106 
	}
}

109 
PT_THREAD
(
	$£nd_·¹_of_fe
(
h‰pd_¡©e
 *
s
))

111 
	`PSOCK_BEGIN
(&
s
->
sout
);

113 
	`PSOCK_SEND
(&
s
->
sout
, s->
fe
.
d©a
, s->
Ën
);

115 
	`PSOCK_END
(&
s
->
sout
);

116 
	}
}

119 
	$Ãxt_süt¡©e
(
h‰pd_¡©e
 *
s
)

121 *
p
;

122 
p
 = 
	`¡rchr
(
s
->
süŒ
, 
ISO_Æ
) + 1;

123 
s
->
sü’
 -ğ()(
p
 - s->
süŒ
);

124 
s
->
süŒ
 = 
p
;

125 
	}
}

128 
PT_THREAD
(
	$hªdË_süt
(
h‰pd_¡©e
 *
s
))

130 *
±r
;

132 
	`PT_BEGIN
(&
s
->
süt
);

135 
s
->
fe
.
Ën
 > 0) {

138 if(*
s
->
fe
.
d©a
 =ğ
ISO_³rûÁ
 &&

139 *(
s
->
fe
.
d©a
 + 1è=ğ
ISO_bªg
) {

140 
s
->
süŒ
 = s->
fe
.
d©a
 + 3;

141 
s
->
sü’
 = s->
fe
.
Ën
 - 3;

142 if(*(
s
->
süŒ
 - 1è=ğ
ISO_cŞÚ
) {

143 
	`h‰pd_fs_İ’
(
s
->
süŒ
 + 1, &s->
fe
);

144 
	`PT_WAIT_THREAD
(&
s
->
süt
, 
	`£nd_fe
(s));

146 
	`PT_WAIT_THREAD
(&
s
->
süt
,

147 
	`h‰pd_cgi
(
s
->
süŒ
)(s, s->scriptptr));

149 
	`Ãxt_süt¡©e
(
s
);

153 
s
->
fe
.
d©a
 = s->
süŒ
;

154 
s
->
fe
.
Ën
 = s->
sü’
;

159 if(
s
->
fe
.
Ën
 > 
	`u_mss
()) {

160 
s
->
Ën
 = 
	`u_mss
();

162 
s
->
Ën
 = s->
fe
.len;

165 if(*
s
->
fe
.
d©a
 =ğ
ISO_³rûÁ
) {

166 
±r
 = 
	`¡rchr
(
s
->
fe
.
d©a
 + 1, 
ISO_³rûÁ
);

168 
±r
 = 
	`¡rchr
(
s
->
fe
.
d©a
, 
ISO_³rûÁ
);

170 if(
±r
 !ğ
NULL
 &&

171 
±r
 !ğ
s
->
fe
.
d©a
) {

172 
s
->
Ën
 = ()(
±r
 - s->
fe
.
d©a
);

173 if(
s
->
Ën
 >ğ
	`u_mss
()) {

174 
s
->
Ën
 = 
	`u_mss
();

177 
	`PT_WAIT_THREAD
(&
s
->
süt
, 
	`£nd_·¹_of_fe
(s));

178 
s
->
fe
.
d©a
 +ğs->
Ën
;

179 
s
->
fe
.
Ën
 -= s->len;

184 
	`PT_END
(&
s
->
süt
);

185 
	}
}

188 
PT_THREAD
(
	$£nd_h—d”s
(
h‰pd_¡©e
 *
s
, cÚ¡ *
¡©ushdr
))

190 *
±r
;

192 
	`PSOCK_BEGIN
(&
s
->
sout
);

194 
	`PSOCK_SEND_STR
(&
s
->
sout
, 
¡©ushdr
);

196 
±r
 = 
	`¡¼chr
(
s
->
f’ame
, 
ISO_³riod
);

197 if(
±r
 =ğ
NULL
) {

198 
	`PSOCK_SEND_STR
(&
s
->
sout
, 
h‰p_cÚ‹Á_ty³_bš¬y
);

199 } if(
	`¡ºcmp
(
h‰p_html
, 
±r
, 5) == 0 ||

200 
	`¡ºcmp
(
h‰p_shtml
, 
±r
, 6) == 0) {

201 
	`PSOCK_SEND_STR
(&
s
->
sout
, 
h‰p_cÚ‹Á_ty³_html
);

202 } if(
	`¡ºcmp
(
h‰p_css
, 
±r
, 4) == 0) {

203 
	`PSOCK_SEND_STR
(&
s
->
sout
, 
h‰p_cÚ‹Á_ty³_css
);

204 } if(
	`¡ºcmp
(
h‰p_²g
, 
±r
, 4) == 0) {

205 
	`PSOCK_SEND_STR
(&
s
->
sout
, 
h‰p_cÚ‹Á_ty³_²g
);

206 } if(
	`¡ºcmp
(
h‰p_gif
, 
±r
, 4) == 0) {

207 
	`PSOCK_SEND_STR
(&
s
->
sout
, 
h‰p_cÚ‹Á_ty³_gif
);

208 } if(
	`¡ºcmp
(
h‰p_jpg
, 
±r
, 4) == 0) {

209 
	`PSOCK_SEND_STR
(&
s
->
sout
, 
h‰p_cÚ‹Á_ty³_jpg
);

211 
	`PSOCK_SEND_STR
(&
s
->
sout
, 
h‰p_cÚ‹Á_ty³_¶aš
);

213 
	`PSOCK_END
(&
s
->
sout
);

214 
	}
}

217 
PT_THREAD
(
	$hªdË_ouut
(
h‰pd_¡©e
 *
s
))

219 *
±r
;

221 
	`PT_BEGIN
(&
s
->
ouut
);

223 if(!
	`h‰pd_fs_İ’
(
s
->
f’ame
, &s->
fe
)) {

224 
	`h‰pd_fs_İ’
(
h‰p_404_html
, &
s
->
fe
);

225 
	`¡rıy
(
s
->
f’ame
, 
h‰p_404_html
);

226 
	`PT_WAIT_THREAD
(&
s
->
ouut
,

227 
	`£nd_h—d”s
(
s
,

228 
h‰p_h—d”_404
));

229 
	`PT_WAIT_THREAD
(&
s
->
ouut
,

230 
	`£nd_fe
(
s
));

232 
	`PT_WAIT_THREAD
(&
s
->
ouut
,

233 
	`£nd_h—d”s
(
s
,

234 
h‰p_h—d”_200
));

235 
±r
 = 
	`¡rchr
(
s
->
f’ame
, 
ISO_³riod
);

236 if(
±r
 !ğ
NULL
 && 
	`¡ºcmp
ÕŒ, 
h‰p_shtml
, 6) == 0) {

237 
	`PT_INIT
(&
s
->
süt
);

238 
	`PT_WAIT_THREAD
(&
s
->
ouut
, 
	`hªdË_süt
(s));

240 
	`PT_WAIT_THREAD
(&
s
->
ouut
,

241 
	`£nd_fe
(
s
));

244 
	`PSOCK_CLOSE
(&
s
->
sout
);

245 
	`PT_END
(&
s
->
ouut
);

246 
	}
}

249 
PT_THREAD
(
	$hªdË_šput
(
h‰pd_¡©e
 *
s
))

251 
	`PSOCK_BEGIN
(&
s
->
sš
);

253 
	`PSOCK_READTO
(&
s
->
sš
, 
ISO_¥aû
);

256 if(
	`¡ºcmp
(
s
->
šputbuf
, 
h‰p_g‘
, 4) != 0) {

257 
	`PSOCK_CLOSE_EXIT
(&
s
->
sš
);

259 
	`PSOCK_READTO
(&
s
->
sš
, 
ISO_¥aû
);

261 if(
s
->
šputbuf
[0] !ğ
ISO_¦ash
) {

262 
	`PSOCK_CLOSE_EXIT
(&
s
->
sš
);

265 if(
s
->
šputbuf
[1] =ğ
ISO_¥aû
) {

266 
	`¡ºıy
(
s
->
f’ame
, 
h‰p_šdex_html
, (s->filename));

268 
s
->
šputbuf
[
	`PSOCK_DATALEN
(&s->
sš
) - 1] = 0;

269 
	`¡ºıy
(
s
->
f’ame
, &s->
šputbuf
[0], (s->filename));

274 
s
->
¡©e
 = 
STATE_OUTPUT
;

277 
	`PSOCK_READTO
(&
s
->
sš
, 
ISO_Æ
);

279 if(
	`¡ºcmp
(
s
->
šputbuf
, 
h‰p_»ã»r
, 8) == 0) {

280 
s
->
šputbuf
[
	`PSOCK_DATALEN
(&s->
sš
) - 2] = 0;

285 
	`PSOCK_END
(&
s
->
sš
);

286 
	}
}

289 
	$hªdË_cÚÃùiÚ
(
h‰pd_¡©e
 *
s
)

291 
	`hªdË_šput
(
s
);

292 if(
s
->
¡©e
 =ğ
STATE_OUTPUT
) {

293 
	`hªdË_ouut
(
s
);

295 
	}
}

298 
	$h‰pd_­pÿÎ
()

300 
h‰pd_¡©e
 *
s
 = (h‰pd_¡©*)&(
u_cÚn
->
­p¡©e
);

302 if(
	`u_şo£d
(è|| 
	`u_abÜ‹d
(è|| 
	`u_timedout
()) {

303 } if(
	`u_cÚÃùed
()) {

304 
	`PSOCK_INIT
(&
s
->
sš
, s->
šputbuf
, (s->inputbuf) - 1);

305 
	`PSOCK_INIT
(&
s
->
sout
, s->
šputbuf
, (s->inputbuf) - 1);

306 
	`PT_INIT
(&
s
->
ouut
);

307 
s
->
¡©e
 = 
STATE_WAITING
;

309 
s
->
tim”
 = 0;

310 
	`hªdË_cÚÃùiÚ
(
s
);

311 } if(
s
 !ğ
NULL
) {

312 if(
	`u_pŞl
()) {

313 ++
s
->
tim”
;

314 if(
s
->
tim”
 >= 20) {

315 
	`u_abÜt
();

318 
s
->
tim”
 = 0;

320 
	`hªdË_cÚÃùiÚ
(
s
);

322 
	`u_abÜt
();

324 
	}
}

333 
	$h‰pd_š™
()

335 
	`u_li¡’
(
	`HTONS
(80));

336 
	}
}

	@apps/webserver/httpd.h

35 #iâdeà
__HTTPD_H__


36 
	#__HTTPD_H__


	)

38 
	~"psock.h
"

39 
	~"h‰pd-fs.h
"

41 
	sh‰pd_¡©e
 {

42 
	mtim”
;

43 
psock
 
	msš
, 
	msout
;

44 
±
 
	mouut
, 
	msüt
;

45 
	mšputbuf
[50];

46 
	mf’ame
[20];

47 
	m¡©e
;

48 
h‰pd_fs_fe
 
	mfe
;

49 
	mËn
;

50 *
	msüŒ
;

51 
	msü’
;

53 
	mcouÁ
;

56 
h‰pd_š™
();

57 
h‰pd_­pÿÎ
();

59 
h‰pd_log
(*
msg
);

60 
h‰pd_log_fe
(
u16_t
 *
»que¡”
, *
fe
);

	@apps/webserver/webserver.h

35 #iâdeà
__WEBSERVER_H__


36 
	#__WEBSERVER_H__


	)

38 
	~"h‰pd.h
"

40 
h‰pd_¡©e
 
	tu_tı_­p¡©e_t
;

44 #iâdeà
UIP_APPCALL


45 
	#UIP_APPCALL
 
h‰pd_­pÿÎ


	)

	@doc/example-mainloop-with-arp.c

1 
	~"u.h
"

2 
	~"u_¬p.h
"

3 
	~"ÃtwÜk-deviû.h
"

4 
	~"h‰pd.h
"

5 
	~"tim”.h
"

7 
	#BUF
 ((
u_‘h_hdr
 *)&
u_buf
[0])

	)

11 
	$maš
()

13 
i
;

14 
u_addr_t
 
addr
;

15 
tim”
 
³riodic_tim”
, 
¬p_tim”
;

17 
	`tim”_£t
(&
³riodic_tim”
, 
CLOCK_SECOND
 / 2);

18 
	`tim”_£t
(&
¬p_tim”
, 
CLOCK_SECOND
 * 10);

20 
	`ÃtwÜk_deviû_š™
();

21 
	`u_š™
();

23 
	`u_addr
(
addr
, 192,168,0,2);

24 
	`u_£tho¡addr
(
addr
);

26 
	`h‰pd_š™
();

29 
u_Ën
 = 
	`ÃtwÜk_deviû_»ad
();

30 if(
u_Ën
 > 0) {

31 if(
BUF
->
ty³
 =ğ
	`htÚs
(
UIP_ETHTYPE_IP
)) {

32 
	`u_¬p_š
();

33 
	`u_šput
();

37 if(
u_Ën
 > 0) {

38 
	`u_¬p_out
();

39 
	`ÃtwÜk_deviû_£nd
();

41 } if(
BUF
->
ty³
 =ğ
	`htÚs
(
UIP_ETHTYPE_ARP
)) {

42 
	`u_¬p_¬pš
();

46 if(
u_Ën
 > 0) {

47 
	`ÃtwÜk_deviû_£nd
();

51 } if(
	`tim”_expœed
(&
³riodic_tim”
)) {

52 
	`tim”_»£t
(&
³riodic_tim”
);

53 
i
 = 0; i < 
UIP_CONNS
; i++) {

54 
	`u_³riodic
(
i
);

58 if(
u_Ën
 > 0) {

59 
	`u_¬p_out
();

60 
	`ÃtwÜk_deviû_£nd
();

64 #ià
UIP_UDP


65 
i
 = 0; i < 
UIP_UDP_CONNS
; i++) {

66 
	`u_udp_³riodic
(
i
);

70 if(
u_Ën
 > 0) {

71 
	`u_¬p_out
();

72 
	`ÃtwÜk_deviû_£nd
();

78 if(
	`tim”_expœed
(&
¬p_tim”
)) {

79 
	`tim”_»£t
(&
¬p_tim”
);

80 
	`u_¬p_tim”
();

85 
	}
}

	@doc/example-mainloop-without-arp.c

1 
	~"u.h
"

2 
	~"u_¬p.h
"

3 
	~"ÃtwÜk-deviû.h
"

4 
	~"h‰pd.h
"

5 
	~"tim”.h
"

9 
	$maš
()

11 
i
;

12 
u_addr_t
 
addr
;

13 
tim”
 
³riodic_tim”
;

15 
	`tim”_£t
(&
³riodic_tim”
, 
CLOCK_SECOND
 / 2);

17 
	`ÃtwÜk_deviû_š™
();

18 
	`u_š™
();

20 
	`u_addr
(
addr
, 192,168,0,2);

21 
	`u_£tho¡addr
(
addr
);

23 
	`h‰pd_š™
();

26 
u_Ën
 = 
	`ÃtwÜk_deviû_»ad
();

27 if(
u_Ën
 > 0) {

28 
	`u_šput
();

32 if(
u_Ën
 > 0) {

33 
	`ÃtwÜk_deviû_£nd
();

35 } if(
	`tim”_expœed
(&
³riodic_tim”
)) {

36 
	`tim”_»£t
(&
³riodic_tim”
);

37 
i
 = 0; i < 
UIP_CONNS
; i++) {

38 
	`u_³riodic
(
i
);

42 if(
u_Ën
 > 0) {

43 
	`ÃtwÜk_deviû_£nd
();

47 #ià
UIP_UDP


48 
i
 = 0; i < 
UIP_UDP_CONNS
; i++) {

49 
	`u_udp_³riodic
(
i
);

53 if(
u_Ën
 > 0) {

54 
	`ÃtwÜk_deviû_£nd
();

61 
	}
}

	@doc/uip-code-style.c

33 
	~"u.h
"

39 
	gæag
;

70 
	$code_¡yË_exam¶e_funùiÚ
()

76 
i
;

87 
i
 = 0; i < 10; ++i) {

94 if(
i
 =ğ
c
) {

95  
c
;

98 
c
++;

101 
	}
}

109 
	$ª_exam¶e_funùiÚ
()

112 
	}
}

	@lib/memb.c

46 
	~<¡ršg.h
>

48 
	~"memb.h
"

52 
	$memb_š™
(
memb_blocks
 *
m
)

54 
	`mem£t
(
m
->
couÁ
, 0, m->
num
);

55 
	`mem£t
(
m
->
mem
, 0, m->
size
 * m->
num
);

56 
	}
}

59 
	$memb_®loc
(
memb_blocks
 *
m
)

61 
i
;

63 
i
 = 0; i < 
m
->
num
; ++i) {

64 if(
m
->
couÁ
[
i
] == 0) {

68 ++(
m
->
couÁ
[
i
]);

69  (*)((*)
m
->
mem
 + (
i
 * m->
size
));

75  
NULL
;

76 
	}
}

79 
	$memb_ä“
(
memb_blocks
 *
m
, *
±r
)

81 
i
;

82 *
±r2
;

86 
±r2
 = (*)
m
->
mem
;

87 
i
 = 0; i < 
m
->
num
; ++i) {

89 if(
±r2
 =ğ(*)
±r
) {

92 if(
m
->
couÁ
[
i
] > 0) {

94 --(
m
->
couÁ
[
i
]);

96  
m
->
couÁ
[
i
];

98 
±r2
 +ğ
m
->
size
;

101 
	}
}

	@lib/memb.h

66 #iâdeà
__MEMB_H__


67 
	#__MEMB_H__


	)

74 
	#MEMB_CONCAT2
(
s1
, 
s2
ès1##
	)
s2

75 
	#MEMB_CONCAT
(
s1
, 
s2
è
	`MEMB_CONCAT2
(s1, s2)

	)

98 
	#MEMB
(
Çme
, 
¡ruùu»
, 
num
) \

99 
	`MEMB_CONCAT
(
Çme
,
_memb_couÁ
)[
num
]; \

100 
¡ruùu»
 
	`MEMB_CONCAT
(
Çme
,
_memb_mem
)[
num
]; \

101 
memb_blocks
 
Çme
 = {(
¡ruùu»
), 
num
, \

102 
	`MEMB_CONCAT
(
Çme
,
_memb_couÁ
), \

103 (*)
	`MEMB_CONCAT
(
Çme
,
_memb_mem
)}

	)

105 
	smemb_blocks
 {

106 
	msize
;

107 
	mnum
;

108 *
	mcouÁ
;

109 *
	mmem
;

117 
memb_š™
(
memb_blocks
 *
m
);

124 *
memb_®loc
(
memb_blocks
 *
m
);

138 
memb_ä“
(
memb_blocks
 *
m
, *
±r
);

	@uip/clock.h

52 #iâdeà
__CLOCK_H__


53 
	#__CLOCK_H__


	)

55 
	~"şock-¬ch.h
"

64 
şock_š™
();

73 
şock_time_t
 
şock_time
();

80 #ifdeà
CLOCK_CONF_SECOND


81 
	#CLOCK_SECOND
 
CLOCK_CONF_SECOND


	)

83 
	#CLOCK_SECOND
 (
şock_time_t
)32

	)

	@uip/lc-addrlabels.h

60 #iâdeà
__LC_ADDRLABELS_H__


61 
	#__LC_ADDRLABELS_H__


	)

64 * 
	tlc_t
;

66 
	#LC_INIT
(
s
è ğ
NULL


	)

69 
	#LC_RESUME
(
s
) \

71 if(
s
 !ğ
NULL
) { \

72 *
s
; \

74 } 0)

	)

76 
	#LC_SET
(
s
) \

77 dØ{ ({ 
__Ïb–__
 
»sume
;„esume: (
s
èğ&&»sume; }); }0)

	)

79 
	#LC_END
(
s
)

	)

	@uip/lc-switch.h

57 #iâdeà
__LC_SWITCH_H__


58 
	#__LC_SWTICH_H__


	)

64 
	tlc_t
;

66 
	#LC_INIT
(
s
è ğ0;

	)

68 
	#LC_RESUME
(
s
èsè{ 0:

	)

70 
	#LC_SET
(
s
è ğ
__LINE__
; __LINE__:

	)

72 
	#LC_END
(
s
è}

	)

	@uip/lc.h

62 #ifdeà
DOXYGEN


71 
	#LC_INIT
(
lc
)

	)

84 
	#LC_SET
(
lc
)

	)

96 
	#LC_RESUME
(
lc
)

	)

108 
	#LC_END
(
lc
)

	)

119 #iâdeà
__LC_H__


120 
	#__LC_H__


	)

122 #ifdeà
LC_CONF_INCLUDE


123 #šşud
LC_CONF_INCLUDE


125 
	~"lc-sw™ch.h
"

	@uip/psock.c

36 
	~<¡dio.h
>

37 
	~<¡ršg.h
>

39 
	~"uİt.h
"

40 
	~"psock.h
"

41 
	~"u.h
"

43 
	#STATE_NONE
 0

	)

44 
	#STATE_ACKED
 1

	)

45 
	#STATE_READ
 2

	)

46 
	#STATE_BLOCKED_NEWDATA
 3

	)

47 
	#STATE_BLOCKED_CLOSE
 4

	)

48 
	#STATE_BLOCKED_SEND
 5

	)

49 
	#STATE_DATA_SENT
 6

	)

56 
	#BUF_NOT_FULL
 0

	)

57 
	#BUF_NOT_FOUND
 0

	)

64 
	#BUF_FULL
 1

	)

71 
	#BUF_FOUND
 2

	)

75 
	$buf_£tup
(
psock_buf
 *
buf
,

76 
u8_t
 *
buåŒ
, 
u16_t
 
bufsize
)

78 
buf
->
±r
 = 
buåŒ
;

79 
buf
->
Ëá
 = 
bufsize
;

80 
	}
}

82 
u8_t


83 
	$buf_bufd©a
(
psock_buf
 *
buf
, 
u16_t
 
Ën
,

84 
u8_t
 **
d©­Œ
, 
u16_t
 *
d©®’
)

86 if(*
d©®’
 < 
buf
->
Ëá
) {

87 
	`memıy
(
buf
->
±r
, *
d©­Œ
, *
d©®’
);

88 
buf
->
±r
 +ğ*
d©®’
;

89 
buf
->
Ëá
 -ğ*
d©®’
;

90 *
d©­Œ
 +ğ*
d©®’
;

91 *
d©®’
 = 0;

92  
BUF_NOT_FULL
;

93 } if(*
d©®’
 =ğ
buf
->
Ëá
) {

94 
	`memıy
(
buf
->
±r
, *
d©­Œ
, *
d©®’
);

95 
buf
->
±r
 +ğ*
d©®’
;

96 
buf
->
Ëá
 = 0;

97 *
d©­Œ
 +ğ*
d©®’
;

98 *
d©®’
 = 0;

99  
BUF_FULL
;

101 
	`memıy
(
buf
->
±r
, *
d©­Œ
, buf->
Ëá
);

102 
buf
->
±r
 +ğbuf->
Ëá
;

103 *
d©®’
 -ğ
buf
->
Ëá
;

104 *
d©­Œ
 +ğ
buf
->
Ëá
;

105 
buf
->
Ëá
 = 0;

106  
BUF_FULL
;

108 
	}
}

110 
u8_t


111 
	$buf_buáo
(
psock_buf
 *
buf
, 
u8_t
 
’dm¬k”
,

112 
u8_t
 **
d©­Œ
, 
u16_t
 *
d©®’
)

114 
u8_t
 
c
;

115 
buf
->
Ëá
 > 0 && *
d©®’
 > 0) {

116 
c
 = *
buf
->
±r
 = **
d©­Œ
;

117 ++*
d©­Œ
;

118 ++
buf
->
±r
;

119 --*
d©®’
;

120 --
buf
->
Ëá
;

122 if(
c
 =ğ
’dm¬k”
) {

123  
BUF_FOUND
;

127 if(*
d©®’
 == 0) {

128  
BUF_NOT_FOUND
;

131 *
d©®’
 > 0) {

132 
c
 = **
d©­Œ
;

133 --*
d©®’
;

134 ++*
d©­Œ
;

136 if(
c
 =ğ
’dm¬k”
) {

137  
BUF_FOUND
 | 
BUF_FULL
;

141  
BUF_FULL
;

142 
	}
}

145 
	$£nd_d©a
(
psock
 *
s
)

147 if(
s
->
¡©e
 !ğ
STATE_DATA_SENT
 || 
	`u_»xm™
()) {

148 if(
s
->
£ndËn
 > 
	`u_mss
()) {

149 
	`u_£nd
(
s
->
£nd±r
, 
	`u_mss
());

151 
	`u_£nd
(
s
->
£nd±r
, s->
£ndËn
);

153 
s
->
¡©e
 = 
STATE_DATA_SENT
;

157 
	}
}

160 
	$d©a_acked
(
psock
 *
s
)

162 if(
s
->
¡©e
 =ğ
STATE_DATA_SENT
 && 
	`u_acked
()) {

163 if(
s
->
£ndËn
 > 
	`u_mss
()) {

164 
s
->
£ndËn
 -ğ
	`u_mss
();

165 
s
->
£nd±r
 +ğ
	`u_mss
();

167 
s
->
£nd±r
 +ğs->
£ndËn
;

168 
s
->
£ndËn
 = 0;

170 
s
->
¡©e
 = 
STATE_ACKED
;

174 
	}
}

176 
PT_THREAD
(
	$psock_£nd
(
psock
 *
s
, cÚ¡ *
buf
,

177 
Ën
))

179 
	`PT_BEGIN
(&
s
->
psock±
);

182 if(
Ën
 == 0) {

183 
	`PT_EXIT
(&
s
->
psock±
);

188 
s
->
£nd±r
 = 
buf
;

189 
s
->
£ndËn
 = 
Ën
;

191 
s
->
¡©e
 = 
STATE_NONE
;

195 
s
->
£ndËn
 > 0) {

207 
	`PT_WAIT_UNTIL
(&
s
->
psock±
, 
	`d©a_acked
(sè& 
	`£nd_d©a
(s));

210 
s
->
¡©e
 = 
STATE_NONE
;

212 
	`PT_END
(&
s
->
psock±
);

213 
	}
}

215 
PT_THREAD
(
psock_g’”©Ü_£nd
(
psock
 *
s
,

216 (*
g’”©e
)(*), *
¬g
))

218 
	`PT_BEGIN
(&
s
->
psock±
);

221 if(
g’”©e
 =ğ
NULL
) {

222 
	`PT_EXIT
(&
s
->
psock±
);

227 
s
->
£ndËn
 = 
	`g’”©e
(
¬g
);

228 
s
->
£nd±r
 = 
u_­pd©a
;

230 
s
->
¡©e
 = 
STATE_NONE
;

234 if(
	`u_»xm™
()) {

235 
	`g’”©e
(
¬g
);

238 
	`PT_WAIT_UNTIL
(&
s
->
psock±
, 
	`d©a_acked
(sè& 
	`£nd_d©a
(s));

239 } 
s
->
£ndËn
 > 0);

241 
s
->
¡©e
 = 
STATE_NONE
;

243 
	`PT_END
(&
s
->
psock±
);

244 
	}
}

246 
u16_t


247 
	$psock_d©®’
(
psock
 *psock)

249  
psock
->
bufsize
 -…sock->
buf
.
Ëá
;

250 
	}
}

253 
	$psock_Ãwd©a
(
psock
 *
s
)

255 if(
s
->
»adËn
 > 0) {

259 } if(
s
->
¡©e
 =ğ
STATE_READ
) {

261 
s
->
¡©e
 = 
STATE_BLOCKED_NEWDATA
;

263 } if(
	`u_Ãwd©a
()) {

270 
	}
}

272 
PT_THREAD
(
	$psock_»adto
(
psock
 *psock, 
c
))

274 
	`PT_BEGIN
(&
psock
->
psock±
);

276 
	`buf_£tup
(&
psock
->
buf
,…sock->
buåŒ
,…sock->
bufsize
);

282 if(
psock
->
»adËn
 == 0) {

283 
	`PT_WAIT_UNTIL
(&
psock
->
psock±
, 
	`psock_Ãwd©a
(psock));

284 
psock
->
¡©e
 = 
STATE_READ
;

285 
psock
->
»ad±r
 = (
u8_t
 *)
u_­pd©a
;

286 
psock
->
»adËn
 = 
	`u_d©®’
();

288 } (
	`buf_buáo
(&
psock
->
buf
, 
c
,

289 &
psock
->
»ad±r
,

290 &
psock
->
»adËn
è& 
BUF_FOUND
) == 0);

292 if(
	`psock_d©®’
(
psock
) == 0) {

293 
psock
->
¡©e
 = 
STATE_NONE
;

294 
	`PT_RESTART
(&
psock
->
psock±
);

296 
	`PT_END
(&
psock
->
psock±
);

297 
	}
}

299 
PT_THREAD
(
	$psock_»adbuf
(
psock
 *psock))

301 
	`PT_BEGIN
(&
psock
->
psock±
);

303 
	`buf_£tup
(&
psock
->
buf
,…sock->
buåŒ
,…sock->
bufsize
);

309 if(
psock
->
»adËn
 == 0) {

310 
	`PT_WAIT_UNTIL
(&
psock
->
psock±
, 
	`psock_Ãwd©a
(psock));

311 
	`´štf
("Waited for‚ewdata\n");

312 
psock
->
¡©e
 = 
STATE_READ
;

313 
psock
->
»ad±r
 = (
u8_t
 *)
u_­pd©a
;

314 
psock
->
»adËn
 = 
	`u_d©®’
();

316 } 
	`buf_bufd©a
(&
psock
->
buf
,…sock->
bufsize
,

317 &
psock
->
»ad±r
,

318 &
psock
->
»adËn
è!ğ
BUF_FULL
);

320 if(
	`psock_d©®’
(
psock
) == 0) {

321 
psock
->
¡©e
 = 
STATE_NONE
;

322 
	`PT_RESTART
(&
psock
->
psock±
);

324 
	`PT_END
(&
psock
->
psock±
);

325 
	}
}

328 
	$psock_š™
(
psock
 *psock, *
bufãr
, 
bufãrsize
)

330 
psock
->
¡©e
 = 
STATE_NONE
;

331 
psock
->
»adËn
 = 0;

332 
psock
->
buåŒ
 = 
bufãr
;

333 
psock
->
bufsize
 = 
bufãrsize
;

334 
	`buf_£tup
(&
psock
->
buf
, 
bufãr
, 
bufãrsize
);

335 
	`PT_INIT
(&
psock
->
±
);

336 
	`PT_INIT
(&
psock
->
psock±
);

337 
	}
}

	@uip/psock.h

81 #iâdeà
__PSOCK_H__


82 
	#__PSOCK_H__


	)

84 
	~"uİt.h
"

85 
	~"±.h
"

95 
	spsock_buf
 {

96 
u8_t
 *
	m±r
;

97 
	mËá
;

106 
	spsock
 {

107 
±
 
	m±
, 
	mpsock±
;

110 cÚ¡ 
u8_t
 *
	m£nd±r
;

111 
u8_t
 *
	m»ad±r
;

113 *
	mbuåŒ
;

116 
u16_t
 
	m£ndËn
;

117 
u16_t
 
	m»adËn
;

119 
psock_buf
 
	mbuf
;

121 
	mbufsize
;

123 
	m¡©e
;

126 
psock_š™
(
psock
 *psock, *
bufãr
, 
bufãrsize
);

144 
	#PSOCK_INIT
(
psock
, 
bufãr
, 
bufãrsize
) \

145 
	`psock_š™
(
psock
, 
bufãr
, 
bufãrsize
)

	)

158 
	#PSOCK_BEGIN
(
psock
è
	`PT_BEGIN
(&(Õsock)->
±
))

	)

160 
PT_THREAD
(
psock_£nd
(
psock
 *psock, cÚ¡ *
buf
, 
Ën
));

178 
	#PSOCK_SEND
(
psock
, 
d©a
, 
d©®’
) \

179 
	`PT_WAIT_THREAD
(&((
psock
)->
±
), 
	`psock_£nd
Õsock, 
d©a
, 
d©®’
))

	)

191 
	#PSOCK_SEND_STR
(
psock
, 
¡r
) \

192 
	`PT_WAIT_THREAD
(&((
psock
)->
±
), 
	`psock_£nd
Õsock, 
¡r
, 
	`¡¾’
(¡r)))

	)

194 
PT_THREAD
(
psock_g’”©Ü_£nd
(
psock
 *psock,

195 (*
f
)(*), *
¬g
));

219 
	#PSOCK_GENERATOR_SEND
(
psock
, 
g’”©Ü
, 
¬g
) \

220 
	`PT_WAIT_THREAD
(&((
psock
)->
±
), \

221 
	`psock_g’”©Ü_£nd
(
psock
, 
g’”©Ü
, 
¬g
))

	)

235 
	#PSOCK_CLOSE
(
psock
è
	`u_şo£
()

	)

237 
	`PT_THREAD
(
	`psock_»adbuf
(
psock
 *psock));

250 
	#PSOCK_READBUF
(
psock
) \

251 
	`PT_WAIT_THREAD
(&((
psock
)->
±
), 
	`psock_»adbuf
Õsock))

	)

253 
	`PT_THREAD
(
	`psock_»adto
(
psock
 *psock, 
c
));

268 
	#PSOCK_READTO
(
psock
, 
c
) \

269 
	`PT_WAIT_THREAD
(&((
psock
)->
±
), 
	`psock_»adto
Õsock, 
c
))

	)

281 
	#PSOCK_DATALEN
(
psock
è
	`psock_d©®’
Õsock)

	)

283 
u16_t
 
	`psock_d©®’
(
psock
 *psock);

297 
	#PSOCK_EXIT
(
psock
è
	`PT_EXIT
(&(Õsock)->
±
))

	)

308 
	#PSOCK_CLOSE_EXIT
(
psock
) \

310 
	`PSOCK_CLOSE
(
psock
); \

311 
	`PSOCK_EXIT
(
psock
); \

312 
	}
} 0)

	)

325 
	#PSOCK_END
(
psock
è
	`PT_END
(&(Õsock)->
±
))

	)

327 
psock_Ãwd©a
(
psock
 *
s
);

339 
	#PSOCK_NEWDATA
(
psock
è
	`psock_Ãwd©a
Õsock)

	)

372 
	#PSOCK_WAIT_UNTIL
(
psock
, 
cÚd™iÚ
) \

373 
	`PT_WAIT_UNTIL
(&((
psock
)->
±
), (
cÚd™iÚ
));

	)

375 
	#PSOCK_WAIT_THREAD
(
psock
, 
cÚd™iÚ
) \

376 
	`PT_WAIT_THREAD
(&((
psock
)->
±
), (
cÚd™iÚ
))

	)

	@uip/pt.h

49 #iâdeà
__PT_H__


50 
	#__PT_H__


	)

52 
	~"lc.h
"

54 
	s±
 {

55 
lc_t
 
	mlc
;

58 
	#PT_WAITING
 0

	)

59 
	#PT_EXITED
 1

	)

60 
	#PT_ENDED
 2

	)

61 
	#PT_YIELDED
 3

	)

80 
	#PT_INIT
(
±
è
	`LC_INIT
(Õt)->
lc
)

	)

100 
	#PT_THREAD
(
Çme_¬gs
è
	)
name_args

115 
	#PT_BEGIN
(
±
è{ 
PT_YIELD_FLAG
 = 1; 
	`LC_RESUME
(Õt)->
lc
)

	)

127 
	#PT_END
(
±
è
	`LC_END
(Õt)->
lc
); 
PT_YIELD_FLAG
 = 0; \

128 
	`PT_INIT
(
±
);  
PT_ENDED
; }

	)

148 
	#PT_WAIT_UNTIL
(
±
, 
cÚd™iÚ
) \

150 
	`LC_SET
((
±
)->
lc
); \

151 if(!(
cÚd™iÚ
)) { \

152  
PT_WAITING
; \

154 } 0)

	)

167 
	#PT_WAIT_WHILE
(
±
, 
cÚd
è
	`PT_WAIT_UNTIL
(Õt), !(cÚd))

	)

192 
	#PT_WAIT_THREAD
(
±
, 
th»ad
è
	`PT_WAIT_WHILE
(Õt), 
	`PT_SCHEDULE
Ñh»ad))

	)

206 
	#PT_SPAWN
(
±
, 
chd
, 
th»ad
) \

208 
	`PT_INIT
((
chd
)); \

209 
	`PT_WAIT_THREAD
((
±
), (
th»ad
)); \

210 } 0)

	)

229 
	#PT_RESTART
(
±
) \

231 
	`PT_INIT
(
±
); \

232  
PT_WAITING
; \

233 } 0)

	)

246 
	#PT_EXIT
(
±
) \

248 
	`PT_INIT
(
±
); \

249  
PT_EXITED
; \

250 } 0)

	)

271 
	#PT_SCHEDULE
(
f
è((fè=ğ
PT_WAITING
)

	)

290 
	#PT_YIELD
(
±
) \

292 
PT_YIELD_FLAG
 = 0; \

293 
	`LC_SET
((
±
)->
lc
); \

294 if(
PT_YIELD_FLAG
 == 0) { \

295  
PT_YIELDED
; \

297 } 0)

	)

310 
	#PT_YIELD_UNTIL
(
±
, 
cÚd
) \

312 
PT_YIELD_FLAG
 = 0; \

313 
	`LC_SET
((
±
)->
lc
); \

314 if((
PT_YIELD_FLAG
 =ğ0è|| !(
cÚd
)) { \

315  
PT_YIELDED
; \

317 } 0)

	)

	@uip/timer.c

48 
	~"şock.h
"

49 
	~"tim”.h
"

64 
	$tim”_£t
(
tim”
 *
t
, 
şock_time_t
 
š‹rv®
)

66 
t
->
š‹rv®
 = interval;

67 
t
->
¡¬t
 = 
	`şock_time
();

68 
	}
}

84 
	$tim”_»£t
(
tim”
 *
t
)

86 
t
->
¡¬t
 +ğt->
š‹rv®
;

87 
	}
}

104 
	$tim”_»¡¬t
(
tim”
 *
t
)

106 
t
->
¡¬t
 = 
	`şock_time
();

107 
	}
}

121 
	$tim”_expœed
(
tim”
 *
t
)

123  (
şock_time_t
)(
	`şock_time
(è- 
t
->
¡¬t
è>ğ(şock_time_té->
š‹rv®
;

124 
	}
}

	@uip/timer.h

61 #iâdeà
__TIMER_H__


62 
	#__TIMER_H__


	)

64 
	~"şock.h
"

74 
	stim”
 {

75 
şock_time_t
 
	m¡¬t
;

76 
şock_time_t
 
	mš‹rv®
;

79 
tim”_£t
(
tim”
 *
t
, 
şock_time_t
 
š‹rv®
);

80 
tim”_»£t
(
tim”
 *
t
);

81 
tim”_»¡¬t
(
tim”
 *
t
);

82 
tim”_expœed
(
tim”
 *
t
);

	@uip/uip-fw.c

56 
	~"u.h
"

57 
	~"u_¬ch.h
"

58 
	~"u-fw.h
"

60 
	~<¡ršg.h
>

65 
u_fw_Ãtif
 *
	gÃtifs
 = 
NULL
;

70 
u_fw_Ãtif
 *
	gdeçuÉÃtif
 = 
NULL
;

72 
	stı_hdr
 {

74 
u8_t
 
	mvhl
,

75 
	mtos
;

76 
u16_t
 
	mËn
,

77 
	mid
,

78 
	moff£t
;

79 
u8_t
 
	m‰l
,

80 
	m´Ùo
;

81 
u16_t
 
	mchksum
;

82 
u16_t
 
	m¤caddr
[2],

83 
	mde¡addr
[2];

86 
u16_t
 
	m¤ıÜt
,

87 
	mde¡pÜt
;

88 
u8_t
 
	m£qno
[4],

89 
	mackno
[4],

90 
	mtıoff£t
,

91 
	mæags
,

92 
	mwnd
[2];

93 
u16_t
 
	mtıchksum
;

94 
u8_t
 
	murgp
[2];

95 
u8_t
 
	mİtd©a
[4];

98 
	sicmp_hdr
 {

100 
u8_t
 
	mvhl
,

101 
	mtos
,

102 
	mËn
[2],

103 
	mid
[2],

104 
	moff£t
[2],

105 
	m‰l
,

106 
	m´Ùo
;

107 
u16_t
 
	mchksum
;

108 
u16_t
 
	m¤caddr
[2],

109 
	mde¡addr
[2];

111 
u8_t
 
	mty³
, 
	micode
;

112 
u16_t
 
	micmpchksum
;

113 
u16_t
 
	mid
, 
	m£qno
;

114 
u8_t
 
	m·ylßd
[1];

118 
	#ICMP_ECHO
 8

	)

121 
	#ICMP_TE
 11

	)

126 
	#BUF
 ((
tı_hdr
 *)&
u_buf
[
UIP_LLH_LEN
])

	)

131 
	#ICMPBUF
 ((
icmp_hdr
 *)&
u_buf
[
UIP_LLH_LEN
])

	)

137 
	sfwÿche_’Œy
 {

138 
u16_t
 
	mtim”
;

140 
u16_t
 
	m¤caddr
[2];

141 
u16_t
 
	mde¡addr
[2];

142 
u16_t
 
	mid
;

143 
u8_t
 
	m´Ùo
;

144 
u8_t
 
	munu£d
;

146 #ià
nÙdef


147 
u16_t
 
	m·ylßd
[2];

150 #ià
UIP_REASSEMBLY
 > 0

151 
u16_t
 
	mËn
, 
	moff£t
;

158 #ifdeà
UIP_CONF_FWCACHE_SIZE


159 
	#FWCACHE_SIZE
 
UIP_CONF_FWCACHE_SIZE


	)

161 
	#FWCACHE_SIZE
 2

	)

169 
fwÿche_’Œy
 
	gfwÿche
[
FWCACHE_SIZE
];

175 
	#FW_TIME
 20

	)

183 
	$u_fw_š™
()

185 
u_fw_Ãtif
 *
t
;

186 
deçuÉÃtif
 = 
NULL
;

187 
Ãtifs
 !ğ
NULL
) {

188 
t
 = 
Ãtifs
;

189 
Ãtifs
 =‚‘ifs->
Ãxt
;

190 
t
->
Ãxt
 = 
NULL
;

192 
	}
}

207 
	$addr_maskcmp
(
u16_t
 *
addr
, u16_ˆ*
Ãtaddr
, u16_ˆ*
Ãtmask
)

209  (
addr
[0] & 
Ãtmask
 [0]è=ğ(
Ãtaddr
[0] &‚etmask[0]) &&

210 (
addr
[1] & 
Ãtmask
[1]è=ğ(
Ãtaddr
[1] &‚etmask[1]);

211 
	}
}

222 
	$time_exûeded
()

224 
u16_t
 
tmp16
;

227 if(
ICMPBUF
->
´Ùo
 =ğ
UIP_PROTO_ICMP
) {

228 
u_Ën
 = 0;

232 
	`memıy
(&(
ICMPBUF
->
·ylßd
[0]), ICMPBUF, 28);

235 
ICMPBUF
->
ty³
 = 
ICMP_TE
;

236 
ICMPBUF
->
icode
 = 0;

239 
ICMPBUF
->
icmpchksum
 = 0;

240 
ICMPBUF
->
icmpchksum
 = ~
	`u_chksum
((
u16_t
 *)&(ICMPBUF->
ty³
), 36);

244 
tmp16
ğ
BUF
->
de¡addr
[0];

245 
BUF
->
de¡addr
[0] = BUF->
¤caddr
[0];

246 
BUF
->
¤caddr
[0] = 
tmp16
;

247 
tmp16
 = 
BUF
->
de¡addr
[1];

248 
BUF
->
de¡addr
[1] = BUF->
¤caddr
[1];

249 
BUF
->
¤caddr
[1] = 
tmp16
;

252 
BUF
->
¤caddr
[0] = 
u_ho¡addr
[0];

253 
BUF
->
¤caddr
[1] = 
u_ho¡addr
[1];

257 
u_Ën
 = 56;

258 
ICMPBUF
->
Ën
[0] = 0;

259 
ICMPBUF
->
Ën
[1] = 
u_Ën
;

262 
ICMPBUF
->
vhl
 = 0x45;

263 
ICMPBUF
->
tos
 = 0;

264 
ICMPBUF
->
off£t
[0] = ICMPBUF->ipoffset[1] = 0;

265 
ICMPBUF
->
‰l
 = 
UIP_TTL
;

266 
ICMPBUF
->
´Ùo
 = 
UIP_PROTO_ICMP
;

269 
ICMPBUF
->
chksum
 = 0;

270 
ICMPBUF
->
chksum
 = ~(
	`u_chksum
());

273 
	}
}

282 
	$fwÿche_»gi¡”
()

284 
fwÿche_’Œy
 *
fw
;

285 
i
, 
Şde¡
;

287 
Şde¡
 = 
FW_TIME
;

288 
fw
 = 
NULL
;

291 
i
 = 0; i < 
FWCACHE_SIZE
; ++i) {

292 if(
fwÿche
[
i
].
tim”
 == 0) {

293 
fw
 = &
fwÿche
[
i
];

295 } if(
fwÿche
[
i
].
tim”
 <ğ
Şde¡
) {

296 
fw
 = &
fwÿche
[
i
];

297 
Şde¡
 = 
fwÿche
[
i
].
tim”
;

301 
fw
->
tim”
 = 
FW_TIME
;

302 
fw
->
id
 = 
BUF
->ipid;

303 
fw
->
¤caddr
[0] = 
BUF
->srcipaddr[0];

304 
fw
->
¤caddr
[1] = 
BUF
->srcipaddr[1];

305 
fw
->
de¡addr
[0] = 
BUF
->destipaddr[0];

306 
fw
->
de¡addr
[1] = 
BUF
->destipaddr[1];

307 
fw
->
´Ùo
 = 
BUF
->proto;

308 #ià
nÙdef


309 
fw
->
·ylßd
[0] = 
BUF
->
¤ıÜt
;

310 
fw
->
·ylßd
[1] = 
BUF
->
de¡pÜt
;

312 #ià
UIP_REASSEMBLY
 > 0

313 
fw
->
Ën
 = 
BUF
->len;

314 
fw
->
off£t
 = 
BUF
->
off£t
;

316 
	}
}

323 
u_fw_Ãtif
 *

324 
	$fšd_Ãtif
()

326 
u_fw_Ãtif
 *
Ãtif
;

329 
Ãtif
 = 
Ãtifs
;‚‘ià!ğ
NULL
;‚‘iàğÃtif->
Ãxt
) {

330 if(
	`addr_maskcmp
(
BUF
->
de¡addr
, 
Ãtif
->
addr
,

331 
Ãtif
->
Ãtmask
)) {

333  
Ãtif
;

338  
deçuÉÃtif
;

339 
	}
}

357 
u8_t


358 
	$u_fw_ouut
()

360 
u_fw_Ãtif
 *
Ãtif
;

362 if(
u_Ën
 == 0) {

363  
UIP_FW_ZEROLEN
;

366 
	`fwÿche_»gi¡”
();

368 #ià
UIP_BROADCAST


371 
BUF
->
de¡addr
[0] == 0xffff &&

372 
BUF
->
de¡addr
[1] == 0xffff) {

373 if(
deçuÉÃtif
 !ğ
NULL
) {

374 
deçuÉÃtif
->
	`ouut
();

376 
Ãtif
 = 
Ãtifs
;‚‘ià!ğ
NULL
;‚‘iàğÃtif->
Ãxt
) {

377 
Ãtif
->
	`ouut
();

379  
UIP_FW_OK
;

383 
Ãtif
 = 
	`fšd_Ãtif
();

388 if(
Ãtif
 =ğ
NULL
) {

389  
UIP_FW_NOROUTE
;

393  
Ãtif
->
	`ouut
();

394 
	}
}

405 
u8_t


406 
	$u_fw_fÜw¬d
()

408 
fwÿche_’Œy
 *
fw
;

412 if(
BUF
->
de¡addr
[0] =ğ
u_ho¡addr
[0] &&

413 
BUF
->
de¡addr
[1] =ğ
u_ho¡addr
[1]) {

414  
UIP_FW_LOCAL
;

419 #ià
UIP_PINGADDRCONF


420 if((
u_ho¡addr
[0] | uip_hostaddr[1]) == 0 &&

421 
BUF
->
´Ùo
 =ğ
UIP_PROTO_ICMP
 &&

422 
ICMPBUF
->
ty³
 =ğ
ICMP_ECHO
) {

423  
UIP_FW_LOCAL
;

430 
fw
 = 
fwÿche
; fw < &fwÿche[
FWCACHE_SIZE
]; ++fw) {

431 if(
fw
->
tim”
 != 0 &&

432 #ià
UIP_REASSEMBLY
 > 0

433 
fw
->
Ën
 =ğ
BUF
->len &&

434 
fw
->
off£t
 =ğ
BUF
->
off£t
 &&

436 
fw
->
id
 =ğ
BUF
->ipid &&

437 
fw
->
¤caddr
[0] =ğ
BUF
->srcipaddr[0] &&

438 
fw
->
¤caddr
[1] =ğ
BUF
->srcipaddr[1] &&

439 
fw
->
de¡addr
[0] =ğ
BUF
->destipaddr[0] &&

440 
fw
->
de¡addr
[1] =ğ
BUF
->destipaddr[1] &&

441 #ià
nÙdef


442 
fw
->
·ylßd
[0] =ğ
BUF
->
¤ıÜt
 &&

443 
fw
->
·ylßd
[1] =ğ
BUF
->
de¡pÜt
 &&

445 
fw
->
´Ùo
 =ğ
BUF
->proto) {

447  
UIP_FW_FORWARDED
;

454 if(
BUF
->
‰l
 <= 1) {

456 if(
BUF
->
de¡addr
[0] == 0xffff && BUF->destipaddr[1] == 0xffff) {

457  
UIP_FW_LOCAL
;

459 
	`time_exûeded
();

463 
BUF
->
‰l
 = BUF->ttl - 1;

466 if(
BUF
->
chksum
 >ğ
	`HTONS
(0xffff - 0x0100)) {

467 
BUF
->
chksum
 = BUF->chksum + 
	`HTONS
(0x0100) + 1;

469 
BUF
->
chksum
 = BUF->chksum + 
	`HTONS
(0x0100);

472 if(
u_Ën
 > 0) {

473 
u_­pd©a
 = &
u_buf
[
UIP_LLH_LEN
 + 
UIP_TCPIP_HLEN
];

474 
	`u_fw_ouut
();

477 #ià
UIP_BROADCAST


478 if(
BUF
->
de¡addr
[0] == 0xffff && BUF->destipaddr[1] == 0xffff) {

479  
UIP_FW_LOCAL
;

485  
UIP_FW_FORWARDED
;

486 
	}
}

496 
	$u_fw_»gi¡”
(
u_fw_Ãtif
 *
Ãtif
)

498 
Ãtif
->
Ãxt
 = 
Ãtifs
;

499 
Ãtifs
 = 
Ãtif
;

500 
	}
}

513 
	$u_fw_deçuÉ
(
u_fw_Ãtif
 *
Ãtif
)

515 
deçuÉÃtif
 = 
Ãtif
;

516 
	}
}

523 
	$u_fw_³riodic
()

525 
fwÿche_’Œy
 *
fw
;

526 
fw
 = 
fwÿche
; fw < &fwÿche[
FWCACHE_SIZE
]; ++fw) {

527 if(
fw
->
tim”
 > 0) {

528 --
fw
->
tim”
;

531 
	}
}

	@uip/uip-fw.h

46 #iâdeà
__UIP_FW_H__


47 
	#__UIP_FW_H__


	)

49 
	~"u.h
"

54 
	su_fw_Ãtif
 {

55 
u_fw_Ãtif
 *
	mÃxt
;

57 
u16_t
 
	maddr
[2];

58 
u16_t
 
	mÃtmask
[2];

59 
u8_t
 (* 
ouut
)();

80 
	#UIP_FW_NETIF
(
1
,
2
,
3
,
4
, 
nm1
,
nm2
,
nm3
,
nm4
, 
ouutfunc
) \

81 
NULL
, \

82 {
	`HTONS
((
1
 << 8è| 
2
), HTONS((
3
 << 8è| 
4
)}, \

83 {
	`HTONS
((
nm1
 << 8è| 
nm2
), HTONS((
nm3
 << 8è| 
nm4
)}, \

84 
ouutfunc


	)

95 
	#u_fw_£taddr
(
Ãtif
, 
addr
) \

96 dØ{ (
Ãtif
)->
addr
[0] = ((
u16_t
 *)(
addr
))[0]; \

97 (
Ãtif
)->
addr
[1] = ((
u16_t
 *)(
addr
))[1]; } 0)

	)

107 
	#u_fw_£Š‘mask
(
Ãtif
, 
addr
) \

108 dØ{ (
Ãtif
)->
Ãtmask
[0] = ((
u16_t
 *)(
addr
))[0]; \

109 (
Ãtif
)->
Ãtmask
[1] = ((
u16_t
 *)(
addr
))[1]; } 0)

	)

111 
u_fw_š™
();

112 
u8_t
 
u_fw_fÜw¬d
();

113 
u8_t
 
u_fw_ouut
();

114 
u_fw_»gi¡”
(
u_fw_Ãtif
 *
Ãtif
);

115 
u_fw_deçuÉ
(
u_fw_Ãtif
 *
Ãtif
);

116 
u_fw_³riodic
();

125 
	#UIP_FW_LOCAL
 0

	)

132 
	#UIP_FW_OK
 0

	)

139 
	#UIP_FW_FORWARDED
 1

	)

147 
	#UIP_FW_ZEROLEN
 2

	)

155 
	#UIP_FW_TOOLARGE
 3

	)

163 
	#UIP_FW_NOROUTE
 4

	)

171 
	#UIP_FW_DROPPED
 5

	)

	@uip/uip-neighbor.c

42 
	~"u-ÃighbÜ.h
"

44 
	~<¡ršg.h
>

46 
	#MAX_TIME
 128

	)

48 #ifdeà
UIP_NEIGHBOR_CONF_ENTRIES


49 
	#ENTRIES
 
UIP_NEIGHBOR_CONF_ENTRIES


	)

51 
	#ENTRIES
 8

	)

54 
	sÃighbÜ_’Œy
 {

55 
u_addr_t
 
	maddr
;

56 
u_ÃighbÜ_addr
 
	maddr
;

57 
u8_t
 
	mtime
;

59 
ÃighbÜ_’Œy
 
	g’Œ›s
[
ENTRIES
];

63 
	$u_ÃighbÜ_š™
()

65 
i
;

67 
i
 = 0; i < 
ENTRIES
; ++i) {

68 
’Œ›s
[
i
].
time
 = 
MAX_TIME
;

70 
	}
}

73 
	$u_ÃighbÜ_³riodic
()

75 
i
;

77 
i
 = 0; i < 
ENTRIES
; ++i) {

78 if(
’Œ›s
[
i
].
time
 < 
MAX_TIME
) {

79 
’Œ›s
[
i
].
time
++;

82 
	}
}

85 
	$u_ÃighbÜ_add
(
u_addr_t
 
addr
, 
u_ÃighbÜ_addr
 *
addr
)

87 
i
, 
Şde¡
;

88 
u8_t
 
Şde¡_time
;

90 
	`´štf
("Adding‚eighbor with†ink‡ddress %02x:%02x:%02x:%02x:%02x:%02x\n",

91 
addr
->addr.addr[0],‡ddr->addr.addr[1],‡ddr->addr.addr[2],‡ddr->addr.addr[3],

92 
addr
->addr.addr[4],‡ddr->addr.addr[5]);

95 
Şde¡_time
 = 0;

96 
Şde¡
 = 0;

97 
i
 = 0; i < 
ENTRIES
; ++i) {

98 if(
’Œ›s
[
i
].
time
 =ğ
MAX_TIME
) {

99 
Şde¡
 = 
i
;

102 if(
	`u_addr_cmp
(
’Œ›s
[
i
].
addr
, 
addr
)) {

103 
Şde¡
 = 
i
;

106 if(
’Œ›s
[
i
].
time
 > 
Şde¡_time
) {

107 
Şde¡
 = 
i
;

108 
Şde¡_time
 = 
’Œ›s
[
i
].
time
;

114 
’Œ›s
[
Şde¡
].
time
 = 0;

115 
	`u_addr_cİy
(
’Œ›s
[
Şde¡
].
addr
, ipaddr);

116 
	`memıy
(&
’Œ›s
[
Şde¡
].
addr
,‡ddr, (
u_ÃighbÜ_addr
));

117 
	}
}

119 
ÃighbÜ_’Œy
 *

120 
	$fšd_’Œy
(
u_addr_t
 
addr
)

122 
i
;

124 
i
 = 0; i < 
ENTRIES
; ++i) {

125 if(
	`u_addr_cmp
(
’Œ›s
[
i
].
addr
, ipaddr)) {

126  &
’Œ›s
[
i
];

129  
NULL
;

130 
	}
}

133 
	$u_ÃighbÜ_upd©e
(
u_addr_t
 
addr
)

135 
ÃighbÜ_’Œy
 *
e
;

137 
e
 = 
	`fšd_’Œy
(
addr
);

138 if(
e
 !ğ
NULL
) {

139 
e
->
time
 = 0;

141 
	}
}

143 
u_ÃighbÜ_addr
 *

144 
	$u_ÃighbÜ_lookup
(
u_addr_t
 
addr
)

146 
ÃighbÜ_’Œy
 *
e
;

148 
e
 = 
	`fšd_’Œy
(
addr
);

149 if(
e
 !ğ
NULL
) {

154  &
e
->
addr
;

156  
NULL
;

157 
	}
}

	@uip/uip-neighbor.h

42 #iâdeà
__UIP_NEIGHBOR_H__


43 
	#__UIP_NEIGHBOR_H__


	)

45 
	~"u.h
"

47 
	su_ÃighbÜ_addr
 {

48 #ià
UIP_NEIGHBOR_CONF_ADDRTYPE


49 
UIP_NEIGHBOR_CONF_ADDRTYPE
 
	maddr
;

51 
u_‘h_addr
 
	maddr
;

55 
u_ÃighbÜ_š™
();

56 
u_ÃighbÜ_add
(
u_addr_t
 
addr
, 
u_ÃighbÜ_addr
 *
addr
);

57 
u_ÃighbÜ_upd©e
(
u_addr_t
 
addr
);

58 
u_ÃighbÜ_addr
 *
u_ÃighbÜ_lookup
(
u_addr_t
 
addr
);

59 
u_ÃighbÜ_³riodic
();

	@uip/uip-split.c

36 
	~<¡ršg.h
>

38 
	~"u-¥l™.h
"

39 
	~"u.h
"

40 
	~"u-fw.h
"

41 
	~"u_¬ch.h
"

45 
	#BUF
 ((
u_tı_hdr
 *)&
u_buf
[
UIP_LLH_LEN
])

	)

49 
	$u_¥l™_ouut
()

51 
u16_t
 
tıËn
, 
Ën1
, 
Ën2
;

54 if(
BUF
->
´Ùo
 =ğ
UIP_PROTO_TCP
 &&

55 
u_Ën
 =ğ
UIP_BUFSIZE
 - 
UIP_LLH_LEN
) {

57 
tıËn
 = 
u_Ën
 - 
UIP_TCPIP_HLEN
;

60 
Ën1
 = 
Ën2
 = 
tıËn
 / 2;

61 if(
Ën1
 + 
Ën2
 < 
tıËn
) {

62 ++
Ën2
;

67 
u_Ën
 = 
Ën1
 + 
UIP_TCPIP_HLEN
;

68 #ià
UIP_CONF_IPV6


71 
BUF
->
Ën
[0] = ((
u_Ën
 - 
UIP_IPH_LEN
) >> 8);

72 
BUF
->
Ën
[1] = ((
u_Ën
 - 
UIP_IPH_LEN
) & 0xff);

74 
BUF
->
Ën
[0] = 
u_Ën
 >> 8;

75 
BUF
->
Ën
[1] = 
u_Ën
 & 0xff;

79 
BUF
->
tıchksum
 = 0;

80 
BUF
->
tıchksum
 = ~(
	`u_tıchksum
());

82 #ià!
UIP_CONF_IPV6


84 
BUF
->
chksum
 = 0;

85 
BUF
->
chksum
 = ~(
	`u_chksum
());

90 
	`tı_ouut
();

97 
u_Ën
 = 
Ën2
 + 
UIP_TCPIP_HLEN
;

98 #ià
UIP_CONF_IPV6


101 
BUF
->
Ën
[0] = ((
u_Ën
 - 
UIP_IPH_LEN
) >> 8);

102 
BUF
->
Ën
[1] = ((
u_Ën
 - 
UIP_IPH_LEN
) & 0xff);

104 
BUF
->
Ën
[0] = 
u_Ën
 >> 8;

105 
BUF
->
Ën
[1] = 
u_Ën
 & 0xff;

109 
	`memıy
(
u_­pd©a
, (
u8_t
 *)u_­pd©¨+ 
Ën1
, 
Ën2
);

111 
	`u_add32
(
BUF
->
£qno
, 
Ën1
);

112 
BUF
->
£qno
[0] = 
u_acc32
[0];

113 
BUF
->
£qno
[1] = 
u_acc32
[1];

114 
BUF
->
£qno
[2] = 
u_acc32
[2];

115 
BUF
->
£qno
[3] = 
u_acc32
[3];

118 
BUF
->
tıchksum
 = 0;

119 
BUF
->
tıchksum
 = ~(
	`u_tıchksum
());

121 #ià!
UIP_CONF_IPV6


123 
BUF
->
chksum
 = 0;

124 
BUF
->
chksum
 = ~(
	`u_chksum
());

129 
	`tı_ouut
();

132 
	`tı_ouut
();

135 
	}
}

	@uip/uip-split.h

72 #iâdeà
__UIP_SPLIT_H__


73 
	#__UIP_SPLIT_H__


	)

91 
u_¥l™_ouut
();

	@uip/uip.c

1 
	#DEBUG_PRINTF
(...è

	)

82 
	~"u.h
"

83 
	~"uİt.h
"

84 
	~"u_¬ch.h
"

86 #ià
UIP_CONF_IPV6


87 
	~"u-ÃighbÜ.h
"

90 
	~<¡ršg.h
>

99 #ià
UIP_FIXEDADDR
 > 0

100 cÚ¡ 
u_addr_t
 
	gu_ho¡addr
 =

101 {
HTONS
((
UIP_IPADDR0
 << 8è| 
UIP_IPADDR1
),

102 
HTONS
((
UIP_IPADDR2
 << 8è| 
UIP_IPADDR3
)};

103 cÚ¡ 
u_addr_t
 
	gu_d¿ddr
 =

104 {
HTONS
((
UIP_DRIPADDR0
 << 8è| 
UIP_DRIPADDR1
),

105 
HTONS
((
UIP_DRIPADDR2
 << 8è| 
UIP_DRIPADDR3
)};

106 cÚ¡ 
u_addr_t
 
	gu_Ãtmask
 =

107 {
HTONS
((
UIP_NETMASK0
 << 8è| 
UIP_NETMASK1
),

108 
HTONS
((
UIP_NETMASK2
 << 8è| 
UIP_NETMASK3
)};

110 
u_addr_t
 
	gu_ho¡addr
, 
	gu_d¿ddr
, 
	gu_Ãtmask
;

113 cÚ¡ 
u_addr_t
 
	g®l_Úes_addr
 =

114 #ià
UIP_CONF_IPV6


119 cÚ¡ 
u_addr_t
 
	g®l_z”Ûs_addr
 =

120 #ià
UIP_CONF_IPV6


127 #ià
UIP_FIXEDETHADDR


128 cÚ¡ 
u_‘h_addr
 
	gu_‘haddr
 = {{
UIP_ETHADDR0
,

129 
UIP_ETHADDR1
,

130 
UIP_ETHADDR2
,

131 
UIP_ETHADDR3
,

132 
UIP_ETHADDR4
,

133 
UIP_ETHADDR5
}};

135 
u_‘h_addr
 
	gu_‘haddr
 = {{0,0,0,0,0,0}};

138 #iâdeà
UIP_CONF_EXTERNAL_BUFFER


139 
u8_t
 
	gu_buf
[
UIP_BUFSIZE
 + 2];

143 *
	gu_­pd©a
;

145 *
	gu_§µd©a
;

148 #ià
UIP_URGDATA
 > 0

149 *
	gu_urgd©a
;

152 
u16_t
 
	gu_urgËn
, 
	gu_surgËn
;

155 
u16_t
 
	gu_Ën
, 
	gu_¦’
;

160 
u8_t
 
	gu_æags
;

163 
u_cÚn
 *
	gu_cÚn
;

166 
u_cÚn
 
	gu_cÚns
[
UIP_CONNS
];

169 
u16_t
 
	gu_li¡’pÜts
[
UIP_LISTENPORTS
];

172 #ià
UIP_UDP


173 
u_udp_cÚn
 *
	gu_udp_cÚn
;

174 
u_udp_cÚn
 
	gu_udp_cÚns
[
UIP_UDP_CONNS
];

177 
u16_t
 
	gid
;

181 
	$u_£tid
(
u16_t
 
id
è{ 
id
 = id; 
	}
}

183 
u8_t
 
	giss
[4];

186 #ià
UIP_ACTIVE_OPEN


187 
u16_t
 
	gÏ¡pÜt
;

192 
u8_t
 
	gu_acc32
[4];

193 
u8_t
 
	gc
, 
	gİt
;

194 
u16_t
 
	gtmp16
;

197 
	#TCP_FIN
 0x01

	)

198 
	#TCP_SYN
 0x02

	)

199 
	#TCP_RST
 0x04

	)

200 
	#TCP_PSH
 0x08

	)

201 
	#TCP_ACK
 0x10

	)

202 
	#TCP_URG
 0x20

	)

203 
	#TCP_CTL
 0x3f

	)

205 
	#TCP_OPT_END
 0

	)

206 
	#TCP_OPT_NOOP
 1

	)

207 
	#TCP_OPT_MSS
 2

	)

209 
	#TCP_OPT_MSS_LEN
 4

	)

211 
	#ICMP_ECHO_REPLY
 0

	)

212 
	#ICMP_ECHO
 8

	)

214 
	#ICMP6_ECHO_REPLY
 129

	)

215 
	#ICMP6_ECHO
 128

	)

216 
	#ICMP6_NEIGHBOR_SOLICITATION
 135

	)

217 
	#ICMP6_NEIGHBOR_ADVERTISEMENT
 136

	)

219 
	#ICMP6_FLAG_S
 (1 << 6)

	)

221 
	#ICMP6_OPTION_SOURCE_LINK_ADDRESS
 1

	)

222 
	#ICMP6_OPTION_TARGET_LINK_ADDRESS
 2

	)

226 
	#BUF
 ((
u_tı_hdr
 *)&
u_buf
[
UIP_LLH_LEN
])

	)

227 
	#FBUF
 ((
u_tı_hdr
 *)&
u_»assbuf
[0])

	)

228 
	#ICMPBUF
 ((
u_icmp_hdr
 *)&
u_buf
[
UIP_LLH_LEN
])

	)

229 
	#UDPBUF
 ((
u_udp_hdr
 *)&
u_buf
[
UIP_LLH_LEN
])

	)

232 #ià
UIP_STATISTICS
 == 1

233 
u_¡©s
 
	gu_¡©
;

234 
	#UIP_STAT
(
s
è
	)
s

236 
	#UIP_STAT
(
s
)

	)

239 #ià
UIP_LOGGING
 == 1

240 
	~<¡dio.h
>

241 
u_log
(*
msg
);

242 
	#UIP_LOG
(
m
è
	`u_log
(m)

	)

244 
	#UIP_LOG
(
m
)

	)

247 #ià! 
UIP_ARCH_ADD32


249 
	$u_add32
(
u8_t
 *
İ32
, 
u16_t
 
İ16
)

251 
u_acc32
[3] = 
İ32
[3] + (
İ16
 & 0xff);

252 
u_acc32
[2] = 
İ32
[2] + (
İ16
 >> 8);

253 
u_acc32
[1] = 
İ32
[1];

254 
u_acc32
[0] = 
İ32
[0];

256 if(
u_acc32
[2] < (
İ16
 >> 8)) {

257 ++
u_acc32
[1];

258 if(
u_acc32
[1] == 0) {

259 ++
u_acc32
[0];

264 if(
u_acc32
[3] < (
İ16
 & 0xff)) {

265 ++
u_acc32
[2];

266 if(
u_acc32
[2] == 0) {

267 ++
u_acc32
[1];

268 if(
u_acc32
[1] == 0) {

269 ++
u_acc32
[0];

273 
	}
}

277 #ià! 
UIP_ARCH_CHKSUM


279 
u16_t


280 
	$chksum
(
u16_t
 
sum
, cÚ¡ 
u8_t
 *
d©a
, u16_ˆ
Ën
)

282 
u16_t
 
t
;

283 cÚ¡ 
u8_t
 *
d©­Œ
;

284 cÚ¡ 
u8_t
 *
Ï¡_by‹
;

286 
d©­Œ
 = 
d©a
;

287 
Ï¡_by‹
 = 
d©a
 + 
Ën
 - 1;

289 
d©­Œ
 < 
Ï¡_by‹
) {

290 
t
 = (
d©­Œ
[0] << 8) + dataptr[1];

291 
sum
 +ğ
t
;

292 if(
sum
 < 
t
) {

293 
sum
++;

295 
d©­Œ
 += 2;

298 if(
d©­Œ
 =ğ
Ï¡_by‹
) {

299 
t
 = (
d©­Œ
[0] << 8) + 0;

300 
sum
 +ğ
t
;

301 if(
sum
 < 
t
) {

302 
sum
++;

307  
sum
;

308 
	}
}

310 
u16_t


311 
	$u_chksum
(
u16_t
 *
d©a
, u16_ˆ
Ën
)

313  
	`htÚs
(
	`chksum
(0, (
u8_t
 *)
d©a
, 
Ën
));

314 
	}
}

316 #iâdeà
UIP_ARCH_IPCHKSUM


317 
u16_t


318 
	$u_chksum
()

320 
u16_t
 
sum
;

322 
sum
 = 
	`chksum
(0, &
u_buf
[
UIP_LLH_LEN
], 
UIP_IPH_LEN
);

323 
	`DEBUG_PRINTF
("u_chksum: sum 0x%04x\n", 
sum
);

324  (
sum
 =ğ0è? 0xfffà: 
	`htÚs
(sum);

325 
	}
}

328 
u16_t


329 
	$uµ”_Ïy”_chksum
(
u8_t
 
´Ùo
)

331 
u16_t
 
uµ”_Ïy”_Ën
;

332 
u16_t
 
sum
;

334 #ià
UIP_CONF_IPV6


335 
uµ”_Ïy”_Ën
 = (((
u16_t
)(
BUF
->
Ën
[0]) << 8) + BUF->len[1]);

337 
uµ”_Ïy”_Ën
 = (((
u16_t
)(
BUF
->
Ën
[0]è<< 8è+ BUF->Ën[1]è- 
UIP_IPH_LEN
;

343 
sum
 = 
uµ”_Ïy”_Ën
 + 
´Ùo
;

345 
sum
 = 
	`chksum
(sum, (
u8_t
 *)&
BUF
->
¤caddr
[0], 2 * (
u_addr_t
));

348 
sum
 = 
	`chksum
(sum, &
u_buf
[
UIP_IPH_LEN
 + 
UIP_LLH_LEN
],

349 
uµ”_Ïy”_Ën
);

351  (
sum
 =ğ0è? 0xfffà: 
	`htÚs
(sum);

352 
	}
}

354 #ià
UIP_CONF_IPV6


355 
u16_t


356 
	$u_icmp6chksum
()

358  
	`uµ”_Ïy”_chksum
(
UIP_PROTO_ICMP6
);

360 
	}
}

363 
u16_t


364 
	$u_tıchksum
()

366  
	`uµ”_Ïy”_chksum
(
UIP_PROTO_TCP
);

367 
	}
}

369 #ià
UIP_UDP_CHECKSUMS


370 
u16_t


371 
	$u_udpchksum
()

373  
	`uµ”_Ïy”_chksum
(
UIP_PROTO_UDP
);

374 
	}
}

379 
	$u_š™
()

381 
c
 = 0; c < 
UIP_LISTENPORTS
; ++c) {

382 
u_li¡’pÜts
[
c
] = 0;

384 
c
 = 0; c < 
UIP_CONNS
; ++c) {

385 
u_cÚns
[
c
].
tı¡©eæags
 = 
UIP_CLOSED
;

387 #ià
UIP_ACTIVE_OPEN


388 
Ï¡pÜt
 = 1024;

391 #ià
UIP_UDP


392 
c
 = 0; c < 
UIP_UDP_CONNS
; ++c) {

393 
u_udp_cÚns
[
c
].
ÍÜt
 = 0;

399 #ià
UIP_FIXEDADDR
 == 0

403 
	}
}

405 #ià
UIP_ACTIVE_OPEN


406 
u_cÚn
 *

407 
	$u_cÚÃù
(
u_addr_t
 *
raddr
, 
u16_t
 
½Üt
)

409 
u_cÚn
 *
cÚn
, *
ccÚn
;

412 
agaš
:

413 ++
Ï¡pÜt
;

415 if(
Ï¡pÜt
 >= 32000) {

416 
Ï¡pÜt
 = 4096;

421 
c
 = 0; c < 
UIP_CONNS
; ++c) {

422 
cÚn
 = &
u_cÚns
[
c
];

423 if(
cÚn
->
tı¡©eæags
 !ğ
UIP_CLOSED
 &&

424 
cÚn
->
ÍÜt
 =ğ
	`htÚs
(
Ï¡pÜt
)) {

425 
agaš
;

429 
cÚn
 = 0;

430 
c
 = 0; c < 
UIP_CONNS
; ++c) {

431 
ccÚn
 = &
u_cÚns
[
c
];

432 if(
ccÚn
->
tı¡©eæags
 =ğ
UIP_CLOSED
) {

433 
cÚn
 = 
ccÚn
;

436 if(
ccÚn
->
tı¡©eæags
 =ğ
UIP_TIME_WAIT
) {

437 if(
cÚn
 == 0 ||

438 
ccÚn
->
tim”
 > 
cÚn
->timer) {

439 
cÚn
 = 
ccÚn
;

444 if(
cÚn
 == 0) {

448 
cÚn
->
tı¡©eæags
 = 
UIP_SYN_SENT
;

450 
cÚn
->
¢d_nxt
[0] = 
iss
[0];

451 
cÚn
->
¢d_nxt
[1] = 
iss
[1];

452 
cÚn
->
¢d_nxt
[2] = 
iss
[2];

453 
cÚn
->
¢d_nxt
[3] = 
iss
[3];

455 
cÚn
->
š™Ÿlmss
 = cÚn->
mss
 = 
UIP_TCP_MSS
;

457 
cÚn
->
Ën
 = 1;

458 
cÚn
->
Ätx
 = 0;

459 
cÚn
->
tim”
 = 1;

460 
cÚn
->
¹o
 = 
UIP_RTO
;

461 
cÚn
->
§
 = 0;

462 
cÚn
->
sv
 = 16;

463 
cÚn
->
ÍÜt
 = 
	`htÚs
(
Ï¡pÜt
);

464 
cÚn
->
½Üt
 =„port;

465 
	`u_addr_cİy
(&
cÚn
->
raddr
,„ipaddr);

467  
cÚn
;

468 
	}
}

471 #ià
UIP_UDP


472 
u_udp_cÚn
 *

473 
	$u_udp_Ãw
(
u_addr_t
 *
raddr
, 
u16_t
 
½Üt
)

475 
u_udp_cÚn
 *
cÚn
;

478 
agaš
:

479 ++
Ï¡pÜt
;

481 if(
Ï¡pÜt
 >= 32000) {

482 
Ï¡pÜt
 = 4096;

485 
c
 = 0; c < 
UIP_UDP_CONNS
; ++c) {

486 if(
u_udp_cÚns
[
c
].
ÍÜt
 =ğ
	`htÚs
(
Ï¡pÜt
)) {

487 
agaš
;

492 
cÚn
 = 0;

493 
c
 = 0; c < 
UIP_UDP_CONNS
; ++c) {

494 if(
u_udp_cÚns
[
c
].
ÍÜt
 == 0) {

495 
cÚn
 = &
u_udp_cÚns
[
c
];

500 if(
cÚn
 == 0) {

504 
cÚn
->
ÍÜt
 = 
	`HTONS
(
Ï¡pÜt
);

505 
cÚn
->
½Üt
 =„port;

506 if(
raddr
 =ğ
NULL
) {

507 
	`mem£t
(
cÚn
->
raddr
, 0, (
u_addr_t
));

509 
	`u_addr_cİy
(&
cÚn
->
raddr
,„ipaddr);

511 
cÚn
->
‰l
 = 
UIP_TTL
;

513  
cÚn
;

514 
	}
}

518 
	$u_uÆi¡’
(
u16_t
 
pÜt
)

520 
c
 = 0; c < 
UIP_LISTENPORTS
; ++c) {

521 if(
u_li¡’pÜts
[
c
] =ğ
pÜt
) {

522 
u_li¡’pÜts
[
c
] = 0;

526 
	}
}

529 
	$u_li¡’
(
u16_t
 
pÜt
)

531 
c
 = 0; c < 
UIP_LISTENPORTS
; ++c) {

532 if(
u_li¡’pÜts
[
c
] == 0) {

533 
u_li¡’pÜts
[
c
] = 
pÜt
;

537 
	}
}

541 #ià
UIP_REASSEMBLY
 && !
UIP_CONF_IPV6


542 
	#UIP_REASS_BUFSIZE
 (
UIP_BUFSIZE
 - 
UIP_LLH_LEN
)

	)

543 
u8_t
 
	gu_»assbuf
[
UIP_REASS_BUFSIZE
];

544 
u8_t
 
	gu_»assb™m­
[
UIP_REASS_BUFSIZE
 / (8 * 8)];

545 cÚ¡ 
u8_t
 
	gb™m­_b™s
[8] = {0xff, 0x7f, 0x3f, 0x1f,

547 
u16_t
 
	gu_»as¦’
;

548 
u8_t
 
	gu_»assæags
;

549 
	#UIP_REASS_FLAG_LASTFRAG
 0x01

	)

550 
u8_t
 
	gu_»as¡mr
;

552 
	#IP_MF
 0x20

	)

554 
u8_t


555 
	$u_»ass
()

557 
u16_t
 
off£t
, 
Ën
;

558 
u16_t
 
i
;

563 if(
u_»as¡mr
 == 0) {

564 
	`memıy
(
u_»assbuf
, &
BUF
->
vhl
, 
UIP_IPH_LEN
);

565 
u_»as¡mr
 = 
UIP_REASS_MAXAGE
;

566 
u_»assæags
 = 0;

568 
	`mem£t
(
u_»assb™m­
, 0, (uip_reassbitmap));

574 if(
BUF
->
¤caddr
[0] =ğ
FBUF
->srcipaddr[0] &&

575 
BUF
->
¤caddr
[1] =ğ
FBUF
->srcipaddr[1] &&

576 
BUF
->
de¡addr
[0] =ğ
FBUF
->destipaddr[0] &&

577 
BUF
->
de¡addr
[1] =ğ
FBUF
->destipaddr[1] &&

578 
BUF
->
id
[0] =ğ
FBUF
->ipid[0] &&

579 
BUF
->
id
[1] =ğ
FBUF
->ipid[1]) {

581 
Ën
 = (
BUF
->Ën[0] << 8è+ BUF->Ën[1] - (BUF->
vhl
 & 0x0f) * 4;

582 
off£t
 = (((
BUF
->
off£t
[0] & 0x3f) << 8) + BUF->ipoffset[1]) * 8;

586 if(
off£t
 > 
UIP_REASS_BUFSIZE
 ||

587 
off£t
 + 
Ën
 > 
UIP_REASS_BUFSIZE
) {

588 
u_»as¡mr
 = 0;

589 
nuÎ»tuº
;

594 
	`memıy
(&
u_»assbuf
[
UIP_IPH_LEN
 + 
off£t
],

595 (*)
BUF
 + ()((BUF->
vhl
 & 0x0f) * 4),

596 
Ën
);

599 if(
off£t
 / (8 * 8è=ğ(off£ˆ+ 
Ën
) / (8 * 8)) {

603 
u_»assb™m­
[
off£t
 / (8 * 8)] |=

604 
b™m­_b™s
[(
off£t
 / 8 ) & 7] &

605 ~
b™m­_b™s
[((
off£t
 + 
Ën
) / 8 ) & 7];

610 
u_»assb™m­
[
off£t
 / (8 * 8)] |=

611 
b™m­_b™s
[(
off£t
 / 8 ) & 7];

612 
i
 = 1 + 
off£t
 / (8 * 8); i < (off£ˆ+ 
Ën
) / (8 * 8); ++i) {

613 
u_»assb™m­
[
i
] = 0xff;

615 
u_»assb™m­
[(
off£t
 + 
Ën
) / (8 * 8)] |=

616 ~
b™m­_b™s
[((
off£t
 + 
Ën
) / 8 ) & 7];

625 if((
BUF
->
off£t
[0] & 
IP_MF
) == 0) {

626 
u_»assæags
 |ğ
UIP_REASS_FLAG_LASTFRAG
;

627 
u_»as¦’
 = 
off£t
 + 
Ën
;

633 if(
u_»assæags
 & 
UIP_REASS_FLAG_LASTFRAG
) {

636 
i
 = 0; i < 
u_»as¦’
 / (8 * 8) - 1; ++i) {

637 if(
u_»assb™m­
[
i
] != 0xff) {

638 
nuÎ»tuº
;

643 if(
u_»assb™m­
[
u_»as¦’
 / (8 * 8)] !=

644 (
u8_t
)~
b™m­_b™s
[
u_»as¦’
 / 8 & 7]) {

645 
nuÎ»tuº
;

651 
u_»as¡mr
 = 0;

652 
	`memıy
(
BUF
, 
FBUF
, 
u_»as¦’
);

656 
BUF
->
off£t
[0] = BUF->ipoffset[1] = 0;

657 
BUF
->
Ën
[0] = 
u_»as¦’
 >> 8;

658 
BUF
->
Ën
[1] = 
u_»as¦’
 & 0xff;

659 
BUF
->
chksum
 = 0;

660 
BUF
->
chksum
 = ~(
	`u_chksum
());

662  
u_»as¦’
;

666 
nuÎ»tuº
:

668 
	}
}

672 
	$u_add_rcv_nxt
(
u16_t
 
n
)

674 
	`u_add32
(
u_cÚn
->
rcv_nxt
, 
n
);

675 
u_cÚn
->
rcv_nxt
[0] = 
u_acc32
[0];

676 
u_cÚn
->
rcv_nxt
[1] = 
u_acc32
[1];

677 
u_cÚn
->
rcv_nxt
[2] = 
u_acc32
[2];

678 
u_cÚn
->
rcv_nxt
[3] = 
u_acc32
[3];

679 
	}
}

682 
	$u_´oûss
(
u8_t
 
æag
)

684 
u_cÚn
 *
u_cÚÄ
 = uip_conn;

686 #ià
UIP_UDP


687 if(
æag
 =ğ
UIP_UDP_SEND_CONN
) {

688 
udp_£nd
;

692 
u_§µd©a
 = 
u_­pd©a
 = &
u_buf
[
UIP_IPTCPH_LEN
 + 
UIP_LLH_LEN
];

696 if(
æag
 =ğ
UIP_POLL_REQUEST
) {

697 if((
u_cÚÄ
->
tı¡©eæags
 & 
UIP_TS_MASK
è=ğ
UIP_ESTABLISHED
 &&

698 !
	`u_out¡ªdšg
(
u_cÚÄ
)) {

699 
u_æags
 = 
UIP_POLL
;

700 
	`UIP_APPCALL
();

701 
­p£nd
;

703 
drİ
;

706 } if(
æag
 =ğ
UIP_TIMER
) {

707 #ià
UIP_REASSEMBLY


708 if(
u_»as¡mr
 != 0) {

709 --
u_»as¡mr
;

713 if(++
iss
[3] == 0) {

714 if(++
iss
[2] == 0) {

715 if(++
iss
[1] == 0) {

716 ++
iss
[0];

722 
u_Ën
 = 0;

723 
u_¦’
 = 0;

729 if(
u_cÚÄ
->
tı¡©eæags
 =ğ
UIP_TIME_WAIT
 ||

730 
u_cÚÄ
->
tı¡©eæags
 =ğ
UIP_FIN_WAIT_2
) {

731 ++(
u_cÚÄ
->
tim”
);

732 if(
u_cÚÄ
->
tim”
 =ğ
UIP_TIME_WAIT_TIMEOUT
) {

733 
u_cÚÄ
->
tı¡©eæags
 = 
UIP_CLOSED
;

735 } if(
u_cÚÄ
->
tı¡©eæags
 !ğ
UIP_CLOSED
) {

739 if(
	`u_out¡ªdšg
(
u_cÚÄ
)) {

740 if(
u_cÚÄ
->
tim”
-- == 0) {

741 if(
u_cÚÄ
->
Ätx
 =ğ
UIP_MAXRTX
 ||

742 ((
u_cÚÄ
->
tı¡©eæags
 =ğ
UIP_SYN_SENT
 ||

743 
u_cÚÄ
->
tı¡©eæags
 =ğ
UIP_SYN_RCVD
) &&

744 
u_cÚÄ
->
Ätx
 =ğ
UIP_MAXSYNRTX
)) {

745 
u_cÚÄ
->
tı¡©eæags
 = 
UIP_CLOSED
;

750 
u_æags
 = 
UIP_TIMEDOUT
;

751 
	`UIP_APPCALL
();

754 
BUF
->
æags
 = 
TCP_RST
 | 
TCP_ACK
;

755 
tı_£nd_nod©a
;

759 
u_cÚÄ
->
tim”
 = 
UIP_RTO
 << (u_cÚÄ->
Ätx
 > 4?

761 
u_cÚÄ
->
Ätx
);

762 ++(
u_cÚÄ
->
Ätx
);

770 
	`UIP_STAT
(++
u_¡©
.
tı
.
»xm™
);

771 
u_cÚÄ
->
tı¡©eæags
 & 
UIP_TS_MASK
) {

772 
UIP_SYN_RCVD
:

775 
tı_£nd_syÇck
;

777 #ià
UIP_ACTIVE_OPEN


778 
UIP_SYN_SENT
:

780 
BUF
->
æags
 = 0;

781 
tı_£nd_syn
;

784 
UIP_ESTABLISHED
:

789 
u_æags
 = 
UIP_REXMIT
;

790 
	`UIP_APPCALL
();

791 
­´exm™
;

793 
UIP_FIN_WAIT_1
:

794 
UIP_CLOSING
:

795 
UIP_LAST_ACK
:

797 
tı_£nd_fšack
;

801 } if((
u_cÚÄ
->
tı¡©eæags
 & 
UIP_TS_MASK
è=ğ
UIP_ESTABLISHED
) {

804 
u_æags
 = 
UIP_POLL
;

805 
	`UIP_APPCALL
();

806 
­p£nd
;

809 
drİ
;

811 #ià
UIP_UDP


812 if(
æag
 =ğ
UIP_UDP_TIMER
) {

813 if(
u_udp_cÚn
->
ÍÜt
 != 0) {

814 
u_cÚn
 = 
NULL
;

815 
u_§µd©a
 = 
u_­pd©a
 = &
u_buf
[
UIP_LLH_LEN
 + 
UIP_IPUDPH_LEN
];

816 
u_Ën
 = 
u_¦’
 = 0;

817 
u_æags
 = 
UIP_POLL
;

818 
	`UIP_UDP_APPCALL
();

819 
udp_£nd
;

821 
drİ
;

827 
	`UIP_STAT
(++
u_¡©
.

.
»cv
);

831 #ià
UIP_CONF_IPV6


833 if((
BUF
->
vtc
 & 0xf0) != 0x60) {

834 
	`UIP_STAT
(++
u_¡©
.

.
drİ
);

835 
	`UIP_STAT
(++
u_¡©
.

.
vhË¼
);

836 
	`UIP_LOG
("ipv6: invalid version.");

837 
drİ
;

841 if(
BUF
->
vhl
 != 0x45) {

842 
	`UIP_STAT
(++
u_¡©
.

.
drİ
);

843 
	`UIP_STAT
(++
u_¡©
.

.
vhË¼
);

844 
	`UIP_LOG
("ip: invalid version or header†ength.");

845 
drİ
;

856 if((
BUF
->
Ën
[0] << 8è+ BUF->Ën[1] <ğ
u_Ën
) {

857 
u_Ën
 = (
BUF
->
Ën
[0] << 8) + BUF->len[1];

858 #ià
UIP_CONF_IPV6


859 
u_Ën
 += 40;

870 
	`UIP_LOG
("ip:…acket shorterhan„eported in IP header.");

871 
drİ
;

874 #ià!
UIP_CONF_IPV6


876 if((
BUF
->
off£t
[0] & 0x3f) != 0 ||

877 
BUF
->
off£t
[1] != 0) {

878 #ià
UIP_REASSEMBLY


879 
u_Ën
 = 
	`u_»ass
();

880 if(
u_Ën
 == 0) {

881 
drİ
;

884 
	`UIP_STAT
(++
u_¡©
.

.
drİ
);

885 
	`UIP_STAT
(++
u_¡©
.

.
äag”r
);

886 
	`UIP_LOG
("ip: fragment dropped.");

887 
drİ
;

892 if(
	`u_addr_cmp
(
u_ho¡addr
, 
®l_z”Ûs_addr
)) {

896 #ià
UIP_PINGADDRCONF
 && !
UIP_CONF_IPV6


897 if(
BUF
->
´Ùo
 =ğ
UIP_PROTO_ICMP
) {

898 
	`UIP_LOG
("ip:…ossible…ing config…acket„eceived.");

899 
icmp_šput
;

901 
	`UIP_LOG
("ip:…acket dropped since‚o‡ddress‡ssigned.");

902 
drİ
;

909 #ià
UIP_BROADCAST


910 
	`DEBUG_PRINTF
("UDP IP checksum 0x%04x\n", 
	`u_chksum
());

911 if(
BUF
->
´Ùo
 =ğ
UIP_PROTO_UDP
 &&

912 
	`u_addr_cmp
(
BUF
->
de¡addr
, 
®l_Úes_addr
)

915 
udp_šput
;

920 #ià!
UIP_CONF_IPV6


921 if(!
	`u_addr_cmp
(
BUF
->
de¡addr
, 
u_ho¡addr
)) {

922 
	`UIP_STAT
(++
u_¡©
.

.
drİ
);

923 
drİ
;

931 if(!
	`u_addr_cmp
(
BUF
->
de¡addr
, 
u_ho¡addr
) &&

932 
BUF
->
de¡addr
[0] !ğ
	`HTONS
(0xff02)) {

933 
	`UIP_STAT
(++
u_¡©
.

.
drİ
);

934 
drİ
;

939 #ià!
UIP_CONF_IPV6


940 if(
	`u_chksum
() != 0xffff) {

942 
	`UIP_STAT
(++
u_¡©
.

.
drİ
);

943 
	`UIP_STAT
(++
u_¡©
.

.
chk”r
);

944 
	`UIP_LOG
("ip: bad checksum.");

945 
drİ
;

949 if(
BUF
->
´Ùo
 =ğ
UIP_PROTO_TCP
) {

952 
tı_šput
;

955 #ià
UIP_UDP


956 if(
BUF
->
´Ùo
 =ğ
UIP_PROTO_UDP
) {

957 
udp_šput
;

961 #ià!
UIP_CONF_IPV6


963 if(
BUF
->
´Ùo
 !ğ
UIP_PROTO_ICMP
) {

965 
	`UIP_STAT
(++
u_¡©
.

.
drİ
);

966 
	`UIP_STAT
(++
u_¡©
.

.
´ÙÛ¼
);

967 
	`UIP_LOG
("ip:‚eithercp‚or icmp.");

968 
drİ
;

971 #ià
UIP_PINGADDRCONF


972 
icmp_šput
:

974 
	`UIP_STAT
(++
u_¡©
.
icmp
.
»cv
);

979 if(
ICMPBUF
->
ty³
 !ğ
ICMP_ECHO
) {

980 
	`UIP_STAT
(++
u_¡©
.
icmp
.
drİ
);

981 
	`UIP_STAT
(++
u_¡©
.
icmp
.
ty³”r
);

982 
	`UIP_LOG
("icmp:‚ot icmpƒcho.");

983 
drİ
;

989 #ià
UIP_PINGADDRCONF


990 if((
u_ho¡addr
[0] | uip_hostaddr[1]) == 0) {

991 
u_ho¡addr
[0] = 
BUF
->
de¡addr
[0];

992 
u_ho¡addr
[1] = 
BUF
->
de¡addr
[1];

996 
ICMPBUF
->
ty³
 = 
ICMP_ECHO_REPLY
;

998 if(
ICMPBUF
->
icmpchksum
 >ğ
	`HTONS
(0xfffà- (
ICMP_ECHO
 << 8))) {

999 
ICMPBUF
->
icmpchksum
 +ğ
	`HTONS
(
ICMP_ECHO
 << 8) + 1;

1001 
ICMPBUF
->
icmpchksum
 +ğ
	`HTONS
(
ICMP_ECHO
 << 8);

1005 
	`u_addr_cİy
(
BUF
->
de¡addr
, BUF->
¤caddr
);

1006 
	`u_addr_cİy
(
BUF
->
¤caddr
, 
u_ho¡addr
);

1008 
	`UIP_STAT
(++
u_¡©
.
icmp
.
£Á
);

1009 
£nd
;

1015 
	`DEBUG_PRINTF
("icmp6_šput:†’gth %d\n", 
u_Ën
);

1017 if(
BUF
->
´Ùo
 !ğ
UIP_PROTO_ICMP6
) {

1019 
	`UIP_STAT
(++
u_¡©
.

.
drİ
);

1020 
	`UIP_STAT
(++
u_¡©
.

.
´ÙÛ¼
);

1021 
	`UIP_LOG
("ip:‚eithercp‚or icmp6.");

1022 
drİ
;

1025 
	`UIP_STAT
(++
u_¡©
.
icmp
.
»cv
);

1029 if(
ICMPBUF
->
ty³
 =ğ
ICMP6_NEIGHBOR_SOLICITATION
) {

1030 if(
	`u_addr_cmp
(
ICMPBUF
->
icmp6d©a
, 
u_ho¡addr
)) {

1032 if(
ICMPBUF
->
İtiÚs
[0] =ğ
ICMP6_OPTION_SOURCE_LINK_ADDRESS
) {

1034 
	`u_ÃighbÜ_add
(
ICMPBUF
->
¤caddr
, &(ICMPBUF->
İtiÚs
[2]));

1039 
ICMPBUF
->
ty³
 = 
ICMP6_NEIGHBOR_ADVERTISEMENT
;

1040 
ICMPBUF
->
æags
 = 
ICMP6_FLAG_S
;

1042 
ICMPBUF
->
»£rved1
 = ICMPBUF->
»£rved2
 = ICMPBUF->
»£rved3
 = 0;

1044 
	`u_addr_cİy
(
ICMPBUF
->
de¡addr
, ICMPBUF->
¤caddr
);

1045 
	`u_addr_cİy
(
ICMPBUF
->
¤caddr
, 
u_ho¡addr
);

1046 
ICMPBUF
->
İtiÚs
[0] = 
ICMP6_OPTION_TARGET_LINK_ADDRESS
;

1047 
ICMPBUF
->
İtiÚs
[1] = 1;

1048 
	`memıy
(&(
ICMPBUF
->
İtiÚs
[2]), &
u_‘haddr
, (uip_ethaddr));

1049 
ICMPBUF
->
icmpchksum
 = 0;

1050 
ICMPBUF
->
icmpchksum
 = ~
	`u_icmp6chksum
();

1051 
£nd
;

1054 
drİ
;

1055 } if(
ICMPBUF
->
ty³
 =ğ
ICMP6_ECHO
) {

1060 
ICMPBUF
->
ty³
 = 
ICMP6_ECHO_REPLY
;

1062 
	`u_addr_cİy
(
BUF
->
de¡addr
, BUF->
¤caddr
);

1063 
	`u_addr_cİy
(
BUF
->
¤caddr
, 
u_ho¡addr
);

1064 
ICMPBUF
->
icmpchksum
 = 0;

1065 
ICMPBUF
->
icmpchksum
 = ~
	`u_icmp6chksum
();

1067 
	`UIP_STAT
(++
u_¡©
.
icmp
.
£Á
);

1068 
£nd
;

1070 
	`DEBUG_PRINTF
("UnknowÀicmp6 mes§gty³ %d\n", 
ICMPBUF
->
ty³
);

1071 
	`UIP_STAT
(++
u_¡©
.
icmp
.
drİ
);

1072 
	`UIP_STAT
(++
u_¡©
.
icmp
.
ty³”r
);

1073 
	`UIP_LOG
("icmp: unknown ICMP message.");

1074 
drİ
;

1081 #ià
UIP_UDP


1083 
udp_šput
:

1088 #ià
UIP_UDP_CHECKSUMS


1089 
u_Ën
 = u_ËÀ- 
UIP_IPUDPH_LEN
;

1090 
u_­pd©a
 = &
u_buf
[
UIP_LLH_LEN
 + 
UIP_IPUDPH_LEN
];

1091 if(
UDPBUF
->
udpchksum
 !ğ0 && 
	`u_udpchksum
() != 0xffff) {

1092 
	`UIP_STAT
(++
u_¡©
.
udp
.
drİ
);

1093 
	`UIP_STAT
(++
u_¡©
.
udp
.
chk”r
);

1094 
	`UIP_LOG
("udp: bad checksum.");

1095 
drİ
;

1098 
u_Ën
 = u_ËÀ- 
UIP_IPUDPH_LEN
;

1102 
u_udp_cÚn
 = &
u_udp_cÚns
[0];

1103 
u_udp_cÚn
 < &
u_udp_cÚns
[
UIP_UDP_CONNS
];

1104 ++
u_udp_cÚn
) {

1112 if(
u_udp_cÚn
->
ÍÜt
 != 0 &&

1113 
UDPBUF
->
de¡pÜt
 =ğ
u_udp_cÚn
->
ÍÜt
 &&

1114 (
u_udp_cÚn
->
½Üt
 == 0 ||

1115 
UDPBUF
->
¤ıÜt
 =ğ
u_udp_cÚn
->
½Üt
) &&

1116 (
	`u_addr_cmp
(
u_udp_cÚn
->
raddr
, 
®l_z”Ûs_addr
) ||

1117 
	`u_addr_cmp
(
u_udp_cÚn
->
raddr
, 
®l_Úes_addr
) ||

1118 
	`u_addr_cmp
(
BUF
->
¤caddr
, 
u_udp_cÚn
->
raddr
))) {

1119 
udp_found
;

1122 
	`UIP_LOG
("udp:‚o matching connection found");

1123 
drİ
;

1125 
udp_found
:

1126 
u_cÚn
 = 
NULL
;

1127 
u_æags
 = 
UIP_NEWDATA
;

1128 
u_§µd©a
 = 
u_­pd©a
 = &
u_buf
[
UIP_LLH_LEN
 + 
UIP_IPUDPH_LEN
];

1129 
u_¦’
 = 0;

1130 
	`UIP_UDP_APPCALL
();

1131 
udp_£nd
:

1132 if(
u_¦’
 == 0) {

1133 
drİ
;

1135 
u_Ën
 = 
u_¦’
 + 
UIP_IPUDPH_LEN
;

1137 #ià
UIP_CONF_IPV6


1140 
BUF
->
Ën
[0] = ((
u_Ën
 - 
UIP_IPH_LEN
) >> 8);

1141 
BUF
->
Ën
[1] = ((
u_Ën
 - 
UIP_IPH_LEN
) & 0xff);

1143 
BUF
->
Ën
[0] = (
u_Ën
 >> 8);

1144 
BUF
->
Ën
[1] = (
u_Ën
 & 0xff);

1147 
BUF
->
‰l
 = 
u_udp_cÚn
->ttl;

1148 
BUF
->
´Ùo
 = 
UIP_PROTO_UDP
;

1150 
UDPBUF
->
ud¶’
 = 
	`HTONS
(
u_¦’
 + 
UIP_UDPH_LEN
);

1151 
UDPBUF
->
udpchksum
 = 0;

1153 
BUF
->
¤ıÜt
 = 
u_udp_cÚn
->
ÍÜt
;

1154 
BUF
->
de¡pÜt
 = 
u_udp_cÚn
->
½Üt
;

1156 
	`u_addr_cİy
(
BUF
->
¤caddr
, 
u_ho¡addr
);

1157 
	`u_addr_cİy
(
BUF
->
de¡addr
, 
u_udp_cÚn
->
raddr
);

1159 
u_­pd©a
 = &
u_buf
[
UIP_LLH_LEN
 + 
UIP_IPTCPH_LEN
];

1161 #ià
UIP_UDP_CHECKSUMS


1163 
UDPBUF
->
udpchksum
 = ~(
	`u_udpchksum
());

1164 if(
UDPBUF
->
udpchksum
 == 0) {

1165 
UDPBUF
->
udpchksum
 = 0xffff;

1169 
_£nd_nŞ’
;

1173 
tı_šput
:

1174 
	`UIP_STAT
(++
u_¡©
.
tı
.
»cv
);

1178 if(
	`u_tıchksum
() != 0xffff) {

1180 
	`UIP_STAT
(++
u_¡©
.
tı
.
drİ
);

1181 
	`UIP_STAT
(++
u_¡©
.
tı
.
chk”r
);

1182 
	`UIP_LOG
("tcp: bad checksum.");

1183 
drİ
;

1189 
u_cÚÄ
 = &
u_cÚns
[0]; u_cÚÄ <ğ&u_cÚns[
UIP_CONNS
 - 1];

1190 ++
u_cÚÄ
) {

1191 if(
u_cÚÄ
->
tı¡©eæags
 !ğ
UIP_CLOSED
 &&

1192 
BUF
->
de¡pÜt
 =ğ
u_cÚÄ
->
ÍÜt
 &&

1193 
BUF
->
¤ıÜt
 =ğ
u_cÚÄ
->
½Üt
 &&

1194 
	`u_addr_cmp
(
BUF
->
¤caddr
, 
u_cÚÄ
->
raddr
)) {

1195 
found
;

1203 if((
BUF
->
æags
 & 
TCP_CTL
è!ğ
TCP_SYN
) {

1204 
»£t
;

1207 
tmp16
 = 
BUF
->
de¡pÜt
;

1209 
c
 = 0; c < 
UIP_LISTENPORTS
; ++c) {

1210 if(
tmp16
 =ğ
u_li¡’pÜts
[
c
])

1211 
found_li¡’
;

1215 
	`UIP_STAT
(++
u_¡©
.
tı
.
syÄ¡
);

1216 
»£t
:

1219 if(
BUF
->
æags
 & 
TCP_RST
) {

1220 
drİ
;

1223 
	`UIP_STAT
(++
u_¡©
.
tı
.
r¡
);

1225 
BUF
->
æags
 = 
TCP_RST
 | 
TCP_ACK
;

1226 
u_Ën
 = 
UIP_IPTCPH_LEN
;

1227 
BUF
->
tıoff£t
 = 5 << 4;

1230 
c
 = 
BUF
->
£qno
[3];

1231 
BUF
->
£qno
[3] = BUF->
ackno
[3];

1232 
BUF
->
ackno
[3] = 
c
;

1234 
c
 = 
BUF
->
£qno
[2];

1235 
BUF
->
£qno
[2] = BUF->
ackno
[2];

1236 
BUF
->
ackno
[2] = 
c
;

1238 
c
 = 
BUF
->
£qno
[1];

1239 
BUF
->
£qno
[1] = BUF->
ackno
[1];

1240 
BUF
->
ackno
[1] = 
c
;

1242 
c
 = 
BUF
->
£qno
[0];

1243 
BUF
->
£qno
[0] = BUF->
ackno
[0];

1244 
BUF
->
ackno
[0] = 
c
;

1249 if(++
BUF
->
ackno
[3] == 0) {

1250 if(++
BUF
->
ackno
[2] == 0) {

1251 if(++
BUF
->
ackno
[1] == 0) {

1252 ++
BUF
->
ackno
[0];

1258 
tmp16
 = 
BUF
->
¤ıÜt
;

1259 
BUF
->
¤ıÜt
 = BUF->
de¡pÜt
;

1260 
BUF
->
de¡pÜt
 = 
tmp16
;

1263 
	`u_addr_cİy
(
BUF
->
de¡addr
, BUF->
¤caddr
);

1264 
	`u_addr_cİy
(
BUF
->
¤caddr
, 
u_ho¡addr
);

1267 
tı_£nd_nocÚn
;

1272 
found_li¡’
:

1279 
u_cÚÄ
 = 0;

1280 
c
 = 0; c < 
UIP_CONNS
; ++c) {

1281 if(
u_cÚns
[
c
].
tı¡©eæags
 =ğ
UIP_CLOSED
) {

1282 
u_cÚÄ
 = &
u_cÚns
[
c
];

1285 if(
u_cÚns
[
c
].
tı¡©eæags
 =ğ
UIP_TIME_WAIT
) {

1286 if(
u_cÚÄ
 == 0 ||

1287 
u_cÚns
[
c
].
tim”
 > 
u_cÚÄ
->timer) {

1288 
u_cÚÄ
 = &
u_cÚns
[
c
];

1293 if(
u_cÚÄ
 == 0) {

1297 
	`UIP_STAT
(++
u_¡©
.
tı
.
syndrİ
);

1298 
	`UIP_LOG
("tcp: found‚o unused connections.");

1299 
drİ
;

1301 
u_cÚn
 = 
u_cÚÄ
;

1304 
u_cÚÄ
->
¹o
 = u_cÚÄ->
tim”
 = 
UIP_RTO
;

1305 
u_cÚÄ
->
§
 = 0;

1306 
u_cÚÄ
->
sv
 = 4;

1307 
u_cÚÄ
->
Ätx
 = 0;

1308 
u_cÚÄ
->
ÍÜt
 = 
BUF
->
de¡pÜt
;

1309 
u_cÚÄ
->
½Üt
 = 
BUF
->
¤ıÜt
;

1310 
	`u_addr_cİy
(
u_cÚÄ
->
raddr
, 
BUF
->
¤caddr
);

1311 
u_cÚÄ
->
tı¡©eæags
 = 
UIP_SYN_RCVD
;

1313 
u_cÚÄ
->
¢d_nxt
[0] = 
iss
[0];

1314 
u_cÚÄ
->
¢d_nxt
[1] = 
iss
[1];

1315 
u_cÚÄ
->
¢d_nxt
[2] = 
iss
[2];

1316 
u_cÚÄ
->
¢d_nxt
[3] = 
iss
[3];

1317 
u_cÚÄ
->
Ën
 = 1;

1320 
u_cÚÄ
->
rcv_nxt
[3] = 
BUF
->
£qno
[3];

1321 
u_cÚÄ
->
rcv_nxt
[2] = 
BUF
->
£qno
[2];

1322 
u_cÚÄ
->
rcv_nxt
[1] = 
BUF
->
£qno
[1];

1323 
u_cÚÄ
->
rcv_nxt
[0] = 
BUF
->
£qno
[0];

1324 
	`u_add_rcv_nxt
(1);

1327 if((
BUF
->
tıoff£t
 & 0xf0) > 0x50) {

1328 
c
 = 0; c < ((
BUF
->
tıoff£t
 >> 4) - 5) << 2 ;) {

1329 
İt
 = 
u_buf
[
UIP_TCPIP_HLEN
 + 
UIP_LLH_LEN
 + 
c
];

1330 if(
İt
 =ğ
TCP_OPT_END
) {

1333 } if(
İt
 =ğ
TCP_OPT_NOOP
) {

1334 ++
c
;

1336 } if(
İt
 =ğ
TCP_OPT_MSS
 &&

1337 
u_buf
[
UIP_TCPIP_HLEN
 + 
UIP_LLH_LEN
 + 1 + 
c
] =ğ
TCP_OPT_MSS_LEN
) {

1339 
tmp16
 = ((
u16_t
)
u_buf
[
UIP_TCPIP_HLEN
 + 
UIP_LLH_LEN
 + 2 + 
c
] << 8) |

1340 (
u16_t
)
u_buf
[
UIP_IPTCPH_LEN
 + 
UIP_LLH_LEN
 + 3 + 
c
];

1341 
u_cÚÄ
->
š™Ÿlmss
 = u_cÚÄ->
mss
 =

1342 
tmp16
 > 
UIP_TCP_MSS
? UIP_TCP_MSS:mp16;

1349 if(
u_buf
[
UIP_TCPIP_HLEN
 + 
UIP_LLH_LEN
 + 1 + 
c
] == 0) {

1354 
c
 +ğ
u_buf
[
UIP_TCPIP_HLEN
 + 
UIP_LLH_LEN
 + 1 + c];

1360 #ià
UIP_ACTIVE_OPEN


1361 
tı_£nd_syÇck
:

1362 
BUF
->
æags
 = 
TCP_ACK
;

1364 
tı_£nd_syn
:

1365 
BUF
->
æags
 |ğ
TCP_SYN
;

1367 
tı_£nd_syÇck
:

1368 
BUF
->
æags
 = 
TCP_SYN
 | 
TCP_ACK
;

1373 
BUF
->
İtd©a
[0] = 
TCP_OPT_MSS
;

1374 
BUF
->
İtd©a
[1] = 
TCP_OPT_MSS_LEN
;

1375 
BUF
->
İtd©a
[2] = (
UIP_TCP_MSS
) / 256;

1376 
BUF
->
İtd©a
[3] = (
UIP_TCP_MSS
) & 255;

1377 
u_Ën
 = 
UIP_IPTCPH_LEN
 + 
TCP_OPT_MSS_LEN
;

1378 
BUF
->
tıoff£t
 = ((
UIP_TCPH_LEN
 + 
TCP_OPT_MSS_LEN
) / 4) << 4;

1379 
tı_£nd
;

1382 
found
:

1383 
u_cÚn
 = 
u_cÚÄ
;

1384 
u_æags
 = 0;

1389 if(
BUF
->
æags
 & 
TCP_RST
) {

1390 
u_cÚÄ
->
tı¡©eæags
 = 
UIP_CLOSED
;

1391 
	`UIP_LOG
("tcp: got„eset,‡borting connection.");

1392 
u_æags
 = 
UIP_ABORT
;

1393 
	`UIP_APPCALL
();

1394 
drİ
;

1398 
c
 = (
BUF
->
tıoff£t
 >> 4) << 2;

1402 
u_Ën
 = u_ËÀ- 
c
 - 
UIP_IPH_LEN
;

1407 if(!(((
u_cÚÄ
->
tı¡©eæags
 & 
UIP_TS_MASK
è=ğ
UIP_SYN_SENT
) &&

1408 ((
BUF
->
æags
 & 
TCP_CTL
è=ğ(
TCP_SYN
 | 
TCP_ACK
)))) {

1409 if((
u_Ën
 > 0 || ((
BUF
->
æags
 & (
TCP_SYN
 | 
TCP_FIN
)) != 0)) &&

1410 (
BUF
->
£qno
[0] !ğ
u_cÚÄ
->
rcv_nxt
[0] ||

1411 
BUF
->
£qno
[1] !ğ
u_cÚÄ
->
rcv_nxt
[1] ||

1412 
BUF
->
£qno
[2] !ğ
u_cÚÄ
->
rcv_nxt
[2] ||

1413 
BUF
->
£qno
[3] !ğ
u_cÚÄ
->
rcv_nxt
[3])) {

1414 
tı_£nd_ack
;

1422 if((
BUF
->
æags
 & 
TCP_ACK
è&& 
	`u_out¡ªdšg
(
u_cÚÄ
)) {

1423 
	`u_add32
(
u_cÚÄ
->
¢d_nxt
, u_cÚÄ->
Ën
);

1425 if(
BUF
->
ackno
[0] =ğ
u_acc32
[0] &&

1426 
BUF
->
ackno
[1] =ğ
u_acc32
[1] &&

1427 
BUF
->
ackno
[2] =ğ
u_acc32
[2] &&

1428 
BUF
->
ackno
[3] =ğ
u_acc32
[3]) {

1430 
u_cÚÄ
->
¢d_nxt
[0] = 
u_acc32
[0];

1431 
u_cÚÄ
->
¢d_nxt
[1] = 
u_acc32
[1];

1432 
u_cÚÄ
->
¢d_nxt
[2] = 
u_acc32
[2];

1433 
u_cÚÄ
->
¢d_nxt
[3] = 
u_acc32
[3];

1437 if(
u_cÚÄ
->
Ätx
 == 0) {

1438 sigÃd 
m
;

1439 
m
 = 
u_cÚÄ
->
¹o
 - u_cÚÄ->
tim”
;

1441 
m
 = m - (
u_cÚÄ
->
§
 >> 3);

1442 
u_cÚÄ
->
§
 +ğ
m
;

1443 if(
m
 < 0) {

1444 
m
 = -m;

1446 
m
 = m - (
u_cÚÄ
->
sv
 >> 2);

1447 
u_cÚÄ
->
sv
 +ğ
m
;

1448 
u_cÚÄ
->
¹o
 = (u_cÚÄ->
§
 >> 3è+ u_cÚÄ->
sv
;

1452 
u_æags
 = 
UIP_ACKDATA
;

1454 
u_cÚÄ
->
tim”
 = u_cÚÄ->
¹o
;

1457 
u_cÚÄ
->
Ën
 = 0;

1463 
u_cÚÄ
->
tı¡©eæags
 & 
UIP_TS_MASK
) {

1468 
UIP_SYN_RCVD
:

1473 if(
u_æags
 & 
UIP_ACKDATA
) {

1474 
u_cÚÄ
->
tı¡©eæags
 = 
UIP_ESTABLISHED
;

1475 
u_æags
 = 
UIP_CONNECTED
;

1476 
u_cÚÄ
->
Ën
 = 0;

1477 if(
u_Ën
 > 0) {

1478 
u_æags
 |ğ
UIP_NEWDATA
;

1479 
	`u_add_rcv_nxt
(
u_Ën
);

1481 
u_¦’
 = 0;

1482 
	`UIP_APPCALL
();

1483 
­p£nd
;

1485 
drİ
;

1486 #ià
UIP_ACTIVE_OPEN


1487 
UIP_SYN_SENT
:

1492 if((
u_æags
 & 
UIP_ACKDATA
) &&

1493 (
BUF
->
æags
 & 
TCP_CTL
è=ğ(
TCP_SYN
 | 
TCP_ACK
)) {

1496 if((
BUF
->
tıoff£t
 & 0xf0) > 0x50) {

1497 
c
 = 0; c < ((
BUF
->
tıoff£t
 >> 4) - 5) << 2 ;) {

1498 
İt
 = 
u_buf
[
UIP_IPTCPH_LEN
 + 
UIP_LLH_LEN
 + 
c
];

1499 if(
İt
 =ğ
TCP_OPT_END
) {

1502 } if(
İt
 =ğ
TCP_OPT_NOOP
) {

1503 ++
c
;

1505 } if(
İt
 =ğ
TCP_OPT_MSS
 &&

1506 
u_buf
[
UIP_TCPIP_HLEN
 + 
UIP_LLH_LEN
 + 1 + 
c
] =ğ
TCP_OPT_MSS_LEN
) {

1508 
tmp16
 = (
u_buf
[
UIP_TCPIP_HLEN
 + 
UIP_LLH_LEN
 + 2 + 
c
] << 8) |

1509 
u_buf
[
UIP_TCPIP_HLEN
 + 
UIP_LLH_LEN
 + 3 + 
c
];

1510 
u_cÚÄ
->
š™Ÿlmss
 =

1511 
u_cÚÄ
->
mss
 = 
tmp16
 > 
UIP_TCP_MSS
? UIP_TCP_MSS:mp16;

1518 if(
u_buf
[
UIP_TCPIP_HLEN
 + 
UIP_LLH_LEN
 + 1 + 
c
] == 0) {

1523 
c
 +ğ
u_buf
[
UIP_TCPIP_HLEN
 + 
UIP_LLH_LEN
 + 1 + c];

1527 
u_cÚÄ
->
tı¡©eæags
 = 
UIP_ESTABLISHED
;

1528 
u_cÚÄ
->
rcv_nxt
[0] = 
BUF
->
£qno
[0];

1529 
u_cÚÄ
->
rcv_nxt
[1] = 
BUF
->
£qno
[1];

1530 
u_cÚÄ
->
rcv_nxt
[2] = 
BUF
->
£qno
[2];

1531 
u_cÚÄ
->
rcv_nxt
[3] = 
BUF
->
£qno
[3];

1532 
	`u_add_rcv_nxt
(1);

1533 
u_æags
 = 
UIP_CONNECTED
 | 
UIP_NEWDATA
;

1534 
u_cÚÄ
->
Ën
 = 0;

1535 
u_Ën
 = 0;

1536 
u_¦’
 = 0;

1537 
	`UIP_APPCALL
();

1538 
­p£nd
;

1541 
u_æags
 = 
UIP_ABORT
;

1542 
	`UIP_APPCALL
();

1544 
u_cÚn
->
tı¡©eæags
 = 
UIP_CLOSED
;

1545 
»£t
;

1548 
UIP_ESTABLISHED
:

1560 if(
BUF
->
æags
 & 
TCP_FIN
 && !(
u_cÚÄ
->
tı¡©eæags
 & 
UIP_STOPPED
)) {

1561 if(
	`u_out¡ªdšg
(
u_cÚÄ
)) {

1562 
drİ
;

1564 
	`u_add_rcv_nxt
(1 + 
u_Ën
);

1565 
u_æags
 |ğ
UIP_CLOSE
;

1566 if(
u_Ën
 > 0) {

1567 
u_æags
 |ğ
UIP_NEWDATA
;

1569 
	`UIP_APPCALL
();

1570 
u_cÚÄ
->
Ën
 = 1;

1571 
u_cÚÄ
->
tı¡©eæags
 = 
UIP_LAST_ACK
;

1572 
u_cÚÄ
->
Ätx
 = 0;

1573 
tı_£nd_fšack
:

1574 
BUF
->
æags
 = 
TCP_FIN
 | 
TCP_ACK
;

1575 
tı_£nd_nod©a
;

1580 if((
BUF
->
æags
 & 
TCP_URG
) != 0) {

1581 #ià
UIP_URGDATA
 > 0

1582 
u_urgËn
 = (
BUF
->
urgp
[0] << 8) | BUF->urgp[1];

1583 if(
u_urgËn
 > 
u_Ën
) {

1585 
u_urgËn
 = 
u_Ën
;

1587 
	`u_add_rcv_nxt
(
u_urgËn
);

1588 
u_Ën
 -ğ
u_urgËn
;

1589 
u_urgd©a
 = 
u_­pd©a
;

1590 
u_­pd©a
 +ğ
u_urgËn
;

1592 
u_urgËn
 = 0;

1594 
u_­pd©a
 = ((*)u_­pd©aè+ ((
BUF
->
urgp
[0] << 8) | BUF->urgp[1]);

1595 
u_Ën
 -ğ(
BUF
->
urgp
[0] << 8) | BUF->urgp[1];

1604 if(
u_Ën
 > 0 && !(
u_cÚÄ
->
tı¡©eæags
 & 
UIP_STOPPED
)) {

1605 
u_æags
 |ğ
UIP_NEWDATA
;

1606 
	`u_add_rcv_nxt
(
u_Ën
);

1621 
tmp16
 = ((
u16_t
)
BUF
->
wnd
[0] << 8) + (u16_t)BUF->wnd[1];

1622 if(
tmp16
 > 
u_cÚÄ
->
š™Ÿlmss
 ||

1623 
tmp16
 == 0) {

1624 
tmp16
 = 
u_cÚÄ
->
š™Ÿlmss
;

1626 
u_cÚÄ
->
mss
 = 
tmp16
;

1644 if(
u_æags
 & (
UIP_NEWDATA
 | 
UIP_ACKDATA
)) {

1645 
u_¦’
 = 0;

1646 
	`UIP_APPCALL
();

1648 
­p£nd
:

1650 if(
u_æags
 & 
UIP_ABORT
) {

1651 
u_¦’
 = 0;

1652 
u_cÚÄ
->
tı¡©eæags
 = 
UIP_CLOSED
;

1653 
BUF
->
æags
 = 
TCP_RST
 | 
TCP_ACK
;

1654 
tı_£nd_nod©a
;

1657 if(
u_æags
 & 
UIP_CLOSE
) {

1658 
u_¦’
 = 0;

1659 
u_cÚÄ
->
Ën
 = 1;

1660 
u_cÚÄ
->
tı¡©eæags
 = 
UIP_FIN_WAIT_1
;

1661 
u_cÚÄ
->
Ätx
 = 0;

1662 
BUF
->
æags
 = 
TCP_FIN
 | 
TCP_ACK
;

1663 
tı_£nd_nod©a
;

1667 if(
u_¦’
 > 0) {

1671 if((
u_æags
 & 
UIP_ACKDATA
) != 0) {

1672 
u_cÚÄ
->
Ën
 = 0;

1678 if(
u_cÚÄ
->
Ën
 == 0) {

1683 if(
u_¦’
 > 
u_cÚÄ
->
mss
) {

1684 
u_¦’
 = 
u_cÚÄ
->
mss
;

1689 
u_cÚÄ
->
Ën
 = 
u_¦’
;

1695 
u_¦’
 = 
u_cÚÄ
->
Ën
;

1698 
u_cÚÄ
->
Ätx
 = 0;

1699 
­´exm™
:

1700 
u_­pd©a
 = 
u_§µd©a
;

1704 if(
u_¦’
 > 0 && 
u_cÚÄ
->
Ën
 > 0) {

1706 
u_Ën
 = 
u_cÚÄ
->
Ën
 + 
UIP_TCPIP_HLEN
;

1708 
BUF
->
æags
 = 
TCP_ACK
 | 
TCP_PSH
;

1710 
tı_£nd_noİts
;

1714 if(
u_æags
 & 
UIP_NEWDATA
) {

1715 
u_Ën
 = 
UIP_TCPIP_HLEN
;

1716 
BUF
->
æags
 = 
TCP_ACK
;

1717 
tı_£nd_noİts
;

1720 
drİ
;

1721 
UIP_LAST_ACK
:

1724 if(
u_æags
 & 
UIP_ACKDATA
) {

1725 
u_cÚÄ
->
tı¡©eæags
 = 
UIP_CLOSED
;

1726 
u_æags
 = 
UIP_CLOSE
;

1727 
	`UIP_APPCALL
();

1731 
UIP_FIN_WAIT_1
:

1735 if(
u_Ën
 > 0) {

1736 
	`u_add_rcv_nxt
(
u_Ën
);

1738 if(
BUF
->
æags
 & 
TCP_FIN
) {

1739 if(
u_æags
 & 
UIP_ACKDATA
) {

1740 
u_cÚÄ
->
tı¡©eæags
 = 
UIP_TIME_WAIT
;

1741 
u_cÚÄ
->
tim”
 = 0;

1742 
u_cÚÄ
->
Ën
 = 0;

1744 
u_cÚÄ
->
tı¡©eæags
 = 
UIP_CLOSING
;

1746 
	`u_add_rcv_nxt
(1);

1747 
u_æags
 = 
UIP_CLOSE
;

1748 
	`UIP_APPCALL
();

1749 
tı_£nd_ack
;

1750 } if(
u_æags
 & 
UIP_ACKDATA
) {

1751 
u_cÚÄ
->
tı¡©eæags
 = 
UIP_FIN_WAIT_2
;

1752 
u_cÚÄ
->
Ën
 = 0;

1753 
drİ
;

1755 if(
u_Ën
 > 0) {

1756 
tı_£nd_ack
;

1758 
drİ
;

1760 
UIP_FIN_WAIT_2
:

1761 if(
u_Ën
 > 0) {

1762 
	`u_add_rcv_nxt
(
u_Ën
);

1764 if(
BUF
->
æags
 & 
TCP_FIN
) {

1765 
u_cÚÄ
->
tı¡©eæags
 = 
UIP_TIME_WAIT
;

1766 
u_cÚÄ
->
tim”
 = 0;

1767 
	`u_add_rcv_nxt
(1);

1768 
u_æags
 = 
UIP_CLOSE
;

1769 
	`UIP_APPCALL
();

1770 
tı_£nd_ack
;

1772 if(
u_Ën
 > 0) {

1773 
tı_£nd_ack
;

1775 
drİ
;

1777 
UIP_TIME_WAIT
:

1778 
tı_£nd_ack
;

1780 
UIP_CLOSING
:

1781 if(
u_æags
 & 
UIP_ACKDATA
) {

1782 
u_cÚÄ
->
tı¡©eæags
 = 
UIP_TIME_WAIT
;

1783 
u_cÚÄ
->
tim”
 = 0;

1786 
drİ
;

1791 
tı_£nd_ack
:

1792 
BUF
->
æags
 = 
TCP_ACK
;

1793 
tı_£nd_nod©a
:

1794 
u_Ën
 = 
UIP_IPTCPH_LEN
;

1795 
tı_£nd_noİts
:

1796 
BUF
->
tıoff£t
 = (
UIP_TCPH_LEN
 / 4) << 4;

1797 
tı_£nd
:

1802 
BUF
->
ackno
[0] = 
u_cÚÄ
->
rcv_nxt
[0];

1803 
BUF
->
ackno
[1] = 
u_cÚÄ
->
rcv_nxt
[1];

1804 
BUF
->
ackno
[2] = 
u_cÚÄ
->
rcv_nxt
[2];

1805 
BUF
->
ackno
[3] = 
u_cÚÄ
->
rcv_nxt
[3];

1807 
BUF
->
£qno
[0] = 
u_cÚÄ
->
¢d_nxt
[0];

1808 
BUF
->
£qno
[1] = 
u_cÚÄ
->
¢d_nxt
[1];

1809 
BUF
->
£qno
[2] = 
u_cÚÄ
->
¢d_nxt
[2];

1810 
BUF
->
£qno
[3] = 
u_cÚÄ
->
¢d_nxt
[3];

1812 
BUF
->
´Ùo
 = 
UIP_PROTO_TCP
;

1814 
BUF
->
¤ıÜt
 = 
u_cÚÄ
->
ÍÜt
;

1815 
BUF
->
de¡pÜt
 = 
u_cÚÄ
->
½Üt
;

1817 
	`u_addr_cİy
(
BUF
->
¤caddr
, 
u_ho¡addr
);

1818 
	`u_addr_cİy
(
BUF
->
de¡addr
, 
u_cÚÄ
->
raddr
);

1820 if(
u_cÚÄ
->
tı¡©eæags
 & 
UIP_STOPPED
) {

1823 
BUF
->
wnd
[0] = BUF->wnd[1] = 0;

1825 
BUF
->
wnd
[0] = ((
UIP_RECEIVE_WINDOW
) >> 8);

1826 
BUF
->
wnd
[1] = ((
UIP_RECEIVE_WINDOW
) & 0xff);

1829 
tı_£nd_nocÚn
:

1830 
BUF
->
‰l
 = 
UIP_TTL
;

1831 #ià
UIP_CONF_IPV6


1834 
BUF
->
Ën
[0] = ((
u_Ën
 - 
UIP_IPH_LEN
) >> 8);

1835 
BUF
->
Ën
[1] = ((
u_Ën
 - 
UIP_IPH_LEN
) & 0xff);

1837 
BUF
->
Ën
[0] = (
u_Ën
 >> 8);

1838 
BUF
->
Ën
[1] = (
u_Ën
 & 0xff);

1841 
BUF
->
urgp
[0] = BUF->urgp[1] = 0;

1844 
BUF
->
tıchksum
 = 0;

1845 
BUF
->
tıchksum
 = ~(
	`u_tıchksum
());

1847 
_£nd_nŞ’
:

1849 #ià
UIP_CONF_IPV6


1850 
BUF
->
vtc
 = 0x60;

1851 
BUF
->
tcæow
 = 0x00;

1852 
BUF
->
æow
 = 0x00;

1854 
BUF
->
vhl
 = 0x45;

1855 
BUF
->
tos
 = 0;

1856 
BUF
->
off£t
[0] = BUF->ipoffset[1] = 0;

1857 ++
id
;

1858 
BUF
->
id
[0] = ipid >> 8;

1859 
BUF
->
id
[1] = ipid & 0xff;

1861 
BUF
->
chksum
 = 0;

1862 
BUF
->
chksum
 = ~(
	`u_chksum
());

1863 
	`DEBUG_PRINTF
("u ip_£nd_nŞ’: chkecum 0x%04x\n", 
	`u_chksum
());

1866 
	`UIP_STAT
(++
u_¡©
.
tı
.
£Á
);

1867 
£nd
:

1868 
	`DEBUG_PRINTF
("S’dšg…ack‘ w™h†’gth %d (%d)\n", 
u_Ën
,

1869 (
BUF
->
Ën
[0] << 8) | BUF->len[1]);

1871 
	`UIP_STAT
(++
u_¡©
.

.
£Á
);

1873 
u_æags
 = 0;

1875 
drİ
:

1876 
u_Ën
 = 0;

1877 
u_æags
 = 0;

1879 
	}
}

1881 
u16_t


1882 
	$htÚs
(
u16_t
 
v®
)

1884  
	`HTONS
(
v®
);

1885 
	}
}

1888 
	$u_£nd
(cÚ¡ *
d©a
, 
Ën
)

1890 if(
Ën
 > 0) {

1891 
u_¦’
 = 
Ën
;

1892 if(
d©a
 !ğ
u_§µd©a
) {

1893 
	`memıy
(
u_§µd©a
, (
d©a
), 
u_¦’
);

1896 
	}
}

	@uip/uip.h

53 #iâdeà
__UIP_H__


54 
	#__UIP_H__


	)

56 
	~"uİt.h
"

62 
u16_t
 
	tu_4addr_t
[2];

63 
u16_t
 
	tu_6addr_t
[8];

64 #ià
UIP_CONF_IPV6


65 
u_6addr_t
 
	tu_addr_t
;

67 
u_4addr_t
 
	tu_addr_t
;

106 
	#u_£tho¡addr
(
addr
è
	`u_addr_cİy
(
u_ho¡addr
, (addr))

	)

126 
	#u_g‘ho¡addr
(
addr
è
	`u_addr_cİy
(×ddr), 
u_ho¡addr
)

	)

138 
	#u_£td¿ddr
(
addr
è
	`u_addr_cİy
(
u_d¿ddr
, (addr))

	)

150 
	#u_£Š‘mask
(
addr
è
	`u_addr_cİy
(
u_Ãtmask
, (addr))

	)

161 
	#u_g‘d¿ddr
(
addr
è
	`u_addr_cİy
(×ddr), 
u_d¿ddr
)

	)

171 
	#u_g‘Ãtmask
(
addr
è
	`u_addr_cİy
(×ddr), 
u_Ãtmask
)

	)

188 
u_š™
();

195 
u_£tid
(
u16_t
 
id
);

257 
	#u_šput
(è
	`u_´oûss
(
UIP_DATA
)

	)

301 
	#u_³riodic
(
cÚn
èdØ{ 
u_cÚn
 = &
u_cÚns
[conn]; \

302 
	`u_´oûss
(
UIP_TIMER
); } 0)

	)

308 
	#u_cÚn_aùive
(
cÚn
è(
u_cÚns
[cÚn].
tı¡©eæags
 !ğ
UIP_CLOSED
)

	)

323 
	#u_³riodic_cÚn
(
cÚn
èdØ{ 
u_cÚn
 = conn; \

324 
	`u_´oûss
(
UIP_TIMER
); } 0)

	)

337 
	#u_pŞl_cÚn
(
cÚn
èdØ{ 
u_cÚn
 = conn; \

338 
	`u_´oûss
(
UIP_POLL_REQUEST
); } 0)

	)

341 #ià
UIP_UDP


373 
	#u_udp_³riodic
(
cÚn
èdØ{ 
u_udp_cÚn
 = &
u_udp_cÚns
[conn]; \

374 
	`u_´oûss
(
UIP_UDP_TIMER
); } 0)

	)

390 
	#u_udp_³riodic_cÚn
(
cÚn
èdØ{ 
u_udp_cÚn
 = conn; \

391 
	`u_´oûss
(
UIP_UDP_TIMER
); } 0)

	)

422 
u8_t
 
u_buf
[
UIP_BUFSIZE
+2];

450 
u_li¡’
(
u16_t
 
pÜt
);

464 
u_uÆi¡’
(
u16_t
 
pÜt
);

498 
u_cÚn
 *
u_cÚÃù
(
u_addr_t
 *
raddr
, 
u16_t
 
pÜt
);

511 
	#u_out¡ªdšg
(
cÚn
è((cÚn)->
Ën
)

	)

538 
u_£nd
(cÚ¡ *
d©a
, 
Ën
);

550 
	#u_d©®’
(è
u_Ën


	)

561 
	#u_urgd©®’
(è
u_urgËn


	)

570 
	#u_şo£
(è(
u_æags
 = 
UIP_CLOSE
)

	)

581 
	#u_abÜt
(è(
u_æags
 = 
UIP_ABORT
)

	)

591 
	#u_¡İ
(è(
u_cÚn
->
tı¡©eæags
 |ğ
UIP_STOPPED
)

	)

599 
	#u_¡İ³d
(
cÚn
è((cÚn)->
tı¡©eæags
 & 
UIP_STOPPED
)

	)

610 
	#u_»¡¬t
(èdØ{ 
u_æags
 |ğ
UIP_NEWDATA
; \

611 
u_cÚn
->
tı¡©eæags
 &ğ~
UIP_STOPPED
; \

612 } 0)

	)

626 
	#u_udpcÚÃùiÚ
(è(
u_cÚn
 =ğ
NULL
)

	)

637 
	#u_Ãwd©a
(è(
u_æags
 & 
UIP_NEWDATA
)

	)

648 
	#u_acked
(è(
u_æags
 & 
UIP_ACKDATA
)

	)

660 
	#u_cÚÃùed
(è(
u_æags
 & 
UIP_CONNECTED
)

	)

670 
	#u_şo£d
(è(
u_æags
 & 
UIP_CLOSE
)

	)

680 
	#u_abÜ‹d
(è(
u_æags
 & 
UIP_ABORT
)

	)

690 
	#u_timedout
(è(
u_æags
 & 
UIP_TIMEDOUT
)

	)

702 
	#u_»xm™
(è(
u_æags
 & 
UIP_REXMIT
)

	)

716 
	#u_pŞl
(è(
u_æags
 & 
UIP_POLL
)

	)

724 
	#u_š™Ÿlmss
(è(
u_cÚn
->
š™Ÿlmss
)

	)

737 
	#u_mss
(è(
u_cÚn
->
mss
)

	)

766 
u_udp_cÚn
 *
u_udp_Ãw
(
u_addr_t
 *
raddr
, 
u16_t
 
½Üt
);

775 
	#u_udp_»move
(
cÚn
è(cÚn)->
ÍÜt
 = 0

	)

787 
	#u_udp_bšd
(
cÚn
, 
pÜt
è(cÚn)->
ÍÜt
 = 
	)
port

800 
	#u_udp_£nd
(
Ën
è
	`u_£nd
((*)
u_­pd©a
,†’)

	)

840 
	#u_addr
(
addr
, 
addr0
,
addr1
,
addr2
,
addr3
) do { \

841 ((
u16_t
 *)(
addr
))[0] = 
	`HTONS
(((
addr0
è<< 8è| (
addr1
)); \

842 ((
u16_t
 *)(
addr
))[1] = 
	`HTONS
(((
addr2
è<< 8è| (
addr3
)); \

843 } 0)

	)

852 
	#u_6addr
(
addr
, 
addr0
,
addr1
,
addr2
,
addr3
,
addr4
,
addr5
,
addr6
,
addr7
) do { \

853 ((
u16_t
 *)(
addr
))[0] = 
	`HTONS
((
addr0
)); \

854 ((
u16_t
 *)(
addr
))[1] = 
	`HTONS
((
addr1
)); \

855 ((
u16_t
 *)(
addr
))[2] = 
	`HTONS
((
addr2
)); \

856 ((
u16_t
 *)(
addr
))[3] = 
	`HTONS
((
addr3
)); \

857 ((
u16_t
 *)(
addr
))[4] = 
	`HTONS
((
addr4
)); \

858 ((
u16_t
 *)(
addr
))[5] = 
	`HTONS
((
addr5
)); \

859 ((
u16_t
 *)(
addr
))[6] = 
	`HTONS
((
addr6
)); \

860 ((
u16_t
 *)(
addr
))[7] = 
	`HTONS
((
addr7
)); \

861 } 0)

	)

881 #ià!
UIP_CONF_IPV6


882 
	#u_addr_cİy
(
de¡
, 
¤c
) do { \

883 ((
u16_t
 *)
de¡
)[0] = ((u16_ˆ*)
¤c
)[0]; \

884 ((
u16_t
 *)
de¡
)[1] = ((u16_ˆ*)
¤c
)[1]; \

885 } 0)

	)

887 
	#u_addr_cİy
(
de¡
, 
¤c
è
	`memıy
(de¡, src, (
u_6addr_t
))

	)

910 #ià!
UIP_CONF_IPV6


911 
	#u_addr_cmp
(
addr1
, 
addr2
è(((
u16_t
 *)addr1)[0] == ((u16_t *)addr2)[0] && \

912 ((
u16_t
 *)
addr1
)[1] =ğ((u16_ˆ*)
addr2
)[1])

	)

914 
	#u_addr_cmp
(
addr1
, 
addr2
è(
	`memcmp
×ddr1,‡ddr2, (
u_6addr_t
)è=ğ0)

	)

941 
	#u_addr_maskcmp
(
addr1
, 
addr2
, 
mask
) \

942 (((((
u16_t
 *)
addr1
)[0] & ((u16_ˆ*)
mask
)[0]) == \

943 (((
u16_t
 *)
addr2
)[0] & ((u16_ˆ*)
mask
)[0])) && \

944 ((((
u16_t
 *)
addr1
)[1] & ((u16_ˆ*)
mask
)[1]) == \

945 (((
u16_t
 *)
addr2
)[1] & ((u16_ˆ*)
mask
)[1])))

	)

972 
	#u_addr_mask
(
de¡
, 
¤c
, 
mask
) do { \

973 ((
u16_t
 *)
de¡
)[0] = ((u16_ˆ*)
¤c
)[0] & ((u16_ˆ*)
mask
)[0]; \

974 ((
u16_t
 *)
de¡
)[1] = ((u16_ˆ*)
¤c
)[1] & ((u16_ˆ*)
mask
)[1]; \

975 } 0)

	)

995 
	#u_addr1
(
addr
è(
	`htÚs
(((
u16_t
 *)×ddr))[0]è>> 8)

	)

1015 
	#u_addr2
(
addr
è(
	`htÚs
(((
u16_t
 *)×ddr))[0]è& 0xff)

	)

1035 
	#u_addr3
(
addr
è(
	`htÚs
(((
u16_t
 *)×ddr))[1]è>> 8)

	)

1055 
	#u_addr4
(
addr
è(
	`htÚs
(((
u16_t
 *)×ddr))[1]è& 0xff)

	)

1066 #iâdeà
HTONS


1067 #ià
UIP_BYTE_ORDER
 =ğ
UIP_BIG_ENDIAN


1068 
	#HTONS
(
n
èÒ)

	)

1070 
	#HTONS
(
n
è(
u16_t
)((((u16_tèÒ)è<< 8è| (((u16_tèÒ)è>> 8))

	)

1083 #iâdeà
htÚs


1084 
u16_t
 
htÚs
(u16_ˆ
v®
);

1086 #iâdeà
Áohs


1087 
	#Áohs
 
htÚs


	)

1099 *
u_­pd©a
;

1101 #ià
UIP_URGDATA
 > 0

1107 *
u_urgd©a
;

1134 
u16_t
 
u_Ën
;

1138 #ià
UIP_URGDATA
 > 0

1139 
u16_t
 
u_urgËn
, 
u_surgËn
;

1153 
	su_cÚn
 {

1154 
u_addr_t
 
	mraddr
;

1156 
u16_t
 
	mÍÜt
;

1157 
u16_t
 
	m½Üt
;

1160 
u8_t
 
	mrcv_nxt
[4];

1162 
u8_t
 
	m¢d_nxt
[4];

1164 
u16_t
 
	mËn
;

1165 
u16_t
 
	mmss
;

1167 
u16_t
 
	mš™Ÿlmss
;

1169 
u8_t
 
	m§
;

1171 
u8_t
 
	msv
;

1173 
u8_t
 
	m¹o
;

1174 
u8_t
 
	mtı¡©eæags
;

1175 
u8_t
 
	mtim”
;

1176 
u8_t
 
	mÄtx
;

1180 
u_tı_­p¡©e_t
 
	m­p¡©e
;

1190 
u_cÚn
 *uip_conn;

1192 
u_cÚn
 
u_cÚns
[
UIP_CONNS
];

1201 
u8_t
 
u_acc32
[4];

1206 #ià
UIP_UDP


1210 
	su_udp_cÚn
 {

1211 
u_addr_t
 
	mraddr
;

1212 
u16_t
 
	mÍÜt
;

1213 
u16_t
 
	m½Üt
;

1214 
u8_t
 
	m‰l
;

1217 
u_udp_­p¡©e_t
 
	m­p¡©e
;

1223 
u_udp_cÚn
 *uip_udp_conn;

1224 
u_udp_cÚn
 
u_udp_cÚns
[
UIP_UDP_CONNS
];

1232 
	su_¡©s
 {

1234 
u_¡©s_t
 
	mdrİ
;

1236 
u_¡©s_t
 
	m»cv
;

1238 
u_¡©s_t
 
	m£Á
;

1240 
u_¡©s_t
 
	mvhË¼
;

1242 
u_¡©s_t
 
	mhbËÃ¼
;

1244 
u_¡©s_t
 
	mlbËÃ¼
;

1246 
u_¡©s_t
 
	mäag”r
;

1248 
u_¡©s_t
 
	mchk”r
;

1250 
u_¡©s_t
 
	m´ÙÛ¼
;

1252 } 
	m
;

1254 
u_¡©s_t
 
	mdrİ
;

1255 
u_¡©s_t
 
	m»cv
;

1256 
u_¡©s_t
 
	m£Á
;

1257 
u_¡©s_t
 
	mty³”r
;

1259 } 
	micmp
;

1261 
u_¡©s_t
 
	mdrİ
;

1262 
u_¡©s_t
 
	m»cv
;

1263 
u_¡©s_t
 
	m£Á
;

1264 
u_¡©s_t
 
	mchk”r
;

1266 
u_¡©s_t
 
	mack”r
;

1268 
u_¡©s_t
 
	mr¡
;

1269 
u_¡©s_t
 
	m»xm™
;

1270 
u_¡©s_t
 
	msyndrİ
;

1272 
u_¡©s_t
 
	msyÄ¡
;

1274 } 
	mtı
;

1275 #ià
UIP_UDP


1277 
u_¡©s_t
 
	mdrİ
;

1278 
u_¡©s_t
 
	m»cv
;

1279 
u_¡©s_t
 
	m£Á
;

1280 
u_¡©s_t
 
	mchk”r
;

1282 } 
	mudp
;

1291 
u_¡©s
 
u_¡©
;

1305 
u8_t
 
u_æags
;

1314 
	#UIP_ACKDATA
 1

	)

1318 
	#UIP_NEWDATA
 2

	)

1320 
	#UIP_REXMIT
 4

	)

1322 
	#UIP_POLL
 8

	)

1325 
	#UIP_CLOSE
 16

	)

1330 
	#UIP_ABORT
 32

	)

1335 
	#UIP_CONNECTED
 64

	)

1340 
	#UIP_TIMEDOUT
 128

	)

1347 
u_´oûss
(
u8_t
 
æag
);

1356 
	#UIP_DATA
 1

	)

1360 
	#UIP_TIMER
 2

	)

1362 
	#UIP_POLL_REQUEST
 3

	)

1364 
	#UIP_UDP_SEND_CONN
 4

	)

1367 #ià
UIP_UDP


1368 
	#UIP_UDP_TIMER
 5

	)

1372 
	#UIP_CLOSED
 0

	)

1373 
	#UIP_SYN_RCVD
 1

	)

1374 
	#UIP_SYN_SENT
 2

	)

1375 
	#UIP_ESTABLISHED
 3

	)

1376 
	#UIP_FIN_WAIT_1
 4

	)

1377 
	#UIP_FIN_WAIT_2
 5

	)

1378 
	#UIP_CLOSING
 6

	)

1379 
	#UIP_TIME_WAIT
 7

	)

1380 
	#UIP_LAST_ACK
 8

	)

1381 
	#UIP_TS_MASK
 15

	)

1383 
	#UIP_STOPPED
 16

	)

1386 
	su_tı_hdr
 {

1387 #ià
UIP_CONF_IPV6


1389 
u8_t
 
	mvtc
,

1390 
	mtcæow
;

1391 
u16_t
 
	mæow
;

1392 
u8_t
 
	mËn
[2];

1393 
u8_t
 
	m´Ùo
, 
	m‰l
;

1394 
u_6addr_t
 
	m¤caddr
, 
	mde¡addr
;

1397 
u8_t
 
	mvhl
,

1398 
	mtos
,

1399 
	mËn
[2],

1400 
	mid
[2],

1401 
	moff£t
[2],

1402 
	m‰l
,

1403 
	m´Ùo
;

1404 
u16_t
 
	mchksum
;

1405 
u16_t
 
	m¤caddr
[2],

1406 
	mde¡addr
[2];

1410 
u16_t
 
	m¤ıÜt
,

1411 
	mde¡pÜt
;

1412 
u8_t
 
	m£qno
[4],

1413 
	mackno
[4],

1414 
	mtıoff£t
,

1415 
	mæags
,

1416 
	mwnd
[2];

1417 
u16_t
 
	mtıchksum
;

1418 
u8_t
 
	murgp
[2];

1419 
u8_t
 
	mİtd©a
[4];

1423 
	su_icmp_hdr
 {

1424 #ià
UIP_CONF_IPV6


1426 
u8_t
 
	mvtc
,

1427 
	mtcf
;

1428 
u16_t
 
	mæow
;

1429 
u8_t
 
	mËn
[2];

1430 
u8_t
 
	m´Ùo
, 
	m‰l
;

1431 
u_6addr_t
 
	m¤caddr
, 
	mde¡addr
;

1434 
u8_t
 
	mvhl
,

1435 
	mtos
,

1436 
	mËn
[2],

1437 
	mid
[2],

1438 
	moff£t
[2],

1439 
	m‰l
,

1440 
	m´Ùo
;

1441 
u16_t
 
	mchksum
;

1442 
u16_t
 
	m¤caddr
[2],

1443 
	mde¡addr
[2];

1447 
u8_t
 
	mty³
, 
	micode
;

1448 
u16_t
 
	micmpchksum
;

1449 #ià!
UIP_CONF_IPV6


1450 
u16_t
 
	mid
, 
	m£qno
;

1452 
u8_t
 
	mæags
, 
	m»£rved1
, 
	m»£rved2
, 
	m»£rved3
;

1453 
u8_t
 
	micmp6d©a
[16];

1454 
u8_t
 
	mİtiÚs
[1];

1460 
	su_udp_hdr
 {

1461 #ià
UIP_CONF_IPV6


1463 
u8_t
 
	mvtc
,

1464 
	mtcf
;

1465 
u16_t
 
	mæow
;

1466 
u8_t
 
	mËn
[2];

1467 
u8_t
 
	m´Ùo
, 
	m‰l
;

1468 
u_6addr_t
 
	m¤caddr
, 
	mde¡addr
;

1471 
u8_t
 
	mvhl
,

1472 
	mtos
,

1473 
	mËn
[2],

1474 
	mid
[2],

1475 
	moff£t
[2],

1476 
	m‰l
,

1477 
	m´Ùo
;

1478 
u16_t
 
	mchksum
;

1479 
u16_t
 
	m¤caddr
[2],

1480 
	mde¡addr
[2];

1484 
u16_t
 
	m¤ıÜt
,

1485 
	mde¡pÜt
;

1486 
u16_t
 
	mud¶’
;

1487 
u16_t
 
	mudpchksum
;

1506 
	#UIP_APPDATA_SIZE
 (
UIP_BUFSIZE
 - 
UIP_LLH_LEN
 - 
UIP_TCPIP_HLEN
)

	)

1509 
	#UIP_PROTO_ICMP
 1

	)

1510 
	#UIP_PROTO_TCP
 6

	)

1511 
	#UIP_PROTO_UDP
 17

	)

1512 
	#UIP_PROTO_ICMP6
 58

	)

1515 #ià
UIP_CONF_IPV6


1516 
	#UIP_IPH_LEN
 40

	)

1518 
	#UIP_IPH_LEN
 20

	)

1520 
	#UIP_UDPH_LEN
 8

	)

1521 
	#UIP_TCPH_LEN
 20

	)

1522 
	#UIP_IPUDPH_LEN
 (
UIP_UDPH_LEN
 + 
UIP_IPH_LEN
è

	)

1525 
	#UIP_IPTCPH_LEN
 (
UIP_TCPH_LEN
 + 
UIP_IPH_LEN
è

	)

1528 
	#UIP_TCPIP_HLEN
 
UIP_IPTCPH_LEN


	)

1531 #ià
UIP_FIXEDADDR


1532 cÚ¡ 
u_addr_t
 
u_ho¡addr
, 
u_Ãtmask
, 
u_d¿ddr
;

1534 
u_addr_t
 
u_ho¡addr
, 
u_Ãtmask
, 
u_d¿ddr
;

1542 
	su_‘h_addr
 {

1543 
u8_t
 
	maddr
[6];

1562 
u16_t
 
u_chksum
(u16_ˆ*
buf
, u16_ˆ
Ën
);

1573 
u16_t
 
u_chksum
();

1584 
u16_t
 
u_tıchksum
();

1595 
u16_t
 
u_udpchksum
();

	@uip/uip_arch.h

61 #iâdeà
__UIP_ARCH_H__


62 
	#__UIP_ARCH_H__


	)

64 
	~"u.h
"

84 
u_add32
(
u8_t
 *
İ32
, 
u16_t
 
İ16
);

105 
u16_t
 
u_chksum
(u16_ˆ*
buf
, u16_ˆ
Ën
);

116 
u16_t
 
u_chksum
();

131 
u16_t
 
u_tıchksum
();

133 
u16_t
 
u_udpchksum
();

	@uip/uip_arp.c

62 
	~"u_¬p.h
"

64 
	~<¡ršg.h
>

66 
	s¬p_hdr
 {

67 
u_‘h_hdr
 
	m‘hhdr
;

68 
u16_t
 
	mhwty³
;

69 
u16_t
 
	m´ÙocŞ
;

70 
u8_t
 
	mhwËn
;

71 
u8_t
 
	m´ÙŞ’
;

72 
u16_t
 
	mİcode
;

73 
u_‘h_addr
 
	mshwaddr
;

74 
u16_t
 
	msaddr
[2];

75 
u_‘h_addr
 
	mdhwaddr
;

76 
u16_t
 
	mdaddr
[2];

79 
	s‘h_hdr
 {

80 
u_‘h_hdr
 
	m‘hhdr
;

82 
u8_t
 
	mvhl
,

83 
	mtos
,

84 
	mËn
[2],

85 
	mid
[2],

86 
	moff£t
[2],

87 
	m‰l
,

88 
	m´Ùo
;

89 
u16_t
 
	mchksum
;

90 
u16_t
 
	m¤caddr
[2],

91 
	mde¡addr
[2];

94 
	#ARP_REQUEST
 1

	)

95 
	#ARP_REPLY
 2

	)

97 
	#ARP_HWTYPE_ETH
 1

	)

99 
	s¬p_’Œy
 {

100 
u16_t
 
	maddr
[2];

101 
u_‘h_addr
 
	m‘haddr
;

102 
u8_t
 
	mtime
;

105 cÚ¡ 
u_‘h_addr
 
	gbrßdÿ¡_‘haddr
 =

107 cÚ¡ 
u16_t
 
	gbrßdÿ¡_addr
[2] = {0xffff,0xffff};

109 
¬p_’Œy
 
	g¬p_bË
[
UIP_ARPTAB_SIZE
];

110 
u16_t
 
	gaddr
[2];

111 
u8_t
 
	gi
, 
	gc
;

113 
u8_t
 
	g¬±ime
;

114 
u8_t
 
	gtm·ge
;

116 
	#BUF
 ((
¬p_hdr
 *)&
u_buf
[0])

	)

117 
	#IPBUF
 ((
‘h_hdr
 *)&
u_buf
[0])

	)

125 
	$u_¬p_š™
()

127 
i
 = 0; i < 
UIP_ARPTAB_SIZE
; ++i) {

128 
	`mem£t
(
¬p_bË
[
i
].
addr
, 0, 4);

130 
	}
}

142 
	$u_¬p_tim”
()

144 
¬p_’Œy
 *
b±r
;

146 ++
¬±ime
;

147 
i
 = 0; i < 
UIP_ARPTAB_SIZE
; ++i) {

148 
b±r
 = &
¬p_bË
[
i
];

149 if((
b±r
->
addr
[0] |abptr->ipaddr[1]) != 0 &&

150 
¬±ime
 - 
b±r
->
time
 >ğ
UIP_ARP_MAXAGE
) {

151 
	`mem£t
(
b±r
->
addr
, 0, 4);

155 
	}
}

158 
	$u_¬p_upd©e
(
u16_t
 *
addr
, 
u_‘h_addr
 *
‘haddr
)

160 
¬p_’Œy
 *
b±r
;

164 
i
 = 0; i < 
UIP_ARPTAB_SIZE
; ++i) {

166 
b±r
 = &
¬p_bË
[
i
];

168 if(
b±r
->
addr
[0] != 0 &&

169 
b±r
->
addr
[1] != 0) {

173 if(
addr
[0] =ğ
b±r
->ipaddr[0] &&

174 
addr
[1] =ğ
b±r
->ipaddr[1]) {

177 
	`memıy
(
b±r
->
‘haddr
.
addr
,ƒthaddr->addr, 6);

178 
b±r
->
time
 = 
¬±ime
;

189 
i
 = 0; i < 
UIP_ARPTAB_SIZE
; ++i) {

190 
b±r
 = &
¬p_bË
[
i
];

191 if(
b±r
->
addr
[0] == 0 &&

192 
b±r
->
addr
[1] == 0) {

199 if(
i
 =ğ
UIP_ARPTAB_SIZE
) {

200 
tm·ge
 = 0;

201 
c
 = 0;

202 
i
 = 0; i < 
UIP_ARPTAB_SIZE
; ++i) {

203 
b±r
 = &
¬p_bË
[
i
];

204 if(
¬±ime
 - 
b±r
->
time
 > 
tm·ge
) {

205 
tm·ge
 = 
¬±ime
 - 
b±r
->
time
;

206 
c
 = 
i
;

209 
i
 = 
c
;

210 
b±r
 = &
¬p_bË
[
i
];

215 
	`memıy
(
b±r
->
addr
, ipaddr, 4);

216 
	`memıy
(
b±r
->
‘haddr
.
addr
,ƒthaddr->addr, 6);

217 
b±r
->
time
 = 
¬±ime
;

218 
	}
}

235 
	$u_¬p_š
()

237 
u_Ën
 -ğ(
u_‘h_hdr
);

241 if((
IPBUF
->
¤caddr
[0] & 
u_Ãtmask
[0]) !=

242 (
u_ho¡addr
[0] & 
u_Ãtmask
[0])) {

245 if((
IPBUF
->
¤caddr
[1] & 
u_Ãtmask
[1]) !=

246 (
u_ho¡addr
[1] & 
u_Ãtmask
[1])) {

249 
	`u_¬p_upd©e
(
IPBUF
->
¤caddr
, &(IPBUF->
‘hhdr
.
¤c
));

252 
	}
}

278 
	$u_¬p_¬pš
()

281 if(
u_Ën
 < (
¬p_hdr
)) {

282 
u_Ën
 = 0;

285 
u_Ën
 = 0;

287 
BUF
->
İcode
) {

288 
	`HTONS
(
ARP_REQUEST
):

291 if(
	`u_addr_cmp
(
BUF
->
daddr
, 
u_ho¡addr
)) {

295 
	`u_¬p_upd©e
(
BUF
->
saddr
, &BUF->
shwaddr
);

298 
BUF
->
İcode
 = 
	`HTONS
(2);

300 
	`memıy
(
BUF
->
dhwaddr
.
addr
, BUF->
shwaddr
.addr, 6);

301 
	`memıy
(
BUF
->
shwaddr
.
addr
, 
u_‘haddr
.addr, 6);

302 
	`memıy
(
BUF
->
‘hhdr
.
¤c
.
addr
, 
u_‘haddr
.addr, 6);

303 
	`memıy
(
BUF
->
‘hhdr
.
de¡
.
addr
, BUF->
dhwaddr
.addr, 6);

305 
BUF
->
daddr
[0] = BUF->
saddr
[0];

306 
BUF
->
daddr
[1] = BUF->
saddr
[1];

307 
BUF
->
saddr
[0] = 
u_ho¡addr
[0];

308 
BUF
->
saddr
[1] = 
u_ho¡addr
[1];

310 
BUF
->
‘hhdr
.
ty³
 = 
	`HTONS
(
UIP_ETHTYPE_ARP
);

311 
u_Ën
 = (
¬p_hdr
);

314 
	`HTONS
(
ARP_REPLY
):

317 if(
	`u_addr_cmp
(
BUF
->
daddr
, 
u_ho¡addr
)) {

318 
	`u_¬p_upd©e
(
BUF
->
saddr
, &BUF->
shwaddr
);

324 
	}
}

354 
	$u_¬p_out
()

356 
¬p_’Œy
 *
b±r
;

366 if(
	`u_addr_cmp
(
IPBUF
->
de¡addr
, 
brßdÿ¡_addr
)) {

367 
	`memıy
(
IPBUF
->
‘hhdr
.
de¡
.
addr
, 
brßdÿ¡_‘haddr
.addr, 6);

370 if(!
	`u_addr_maskcmp
(
IPBUF
->
de¡addr
, 
u_ho¡addr
, 
u_Ãtmask
)) {

374 
	`u_addr_cİy
(
addr
, 
u_d¿ddr
);

377 
	`u_addr_cİy
(
addr
, 
IPBUF
->
de¡addr
);

380 
i
 = 0; i < 
UIP_ARPTAB_SIZE
; ++i) {

381 
b±r
 = &
¬p_bË
[
i
];

382 if(
	`u_addr_cmp
(
addr
, 
b±r
->ipaddr)) {

387 if(
i
 =ğ
UIP_ARPTAB_SIZE
) {

391 
	`mem£t
(
BUF
->
‘hhdr
.
de¡
.
addr
, 0xff, 6);

392 
	`mem£t
(
BUF
->
dhwaddr
.
addr
, 0x00, 6);

393 
	`memıy
(
BUF
->
‘hhdr
.
¤c
.
addr
, 
u_‘haddr
.addr, 6);

394 
	`memıy
(
BUF
->
shwaddr
.
addr
, 
u_‘haddr
.addr, 6);

396 
	`u_addr_cİy
(
BUF
->
daddr
, 
addr
);

397 
	`u_addr_cİy
(
BUF
->
saddr
, 
u_ho¡addr
);

398 
BUF
->
İcode
 = 
	`HTONS
(
ARP_REQUEST
);

399 
BUF
->
hwty³
 = 
	`HTONS
(
ARP_HWTYPE_ETH
);

400 
BUF
->
´ÙocŞ
 = 
	`HTONS
(
UIP_ETHTYPE_IP
);

401 
BUF
->
hwËn
 = 6;

402 
BUF
->
´ÙŞ’
 = 4;

403 
BUF
->
‘hhdr
.
ty³
 = 
	`HTONS
(
UIP_ETHTYPE_ARP
);

405 
u_­pd©a
 = &
u_buf
[
UIP_TCPIP_HLEN
 + 
UIP_LLH_LEN
];

407 
u_Ën
 = (
¬p_hdr
);

412 
	`memıy
(
IPBUF
->
‘hhdr
.
de¡
.
addr
, 
b±r
->
‘haddr
.addr, 6);

414 
	`memıy
(
IPBUF
->
‘hhdr
.
¤c
.
addr
, 
u_‘haddr
.addr, 6);

416 
IPBUF
->
‘hhdr
.
ty³
 = 
	`HTONS
(
UIP_ETHTYPE_IP
);

418 
u_Ën
 +ğ(
u_‘h_hdr
);

419 
	}
}

	@uip/uip_arp.h

52 #iâdeà
__UIP_ARP_H__


53 
	#__UIP_ARP_H__


	)

55 
	~"u.h
"

58 
u_‘h_addr
 
u_‘haddr
;

63 
	su_‘h_hdr
 {

64 
u_‘h_addr
 
	mde¡
;

65 
u_‘h_addr
 
	m¤c
;

66 
u16_t
 
	mty³
;

69 
	#UIP_ETHTYPE_ARP
 0x0806

	)

70 
	#UIP_ETHTYPE_IP
 0x0800

	)

71 
	#UIP_ETHTYPE_IP6
 0x86dd

	)

76 
u_¬p_š™
();

84 
	#u_¬p_š
()

	)

92 
u_¬p_¬pš
();

104 
u_¬p_out
();

108 
u_¬p_tim”
();

134 
	#u_£‹thaddr
(
—ddr
èdØ{
u_‘haddr
.
addr
[0] =ƒaddr.addr[0]; \

135 
u_‘haddr
.
addr
[1] = 
—ddr
.addr[1];\

136 
u_‘haddr
.
addr
[2] = 
—ddr
.addr[2];\

137 
u_‘haddr
.
addr
[3] = 
—ddr
.addr[3];\

138 
u_‘haddr
.
addr
[4] = 
—ddr
.addr[4];\

139 
u_‘haddr
.
addr
[5] = 
—ddr
.addr[5];} 0)

	)

	@uip/uiplib.c

37 
	~"u.h
"

38 
	~"ulib.h
"

43 
	$ulib_addrcÚv
(*
addr¡r
, *
addr
)

45 
tmp
;

46 
c
;

47 
i
, 
j
;

49 
tmp
 = 0;

51 
i
 = 0; i < 4; ++i) {

52 
j
 = 0;

54 
c
 = *
addr¡r
;

55 ++
j
;

56 if(
j
 > 4) {

59 if(
c
 == '.' || c == 0) {

60 *
addr
 = 
tmp
;

61 ++
addr
;

62 
tmp
 = 0;

63 } if(
c
 >= '0' && c <= '9') {

64 
tmp
 = (tm°* 10è+ (
c
 - '0');

68 ++
addr¡r
;

69 } 
c
 != '.' && c != 0);

72 
	}
}

	@uip/uiplib.h

43 #iâdeà
__UIPLIB_H__


44 
	#__UIPLIB_H__


	)

67 
ulib_addrcÚv
(*
addr¡r
, *
addr
);

	@uip/uipopt.h

60 #iâdeà
__UIPOPT_H__


61 
	#__UIPOPT_H__


	)

63 #iâdeà
UIP_LITTLE_ENDIAN


64 
	#UIP_LITTLE_ENDIAN
 3412

	)

66 #iâdeà
UIP_BIG_ENDIAN


67 
	#UIP_BIG_ENDIAN
 1234

	)

70 
	~"u-cÚf.h
"

97 
	#UIP_FIXEDADDR
 0

	)

111 #ifdeà
UIP_CONF_PINGADDRCONF


112 
	#UIP_PINGADDRCONF
 
UIP_CONF_PINGADDRCONF


	)

114 
	#UIP_PINGADDRCONF
 0

	)

127 
	#UIP_FIXEDETHADDR
 0

	)

141 
	#UIP_TTL
 64

	)

156 
	#UIP_REASSEMBLY
 0

	)

163 
	#UIP_REASS_MAXAGE
 40

	)

178 #ifdeà
UIP_CONF_UDP


179 
	#UIP_UDP
 
UIP_CONF_UDP


	)

181 
	#UIP_UDP
 0

	)

192 #ifdeà
UIP_CONF_UDP_CHECKSUMS


193 
	#UIP_UDP_CHECKSUMS
 
UIP_CONF_UDP_CHECKSUMS


	)

195 
	#UIP_UDP_CHECKSUMS
 0

	)

203 #ifdeà
UIP_CONF_UDP_CONNS


204 
	#UIP_UDP_CONNS
 
UIP_CONF_UDP_CONNS


	)

206 
	#UIP_UDP_CONNS
 10

	)

233 
	#UIP_ACTIVE_OPEN
 1

	)

244 #iâdeà
UIP_CONF_MAX_CONNECTIONS


245 
	#UIP_CONNS
 10

	)

247 
	#UIP_CONNS
 
UIP_CONF_MAX_CONNECTIONS


	)

258 #iâdeà
UIP_CONF_MAX_LISTENPORTS


259 
	#UIP_LISTENPORTS
 20

	)

261 
	#UIP_LISTENPORTS
 
UIP_CONF_MAX_LISTENPORTS


	)

273 
	#UIP_URGDATA
 0

	)

280 
	#UIP_RTO
 3

	)

288 
	#UIP_MAXRTX
 8

	)

297 
	#UIP_MAXSYNRTX
 5

	)

305 
	#UIP_TCP_MSS
 (
UIP_BUFSIZE
 - 
UIP_LLH_LEN
 - 
UIP_TCPIP_HLEN
)

	)

316 #iâdeà
UIP_CONF_RECEIVE_WINDOW


317 
	#UIP_RECEIVE_WINDOW
 
UIP_TCP_MSS


	)

319 
	#UIP_RECEIVE_WINDOW
 
UIP_CONF_RECEIVE_WINDOW


	)

328 
	#UIP_TIME_WAIT_TIMEOUT
 120

	)

346 #ifdeà
UIP_CONF_ARPTAB_SIZE


347 
	#UIP_ARPTAB_SIZE
 
UIP_CONF_ARPTAB_SIZE


	)

349 
	#UIP_ARPTAB_SIZE
 8

	)

358 
	#UIP_ARP_MAXAGE
 120

	)

378 #iâdeà
UIP_CONF_BUFFER_SIZE


379 
	#UIP_BUFSIZE
 400

	)

381 
	#UIP_BUFSIZE
 
UIP_CONF_BUFFER_SIZE


	)

392 #iâdeà
UIP_CONF_STATISTICS


393 
	#UIP_STATISTICS
 0

	)

395 
	#UIP_STATISTICS
 
UIP_CONF_STATISTICS


	)

407 #iâdeà
UIP_CONF_LOGGING


408 
	#UIP_LOGGING
 0

	)

410 
	#UIP_LOGGING
 
UIP_CONF_LOGGING


	)

422 #iâdeà
UIP_CONF_BROADCAST


423 
	#UIP_BROADCAST
 0

	)

425 
	#UIP_BROADCAST
 
UIP_CONF_BROADCAST


	)

434 
u_log
(*
msg
);

445 #ifdeà
UIP_CONF_LLH_LEN


446 
	#UIP_LLH_LEN
 
UIP_CONF_LLH_LEN


	)

448 
	#UIP_LLH_LEN
 14

	)

472 #ifdeà
UIP_CONF_BYTE_ORDER


473 
	#UIP_BYTE_ORDER
 
UIP_CONF_BYTE_ORDER


	)

475 
	#UIP_BYTE_ORDER
 
UIP_LITTLE_ENDIAN


	)

	@unix/clock-arch.c

41 
	~"şock-¬ch.h
"

42 
	~<sys/time.h
>

45 
şock_time_t


46 
	$şock_time
()

48 
timev®
 
tv
;

49 
timezÚe
 
tz
;

51 
	`g‘timeofday
(&
tv
, &
tz
);

53  
tv
.
tv_£c
 * 1000 +v.
tv_u£c
 / 1000;

54 
	}
}

	@unix/clock-arch.h

34 #iâdeà
__CLOCK_ARCH_H__


35 
	#__CLOCK_ARCH_H__


	)

37 
	tşock_time_t
;

38 
	#CLOCK_CONF_SECOND
 1000

	)

	@unix/main.c

39 
	~"u.h
"

40 
	~"u_¬p.h
"

41 
	~"pdev.h
"

43 
	~"tim”.h
"

45 
	#BUF
 ((
u_‘h_hdr
 *)&
u_buf
[0])

	)

47 #iâdeà
NULL


48 
	#NULL
 (*)0

	)

53 
	$maš
()

55 
i
;

56 
u_addr_t
 
addr
;

57 
tim”
 
³riodic_tim”
, 
¬p_tim”
;

59 
	`tim”_£t
(&
³riodic_tim”
, 
CLOCK_SECOND
 / 2);

60 
	`tim”_£t
(&
¬p_tim”
, 
CLOCK_SECOND
 * 10);

62 
	`pdev_š™
();

63 
	`u_š™
();

65 
	`u_addr
(
addr
, 192,168,0,2);

66 
	`u_£tho¡addr
(
addr
);

67 
	`u_addr
(
addr
, 192,168,0,1);

68 
	`u_£td¿ddr
(
addr
);

69 
	`u_addr
(
addr
, 255,255,255,0);

70 
	`u_£Š‘mask
(
addr
);

72 
	`h‰pd_š™
();

99 
u_Ën
 = 
	`pdev_»ad
();

100 if(
u_Ën
 > 0) {

101 if(
BUF
->
ty³
 =ğ
	`htÚs
(
UIP_ETHTYPE_IP
)) {

102 
	`u_¬p_š
();

103 
	`u_šput
();

107 if(
u_Ën
 > 0) {

108 
	`u_¬p_out
();

109 
	`pdev_£nd
();

111 } if(
BUF
->
ty³
 =ğ
	`htÚs
(
UIP_ETHTYPE_ARP
)) {

112 
	`u_¬p_¬pš
();

116 if(
u_Ën
 > 0) {

117 
	`pdev_£nd
();

121 } if(
	`tim”_expœed
(&
³riodic_tim”
)) {

122 
	`tim”_»£t
(&
³riodic_tim”
);

123 
i
 = 0; i < 
UIP_CONNS
; i++) {

124 
	`u_³riodic
(
i
);

128 if(
u_Ën
 > 0) {

129 
	`u_¬p_out
();

130 
	`pdev_£nd
();

134 #ià
UIP_UDP


135 
i
 = 0; i < 
UIP_UDP_CONNS
; i++) {

136 
	`u_udp_³riodic
(
i
);

140 if(
u_Ën
 > 0) {

141 
	`u_¬p_out
();

142 
	`pdev_£nd
();

148 if(
	`tim”_expœed
(&
¬p_tim”
)) {

149 
	`tim”_»£t
(&
¬p_tim”
);

150 
	`u_¬p_tim”
();

155 
	}
}

158 
	$u_log
(*
m
)

160 
	`´štf
("uIP†og mes§ge: %s\n", 
m
);

161 
	}
}

163 
	$»sŞv_found
(*
Çme
, 
u16_t
 *
addr
)

165 
u16_t
 *
addr2
;

167 if(
addr
 =ğ
NULL
) {

168 
	`´štf
("Ho¡ '%s'‚Ù found.\n", 
Çme
);

170 
	`´štf
("Found‚am'%s' = %d.%d.%d.%d\n", 
Çme
,

171 
	`htÚs
(
addr
[0]) >> 8,

172 
	`htÚs
(
addr
[0]) & 0xff,

173 
	`htÚs
(
addr
[1]) >> 8,

174 
	`htÚs
(
addr
[1]) & 0xff);

177 
	}
}

178 #ifdeà
__DHCPC_H__


180 
	$dhıc_cÚfigu»d
(cÚ¡ 
dhıc_¡©e
 *
s
)

182 
	`u_£tho¡addr
(
s
->
addr
);

183 
	`u_£Š‘mask
(
s
->
Ãtmask
);

184 
	`u_£td¿ddr
(
s
->
deçuÉ_rou‹r
);

185 
	`»sŞv_cÚf
(
s
->
dn§ddr
);

186 
	}
}

189 
	$sm_dÚe
(
code
)

191 
	`´štf
("SMTP dÚw™h cod%d\n", 
code
);

192 
	}
}

194 
	$webş›Á_şo£d
()

196 
	`´štf
("Webclient: connection closed\n");

197 
	}
}

199 
	$webş›Á_abÜ‹d
()

201 
	`´štf
("Webclient: connection‡borted\n");

202 
	}
}

204 
	$webş›Á_timedout
()

206 
	`´štf
("Webclient: connectionimed out\n");

207 
	}
}

209 
	$webş›Á_cÚÃùed
()

211 
	`´štf
("Webclient: connected, waiting for data...\n");

212 
	}
}

214 
	$webş›Á_d©ahªdËr
(*
d©a
, 
u16_t
 
Ën
)

216 
	`´štf
("Webş›Á: gÙ %d by‹ oàd©a.\n", 
Ën
);

217 
	}
}

	@unix/tapdev.c

37 
	#UIP_DRIPADDR0
 192

	)

38 
	#UIP_DRIPADDR1
 168

	)

39 
	#UIP_DRIPADDR2
 0

	)

40 
	#UIP_DRIPADDR3
 1

	)

42 
	~<fú.h
>

43 
	~<¡dlib.h
>

44 
	~<¡dio.h
>

45 
	~<uni¡d.h
>

46 
	~<¡ršg.h
>

47 
	~<sys/ioùl.h
>

48 
	~<sys/sock‘.h
>

49 
	~<sys/ty³s.h
>

50 
	~<sys/time.h
>

51 
	~<sys/uio.h
>

52 
	~<sys/sock‘.h
>

54 #ifdeà
lšux


55 
	~<sys/ioùl.h
>

56 
	~<lšux/if.h
>

57 
	~<lšux/if_tun.h
>

58 
	#DEVTAP
 "/dev/Ãt/tun"

	)

60 
	#DEVTAP
 "/dev/p0"

	)

63 
	~"u.h
"

65 
	gdrİ
 = 0;

66 
	gfd
;

71 
	$pdev_š™
()

73 
buf
[1024];

75 
fd
 = 
	`İ’
(
DEVTAP
, 
O_RDWR
);

76 if(
fd
 == -1) {

77 
	`³¼Ü
("tapdev:apdev_init: open");

78 
	`ex™
(1);

81 #ifdeà
lšux


83 
iäeq
 
iä
;

84 
	`mem£t
(&
iä
, 0, (ifr));

85 
iä
.
iä_æags
 = 
IFF_TAP
|
IFF_NO_PI
;

86 ià(
	`ioùl
(
fd
, 
TUNSETIFF
, (*è&
iä
) < 0) {

87 
	`³¼Ü
(
buf
);

88 
	`ex™
(1);

93 
	`¢´štf
(
buf
, (buf), "ifconfigap0 inet %d.%d.%d.%d",

94 
UIP_DRIPADDR0
, 
UIP_DRIPADDR1
, 
UIP_DRIPADDR2
, 
UIP_DRIPADDR3
);

95 
	`sy¡em
(
buf
);

97 
	}
}

100 
	$pdev_»ad
()

102 
fd_£t
 
fd£t
;

103 
timev®
 
tv
, 
now
;

104 
»t
;

106 
tv
.
tv_£c
 = 0;

107 
tv
.
tv_u£c
 = 1000;

110 
	`FD_ZERO
(&
fd£t
);

111 
	`FD_SET
(
fd
, &
fd£t
);

113 
»t
 = 
	`£Ëù
(
fd
 + 1, &
fd£t
, 
NULL
, NULL, &
tv
);

114 if(
»t
 == 0) {

117 
»t
 = 
	`»ad
(
fd
, 
u_buf
, 
UIP_BUFSIZE
);

118 if(
»t
 == -1) {

119 
	`³¼Ü
("tap_dev:apdev_read:„ead");

131  
»t
;

132 
	}
}

135 
	$pdev_£nd
()

137 
»t
;

146 
»t
 = 
	`wr™e
(
fd
, 
u_buf
, 
u_Ën
);

147 if(
»t
 == -1) {

148 
	`³¼Ü
("tap_dev:apdev_send: writev");

149 
	`ex™
(1);

151 
	}
}

	@unix/tapdev.h

38 #iâdeà
__TAPDEV_H__


39 
	#__TAPDEV_H__


	)

41 
pdev_š™
();

42 
pdev_»ad
();

43 
pdev_£nd
();

	@unix/uip-conf.h

55 #iâdeà
__UIP_CONF_H__


56 
	#__UIP_CONF_H__


	)

58 
	~<š‰y³s.h
>

67 
ušt8_t
 
	tu8_t
;

76 
ušt16_t
 
	tu16_t
;

86 
	tu_¡©s_t
;

93 
	#UIP_CONF_MAX_CONNECTIONS
 40

	)

100 
	#UIP_CONF_MAX_LISTENPORTS
 40

	)

107 
	#UIP_CONF_BUFFER_SIZE
 420

	)

114 
	#UIP_CONF_BYTE_ORDER
 
LITTLE_ENDIAN


	)

121 
	#UIP_CONF_LOGGING
 1

	)

128 
	#UIP_CONF_UDP
 0

	)

135 
	#UIP_CONF_UDP_CHECKSUMS
 1

	)

142 
	#UIP_CONF_STATISTICS
 1

	)

149 
	~"web£rv”.h
"

	@
1
.
0
63
1251
apps/dhcpc/dhcpc.c
apps/dhcpc/dhcpc.h
apps/hello-world/hello-world.c
apps/hello-world/hello-world.h
apps/resolv/resolv.c
apps/resolv/resolv.h
apps/smtp/smtp-strings.c
apps/smtp/smtp-strings.h
apps/smtp/smtp.c
apps/smtp/smtp.h
apps/telnetd/shell.c
apps/telnetd/shell.h
apps/telnetd/telnetd.c
apps/telnetd/telnetd.h
apps/webclient/webclient-strings.c
apps/webclient/webclient-strings.h
apps/webclient/webclient.c
apps/webclient/webclient.h
apps/webserver/http-strings.c
apps/webserver/http-strings.h
apps/webserver/httpd-cgi.c
apps/webserver/httpd-cgi.h
apps/webserver/httpd-fs.c
apps/webserver/httpd-fs.h
apps/webserver/httpd-fsdata.c
apps/webserver/httpd-fsdata.h
apps/webserver/httpd.c
apps/webserver/httpd.h
apps/webserver/webserver.h
doc/example-mainloop-with-arp.c
doc/example-mainloop-without-arp.c
doc/uip-code-style.c
lib/memb.c
lib/memb.h
uip/clock.h
uip/lc-addrlabels.h
uip/lc-switch.h
uip/lc.h
uip/psock.c
uip/psock.h
uip/pt.h
uip/timer.c
uip/timer.h
uip/uip-fw.c
uip/uip-fw.h
uip/uip-neighbor.c
uip/uip-neighbor.h
uip/uip-split.c
uip/uip-split.h
uip/uip.c
uip/uip.h
uip/uip_arch.h
uip/uip_arp.c
uip/uip_arp.h
uip/uiplib.c
uip/uiplib.h
uip/uipopt.h
unix/clock-arch.c
unix/clock-arch.h
unix/main.c
unix/tapdev.c
unix/tapdev.h
unix/uip-conf.h
